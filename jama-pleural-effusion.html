<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ»²å‡ºæ€§è‚‹è†œç©æ¶²è¨ºæ–· | JAMA Rational Clinical Examination</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&family=Crimson+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --pri: #00838F;
            --pri2: #00ACC1;
            --sec: #00695C;
            --sec2: #26A69A;
            --suc: #2E7D32;
            --warn: #F9A825;
            --danger: #C62828;
            --info: #1565C0;
            --bg: #F5FAFA;
            --txt: #37474F;
            --txt2: #607D8B;
            --card-shadow: 0 4px 20px rgba(0, 131, 143, 0.08);
        }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg);
            color: var(--txt);
            line-height: 1.8;
            -webkit-font-smoothing: antialiased;
        }
        .card {
            background: #fff;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0, 131, 143, 0.08);
        }
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 14px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        .btn-pri { background: linear-gradient(135deg, var(--pri), var(--pri2)); color: #fff; }
        .btn-pri:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0, 131, 143, 0.3); }
        .btn-sec { background: linear-gradient(135deg, var(--sec), var(--sec2)); color: #fff; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; margin: 12px 0; }
        th, td { padding: 12px 10px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: linear-gradient(135deg, #E0F7FA, #B2EBF2); font-weight: 600; color: var(--pri); }
        .formula {
            background: linear-gradient(135deg, #E0F7FA, #B2EBF2);
            border: 2px solid var(--pri2);
            border-radius: 16px;
            padding: 18px;
            margin: 14px 0;
            text-align: center;
            font-family: 'Crimson Pro', serif;
            font-size: 18px;
            color: var(--txt);
            font-weight: 600;
        }
        .tip {
            background: linear-gradient(135deg, #FFF8E1, #FFECB3);
            border-left: 4px solid var(--warn);
            border-radius: 0 14px 14px 0;
            padding: 16px;
            margin: 14px 0;
        }
        .good {
            background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
            border-left: 4px solid var(--suc);
            border-radius: 0 14px 14px 0;
            padding: 16px;
            margin: 14px 0;
        }
        .danger {
            background: linear-gradient(135deg, #FFEBEE, #FFCDD2);
            border-left: 4px solid var(--danger);
            border-radius: 0 14px 14px 0;
            padding: 16px;
            margin: 14px 0;
        }
        .info {
            background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
            border-left: 4px solid var(--info);
            border-radius: 0 14px 14px 0;
            padding: 16px;
            margin: 14px 0;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .lr-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            margin-left: 6px;
        }
        .lr-high { background: #FFCDD2; color: #B71C1C; }
        .lr-mod { background: #FFF9C4; color: #F57F17; }
        .lr-low { background: #C8E6C9; color: #1B5E20; }
        .score-box {
            background: linear-gradient(135deg, #FAFAFA, #F5F5F5);
            border: 2px solid #E0E0E0;
            border-radius: 12px;
            padding: 12px;
            margin: 8px 0;
        }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;

const MODULE_ID='jama-pleural-effusion';

// Badge definitions for notifications
const badgeDefs = {
    'first-quiz': { name: 'åˆè©¦å•¼è²', icon: 'ğŸ¯' },
    'perfect-score': { name: 'æ»¿åˆ†é”äºº', icon: 'ğŸ’¯' },
    'five-complete': { name: 'å°æœ‰æˆå°±', icon: 'â­' },
    'ten-complete': { name: 'å­¸æœ‰å°ˆç²¾', icon: 'ğŸŒŸ' },
    'master': { name: 'EBMå¤§å¸«', icon: 'ğŸ‘‘' },
    'speed-demon': { name: 'ç¥é€Ÿç­”é¡Œ', icon: 'âš¡' },
    'persistent': { name: 'å …æŒä¸æ‡ˆ', icon: 'ğŸ’ª' },
    'three-streak': { name: 'é€£å‹ä¸‰å ´', icon: 'ğŸ”¥' },
    'five-streak': { name: 'äº”é€£å‹', icon: 'ğŸ†' },
    'triple-perfect': { name: 'ä¸‰å† ç‹', icon: 'ğŸ‘‘' },
    'early-bird': { name: 'æ—©èµ·çš„é³¥', icon: 'ğŸ¦' },
    'night-owl': { name: 'å¤œè²“å­', icon: 'ğŸ¦‰' },
    'weekend-warrior': { name: 'å‡æ—¥æˆ°å£«', icon: 'ğŸ“…' },
    'comeback-kid': { name: 'é€†è½‰å‹', icon: 'ğŸš€' },
    'quick-learner': { name: 'ä¸€é»å°±é€š', icon: 'ğŸ’¡' },
    'improvement-king': { name: 'é€²æ­¥ç‹', icon: 'ğŸ“ˆ' },
    'marathon-runner': { name: 'é¦¬æ‹‰æ¾å­¸ç¿’è€…', icon: 'ğŸƒ' },
    'reviewer': { name: 'æº«æ•…çŸ¥æ–°', icon: 'ğŸ“–' },
    'almost-there': { name: 'å·®ä¸€é»é»', icon: 'ğŸ˜…' },
    'generous-guesser': { name: 'ä½›ç³»ç­”é¡Œ', icon: 'ğŸ™' },
    'learning-worm': { name: 'å­¸è¡“èš¯èš“', icon: 'ğŸª±' },
    'eternal-student': { name: 'æ°¸æ†çš„å­¸ç”Ÿ', icon: 'â™¾ï¸' },
    'speed-fail': { name: 'å…‰é€Ÿé™£äº¡', icon: 'ğŸ’«' },
    'slow-and-wrong': { name: 'æƒ³å¾ˆä¹…é‚„æ˜¯éŒ¯', icon: 'ğŸ¤”' },
    'zero-hero': { name: 'é›¶åˆ†è‹±é›„', icon: 'ğŸ’€' },
    'procrastinator': { name: 'æœ€å¾Œä¸€ç§’', icon: 'â°' },
    'deja-vu': { name: 'æ—¢è¦–æ„Ÿ', icon: 'ğŸ‘€' },
    'coffee-needed': { name: 'éœ€è¦å’–å•¡', icon: 'â˜•' },
    'wanderer': { name: 'æ¼«éŠè€…', icon: 'ğŸ§­' },
    'consistent-output': { name: 'ç©©å®šè¼¸å‡º', icon: 'ğŸ¯' },
    'heart-expert': { name: 'å¿ƒè‡Ÿé”äºº', icon: 'â¤ï¸' },
    'critical-master': { name: 'æ€¥é‡ç—‡å°ˆå®¶', icon: 'ğŸš¨' },
    'neuro-ninja': { name: 'ç¥ç¶“å¿è€…', icon: 'ğŸ§ ' },
    'pulm-pro': { name: 'èƒ¸è…”é«˜æ‰‹', icon: 'ğŸ«' },
    'ebm-foundation': { name: 'EBMåŸºçŸ³', icon: 'ğŸ›ï¸' },
    'jama-collector': { name: 'JAMAæ”¶è—å®¶', icon: 'ğŸ“š' },
    'achievement-hunter': { name: 'æˆå°±çµäºº', icon: 'ğŸ…' },
    'lucky-seven': { name: 'å¹¸é‹ä¸ƒ', icon: 'ğŸ€' },
    'completionist': { name: 'å…¨æˆå°±é”æˆ', icon: 'ğŸ–ï¸' }
};

// Category module mappings
const categoryModules = {
    cardio: ['jama-chest-pain-acs', 'jama-syncope', 'jama-hypertension'],
    critical: ['jama-bacteremia', 'jama-gi-bleed', 'jama-fluid-responsiveness', 'jama-difficult-intubation', 'jama-cirrhosis', 'jama-wound-infection'],
    neuro: ['jama-head-trauma', 'jama-delirium', 'jama-decision-capacity'],
    pulm: ['jama-pleural-effusion', 'jama-osa'],
    core: ['critical-appraisal', 'diagnostic-study', 'prognosis-study', 'rct-appraisal', 'systematic-review', 'literature-search']
};

const ProgressTracker={
    STORAGE_KEY:'ebm-progress',
    newBadges: [],
    getProgress:()=>{try{const d=localStorage.getItem(ProgressTracker.STORAGE_KEY);return d?JSON.parse(d):{version:1,modules:{},badges:[],totalTimeSpent:0,streakData:{currentPassStreak:0,currentPerfectStreak:0},lastActivityDate:null}}catch{return{version:1,modules:{},badges:[],totalTimeSpent:0,streakData:{currentPassStreak:0,currentPerfectStreak:0},lastActivityDate:null}}},
    saveQuizResult:(moduleId,score,total,timeSpent)=>{
        ProgressTracker.newBadges = [];
        const progress=ProgressTracker.getProgress();
        const mod=progress.modules[moduleId]||{bestScore:0,totalAttempts:0,allAttempts:[],lessonsViewed:[],completed:false,firstCompleted:null};
        const attempt={date:new Date().toISOString(),score,timeSpent};
        mod.allAttempts.push(attempt);mod.totalAttempts++;
        if(score>mod.bestScore)mod.bestScore=score;
        const passingScore=Math.ceil(total*0.7);
        if(score>=passingScore&&!mod.completed){mod.completed=true;mod.firstCompleted=attempt.date}
        progress.modules[moduleId]=mod;progress.totalTimeSpent+=timeSpent;progress.lastUpdated=new Date().toISOString();
        ProgressTracker.checkBadges(progress,moduleId,score,total,timeSpent);
        localStorage.setItem(ProgressTracker.STORAGE_KEY,JSON.stringify(progress));return progress;
    },
    checkBadges:(progress,moduleId,score,total,timeSpent)=>{
        const badges=progress.badges||[];const ids=badges.map(b=>b.id);const now=new Date();const nowStr=now.toISOString();
        const hour=now.getHours();const day=now.getDay();
        const passed=score>=Math.ceil(total*0.7);const perfect=score===total;
        const addBadge=(id)=>{if(!ids.includes(id)){badges.push({id,earnedAt:nowStr});ids.push(id);ProgressTracker.newBadges.push(id);return true}return false};

        // === MILESTONE & BASIC BADGES ===
        addBadge('first-quiz');
        if(perfect)addBadge('perfect-score');
        if(timeSpent<120&&passed)addBadge('speed-demon');
        const completed=Object.values(progress.modules).filter(m=>m.completed).length;
        if(completed>=5)addBadge('five-complete');
        if(completed>=10)addBadge('ten-complete');
        if(completed>=18)addBadge('master');
        const mod=progress.modules[moduleId];
        if(mod&&mod.totalAttempts>=3)addBadge('persistent');

        // === TIME-BASED BADGES ===
        if(hour<6)addBadge('early-bird');
        if(hour>=0&&hour<5)addBadge('night-owl');
        if(day===0||day===6)addBadge('weekend-warrior');
        if(hour>=2&&hour<5&&!passed)addBadge('coffee-needed');

        // === STREAK BADGES ===
        const streakData=progress.streakData||{currentPassStreak:0,currentPerfectStreak:0};
        if(passed){streakData.currentPassStreak++;if(perfect)streakData.currentPerfectStreak++;else streakData.currentPerfectStreak=0}
        else{streakData.currentPassStreak=0;streakData.currentPerfectStreak=0}
        if(streakData.currentPassStreak>=3)addBadge('three-streak');
        if(streakData.currentPassStreak>=5)addBadge('five-streak');
        if(streakData.currentPerfectStreak>=3)addBadge('triple-perfect');
        progress.streakData=streakData;

        // === MODULE-SPECIFIC BADGES ===
        if(mod){
            if(mod.totalAttempts===1&&perfect)addBadge('quick-learner');
            if(mod.totalAttempts===1&&score===7)addBadge('lucky-seven');
            if(mod.allAttempts&&mod.allAttempts.length>1){
                const firstScore=mod.allAttempts[0].score;
                if(firstScore<7&&perfect)addBadge('comeback-kid');
                if(score-firstScore>=5)addBadge('improvement-king');
                const lastThree=mod.allAttempts.slice(-3);
                if(lastThree.length===3&&lastThree[0].score===lastThree[1].score&&lastThree[1].score===lastThree[2].score)addBadge('deja-vu');
                if(lastThree.length===3&&lastThree.every(a=>a.score===score))addBadge('consistent-output');
            }
            if(mod.totalAttempts>=10)addBadge('learning-worm');
            if(mod.completed&&mod.totalAttempts>1&&passed)addBadge('reviewer');
        }

        // === HUMOROUS BADGES ===
        if(score===6)addBadge('almost-there');
        if(score===0)addBadge('zero-hero');
        if(score>=2&&score<=3)addBadge('generous-guesser');
        if(timeSpent<30&&!passed)addBadge('speed-fail');
        if(timeSpent>600&&!passed)addBadge('slow-and-wrong');

        // === TOTAL ATTEMPTS BADGES ===
        const totalAttempts=Object.values(progress.modules).reduce((sum,m)=>sum+(m.totalAttempts||0),0);
        if(totalAttempts>=50&&completed<18)addBadge('eternal-student');
        const startedNotCompleted=Object.values(progress.modules).filter(m=>m.totalAttempts>0&&!m.completed).length;
        if(startedNotCompleted>=5&&completed===0)addBadge('wanderer');

        // === PROCRASTINATOR BADGE ===
        if(progress.lastActivityDate){
            const lastActivity=new Date(progress.lastActivityDate);
            const daysSince=(now-lastActivity)/(1000*60*60*24);
            if(daysSince>=7)addBadge('procrastinator');
        }
        progress.lastActivityDate=nowStr;

        // === CATEGORY-SPECIFIC BADGES ===
        const checkCat=(cat,badgeId)=>{const mods=categoryModules[cat]||[];if(mods.length>0&&mods.every(id=>progress.modules[id]?.completed))addBadge(badgeId)};
        checkCat('cardio','heart-expert');
        checkCat('critical','critical-master');
        checkCat('neuro','neuro-ninja');
        checkCat('pulm','pulm-pro');
        checkCat('core','ebm-foundation');
        const jamaComplete=Object.keys(progress.modules).filter(k=>k.startsWith('jama-')&&progress.modules[k]?.completed).length;
        if(jamaComplete>=12)addBadge('jama-collector');

        // === META BADGES ===
        if(badges.length>=10)addBadge('achievement-hunter');
        if(badges.length>=39)addBadge('completionist');

        progress.badges=badges;
    }
};

const BadgeToast = ({ badges, onClose }) => {
    if (!badges || badges.length === 0) return null;
    return (
        <div style={{position:'fixed',top:20,right:20,zIndex:9999,display:'flex',flexDirection:'column',gap:10}}>
            {badges.map((badgeId, i) => {
                const badge = badgeDefs[badgeId];
                if (!badge) return null;
                return (
                    <div key={badgeId} style={{
                        background:'linear-gradient(135deg, #FFD700, #FFA500)',
                        padding:'16px 20px',borderRadius:16,boxShadow:'0 8px 32px rgba(0,0,0,0.2)',
                        display:'flex',alignItems:'center',gap:12,animation:'slideIn 0.5s ease-out',minWidth:240
                    }}>
                        <span style={{fontSize:36}}>{badge.icon}</span>
                        <div style={{flex:1}}>
                            <div style={{fontSize:12,fontWeight:600,color:'#5D4037'}}>æ–°æˆå°±è§£é–!</div>
                            <div style={{fontSize:16,fontWeight:700,color:'#3E2723'}}>{badge.name}</div>
                        </div>
                        <button onClick={()=>onClose(badgeId)} style={{background:'rgba(0,0,0,0.1)',border:'none',borderRadius:8,width:28,height:28,cursor:'pointer',fontSize:14}}>âœ•</button>
                    </div>
                );
            })}
            <style>{`@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}`}</style>
        </div>
    );
};

const lessons = [
    { id: 1, title: 'è‚‹è†œç©æ¶²æ¦‚è«–', sub: 'Pleural Effusion Overview', color: '#00838F' },
    { id: 2, title: 'Lightæ°æº–å‰‡', sub: "Light's Criteria", color: '#00695C' },
    { id: 3, title: 'æ›¿ä»£è¨ºæ–·æŒ‡æ¨™', sub: 'Alternative Diagnostic Tests', color: '#0097A7' },
    { id: 4, title: 'èƒ¸è…”ç©¿åˆºä½µç™¼ç—‡', sub: 'Thoracentesis Complications', color: '#00796B' },
    { id: 5, title: 'è‡¨åºŠæ‡‰ç”¨æ•´åˆ', sub: 'Clinical Application', color: '#004D40' }
];

const quiz = [
    {
        q: 'æ ¹æ“šLightæ°æº–å‰‡ï¼Œä¸‹åˆ—ä½•è€…ç¬¦åˆæ»²å‡ºæ¶²(exudate)çš„è¨ºæ–·ï¼Ÿ',
        o: ['è‚‹è†œæ¶²è›‹ç™½/è¡€æ¸…è›‹ç™½æ¯”å€¼ > 0.5', 'è‚‹è†œæ¶²LDH/è¡€æ¸…LDHæ¯”å€¼ < 0.3', 'è‚‹è†œæ¶²LDH < 100 U/L', 'è‚‹è†œæ¶²è†½å›ºé†‡ < 30 mg/dL'],
        c: 0,
        e: 'Lightæ°æº–å‰‡ä¸­ï¼Œè‚‹è†œæ¶²è›‹ç™½/è¡€æ¸…è›‹ç™½æ¯”å€¼ > 0.5 æ˜¯ä¸‰é …æ¨™æº–ä¹‹ä¸€ã€‚å…¶ä»–æ¨™æº–åŒ…æ‹¬è‚‹è†œæ¶²LDH/è¡€æ¸…LDH > 0.6ï¼Œä»¥åŠè‚‹è†œæ¶²LDH > è¡€æ¸…æ­£å¸¸ä¸Šé™çš„2/3ã€‚'
    },
    {
        q: 'ä¸‹åˆ—å“ªé …æª¢é©—å°è¨ºæ–·æ»²å‡ºæ¶²å…·æœ‰æœ€é«˜çš„é™½æ€§ä¼¼ç„¶æ¯”(LR+)ï¼Ÿ',
        o: ['è‚‹è†œæ¶²è›‹ç™½ > 3 g/dL', 'è‚‹è†œæ¶²LDH > 200 U/L', 'è‚‹è†œæ¶²è†½å›ºé†‡ > 55 mg/dL', 'è‚‹è†œæ¶²/è¡€æ¸…è›‹ç™½æ¯”å€¼ > 0.5'],
        c: 2,
        e: 'è‚‹è†œæ¶²è†½å›ºé†‡ > 55 mg/dL çš„LR+ç¯„åœç‚º7.1-250ï¼Œæ˜¯æ‰€æœ‰å–®ä¸€æª¢é©—ä¸­æœ€é«˜çš„ã€‚è‚‹è†œæ¶²LDH > 200 U/Lçš„LR+ç‚º18ã€‚'
    },
    {
        q: 'ç•¶Lightæ°æº–å‰‡ä¸‰é …æ¨™æº–çš†ä¸ç¬¦åˆæ™‚ï¼Œå°æ–¼æ’é™¤æ»²å‡ºæ¶²çš„é™°æ€§ä¼¼ç„¶æ¯”(LR-)ç‚ºä½•ï¼Ÿ',
        o: ['0.50', '0.20', '0.04', '0.01'],
        c: 2,
        e: 'ç•¶æ‰€æœ‰Lightæ°æº–å‰‡çš†ä¸ç¬¦åˆæ™‚ï¼ŒLR- = 0.04 (95% CI, 0.02-0.11)ï¼Œå¯æœ‰æ•ˆæ’é™¤æ»²å‡ºæ¶²çš„è¨ºæ–·ã€‚'
    },
    {
        q: 'èƒ¸è…”ç©¿åˆºæœ€å¸¸è¦‹çš„ä½µç™¼ç—‡ç‚ºä½•ï¼Ÿ',
        o: ['è¡€èƒ¸', 'æ°£èƒ¸', 'å†æ“´å¼µæ€§è‚ºæ°´è…«', 'æ„ŸæŸ“'],
        c: 1,
        e: 'æ°£èƒ¸æ˜¯èƒ¸è…”ç©¿åˆºæœ€å¸¸è¦‹çš„ä½µç™¼ç—‡ï¼Œç™¼ç”Ÿç‡ç´„6.0% (95% CI, 4.0%-7.0%)ã€‚éœ€è¦æ”¾ç½®èƒ¸ç®¡çš„æ¯”ä¾‹ç´„2.0%ã€‚'
    },
    {
        q: 'é—œæ–¼è¶…éŸ³æ³¢å°å¼•èƒ¸è…”ç©¿åˆºï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ',
        o: ['å¯é¡¯è‘—é™ä½æ°£èƒ¸ç™¼ç”Ÿç‡', 'å¯é™ä½ä¹¾æŠ½(dry tap)çš„é¢¨éšª', 'åƒ…é©ç”¨æ–¼å¤§é‡è‚‹è†œç©æ¶²', 'éœ€è¦æ”¾å°„ç§‘é†«å¸«åŸ·è¡Œ'],
        c: 1,
        e: 'è¶…éŸ³æ³¢å°å¼•ä¸»è¦å¯é™ä½ä¹¾æŠ½çš„é¢¨éšª(OR 0.23)ï¼Œå°æ–¼å°é‡æˆ–åˆ†éš”æ€§ç©æ¶²ç‰¹åˆ¥æœ‰å¹«åŠ©ã€‚ä½†å°æ–¼é™ä½æ°£èƒ¸çš„æ•ˆæœæœªé”çµ±è¨ˆé¡¯è‘—(OR 0.55, 95% CI 0.06-5.3)ã€‚'
    },
    {
        q: 'ä¸‹åˆ—ä½•ç¨®ç—‡ç‹€å‡ºç¾æ™‚ï¼Œå¼·çƒˆæç¤ºå¯èƒ½ç™¼ç”Ÿæ°£èƒ¸ï¼Ÿ',
        o: ['ç™¼ç‡’', 'ç©¿åˆºéç¨‹ä¸­å‡ºç¾å‘¼å¸å›°é›£æˆ–å’³å—½', 'ç©¿åˆºéƒ¨ä½ç–¼ç—›', 'é ­æšˆ'],
        c: 1,
        e: 'ç©¿åˆºéç¨‹ä¸­å‡ºç¾å‘¼å¸å›°é›£æˆ–å’³å—½ï¼Œæ°£èƒ¸çš„OR = 69 (95% CI, 3.2-1491)ï¼Œé€™äº›ç—‡ç‹€å‡ºç¾æ™‚æ‡‰ç«‹å³åœæ­¢ä¸¦é€²è¡Œèƒ¸éƒ¨Xå…‰æª¢æŸ¥ã€‚'
    },
    {
        q: 'è‚‹è†œæ¶²/è¡€æ¸…è†½å›ºé†‡æ¯”å€¼ > 0.3 å°è¨ºæ–·æ»²å‡ºæ¶²çš„æ•æ„Ÿåº¦èˆ‡ç‰¹ç•°åº¦åˆ†åˆ¥ç‚ºä½•ï¼Ÿ',
        o: ['æ•æ„Ÿåº¦70%ï¼Œç‰¹ç•°åº¦98%', 'æ•æ„Ÿåº¦93%ï¼Œç‰¹ç•°åº¦94%', 'æ•æ„Ÿåº¦88%ï¼Œç‰¹ç•°åº¦91%', 'æ•æ„Ÿåº¦97%ï¼Œç‰¹ç•°åº¦85%'],
        c: 1,
        e: 'è‚‹è†œæ¶²/è¡€æ¸…è†½å›ºé†‡æ¯”å€¼ > 0.3ï¼šæ•æ„Ÿåº¦93% (95% CI, 90%-96%)ï¼Œç‰¹ç•°åº¦94% (95% CI, 90%-97%)ï¼ŒLR+ = 14ã€‚'
    },
    {
        q: 'æ²»ç™‚æ€§èƒ¸è…”ç©¿åˆºå»ºè­°å–®æ¬¡æŠ½å–çš„æ¶²é«”é‡ä¸Šé™ç‚ºä½•ï¼Ÿ',
        o: ['500 mL', '1000 mL (1 L)', '1500 mL', '2000 mL'],
        c: 1,
        e: 'å»ºè­°å–®æ¬¡æ²»ç™‚æ€§èƒ¸è…”ç©¿åˆºä¸è¦æŠ½å–è¶…é1å…¬å‡çš„æ¶²é«”ï¼Œä»¥é™ä½å†æ“´å¼µæ€§è‚ºæ°´è…«çš„é¢¨éšªã€‚'
    },
    {
        q: 'ä¸‹åˆ—ä½•è€…æ˜¯æ¼å‡ºæ¶²(transudate)å¸¸è¦‹çš„ç—…å› ï¼Ÿ',
        o: ['è‚ºç‚æ—ç©æ¶²', 'æƒ¡æ€§è…«ç˜¤', 'å……è¡€æ€§å¿ƒè¡°ç«­', 'çµæ ¸æ€§èƒ¸è†œç‚'],
        c: 2,
        e: 'å……è¡€æ€§å¿ƒè¡°ç«­å’Œè‚ç¡¬åŒ–æ˜¯æ¼å‡ºæ¶²çš„å¸¸è¦‹ç—…å› ã€‚æ„ŸæŸ“ã€æƒ¡æ€§è…«ç˜¤å’Œç™¼ç‚æ€§ç–¾ç—…å‰‡é€ æˆæ»²å‡ºæ¶²ã€‚'
    },
    {
        q: 'é—œæ–¼èƒ¸è…”ç©¿åˆºå¾Œçš„èƒ¸éƒ¨Xå…‰æª¢æŸ¥ï¼Œä¸‹åˆ—ä½•è€…æ­£ç¢ºï¼Ÿ',
        o: ['æ‰€æœ‰ç—…æ‚£éƒ½éœ€è¦å¸¸è¦åŸ·è¡Œ', 'åƒ…åœ¨ç©¿åˆºéç¨‹ä¸­å‡ºç¾ç—‡ç‹€æˆ–æŠ½å‡ºç©ºæ°£æ™‚æ‰éœ€è¦', 'åƒ…åœ¨æŠ½å–è¶…é500 mLæ™‚éœ€è¦', 'åƒ…åœ¨ä½¿ç”¨å¤§å£å¾‘é‡é ­æ™‚éœ€è¦'],
        c: 1,
        e: 'èƒ¸éƒ¨Xå…‰ä¸éœ€è¦å¸¸è¦åŸ·è¡Œï¼Œä½†ç•¶ç—…æ‚£åœ¨ç©¿åˆºéç¨‹ä¸­å‡ºç¾å‘¼å¸å›°é›£ã€å’³å—½ç­‰ç—‡ç‹€ï¼Œæˆ–æŠ½å‡ºç©ºæ°£æ™‚ï¼Œæ‡‰é€²è¡Œèƒ¸éƒ¨Xå…‰ä»¥æ’é™¤æ°£èƒ¸ã€‚'
    }
];

const App = () => {
    const [page, setPage] = useState('home');
    const [lessonId, setLessonId] = useState(1);
    const [qIdx, setQIdx] = useState(0);
    const [score, setScore] = useState(0);
    const [sel, setSel] = useState(null);
    const [show, setShow] = useState(false);
    const [done, setDone] = useState(false);
    const [quizStartTime, setQuizStartTime] = useState(null);
    const [newBadges, setNewBadges] = useState([]);

    useEffect(() => { if (page === 'quiz' && !done && !quizStartTime) setQuizStartTime(Date.now()) }, [page, done]);
    useEffect(() => {
        if (done && quizStartTime) {
            const t = Math.round((Date.now() - quizStartTime) / 1000);
            ProgressTracker.saveQuizResult(MODULE_ID, score, quiz.length, t);
            if (ProgressTracker.newBadges.length > 0) {
                setNewBadges(ProgressTracker.newBadges);
                setTimeout(() => setNewBadges([]), 5000);
            }
        }
    }, [done]);

    const Header = ({ title }) => (
        <header style={{
            background: '#fff',
            borderBottom: '1px solid rgba(0, 131, 143, 0.1)',
            padding: '14px 16px',
            position: 'sticky',
            top: 0,
            zIndex: 10,
            backdropFilter: 'blur(10px)'
        }}>
            <div style={{ maxWidth: 480, margin: '0 auto', display: 'flex', alignItems: 'center', gap: 12 }}>
                <button
                    onClick={() => page === 'home' ? window.location.href = 'jama-rational-exam.html' : setPage('home')}
                    style={{
                        background: 'linear-gradient(135deg, #E0F7FA, #B2EBF2)',
                        border: 'none',
                        borderRadius: 12,
                        width: 42,
                        height: 42,
                        cursor: 'pointer',
                        color: 'var(--pri)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        boxShadow: '0 2px 8px rgba(0, 131, 143, 0.1)'
                    }}
                >
                    <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </button>
                <span style={{ fontWeight: 700, color: 'var(--txt)', fontSize: 16 }}>{title}</span>
            </div>
        </header>
    );

    const Home = () => (
        <div className="fade-in">
            <Header title="æ»²å‡ºæ€§è‚‹è†œç©æ¶²" />
            <div style={{
                background: 'linear-gradient(135deg, #00838F 0%, #00695C 50%, #004D40 100%)',
                padding: '36px 20px 44px',
                color: '#fff',
                position: 'relative',
                overflow: 'hidden'
            }}>
                <div style={{
                    position: 'absolute',
                    top: -30,
                    right: -30,
                    width: 150,
                    height: 150,
                    borderRadius: '50%',
                    background: 'rgba(255,255,255,0.1)'
                }} />
                <div style={{ maxWidth: 480, margin: '0 auto', position: 'relative', zIndex: 1 }}>
                    <div style={{
                        background: 'rgba(255,255,255,0.2)',
                        display: 'inline-block',
                        padding: '8px 16px',
                        borderRadius: 50,
                        fontSize: 12,
                        fontWeight: 600,
                        marginBottom: 16,
                        backdropFilter: 'blur(10px)'
                    }}>
                        ğŸ« JAMA Rational Clinical Examination
                    </div>
                    <h1 style={{ fontSize: 24, fontWeight: 700, marginBottom: 12, lineHeight: 1.3 }}>
                        Does This Patient Have an Exudative Pleural Effusion?
                    </h1>
                    <p style={{ opacity: 0.95, fontSize: 14, lineHeight: 1.7 }}>
                        æ»²å‡ºæ€§è‚‹è†œç©æ¶²çš„è‡¨åºŠè¨ºæ–·èˆ‡èƒ¸è…”ç©¿åˆº
                    </p>
                    <p style={{ opacity: 0.8, fontSize: 12, marginTop: 8 }}>
                        Wilcox ME, et al. JAMA. 2014;311(23):2422-2431
                    </p>
                    <a
                        href="https://jamanetwork.com/journals/jama/fullarticle/1881316"
                        target="_blank"
                        rel="noopener noreferrer"
                        style={{
                            display:'inline-flex',
                            alignItems:'center',
                            gap:6,
                            background:'rgba(255,255,255,0.25)',
                            color:'#fff',
                            padding:'8px 16px',
                            borderRadius:25,
                            fontSize:13,
                            fontWeight:600,
                            textDecoration:'none',
                            backdropFilter:'blur(10px)',
                            marginTop: 12,
                            transition:'all 0.3s'
                        }}
                    >
                        <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>
                        é–±è®€åŸæ–‡ Read Full Article
                    </a>
                </div>
            </div>

            <div style={{ padding: '0 16px', marginTop: -24 }}>
                <div style={{ maxWidth: 480, margin: '0 auto' }}>
                    <div className="card">
                        <h3 style={{ fontSize: 17, fontWeight: 700, color: 'var(--pri)', marginBottom: 14, display: 'flex', alignItems: 'center', gap: 8 }}>
                            <span style={{ fontSize: 22 }}>ğŸ¯</span> å­¸ç¿’ç›®æ¨™
                        </h3>
                        {[
                            'äº†è§£è‚‹è†œç©æ¶²çš„åˆ†é¡èˆ‡ç—…å› ',
                            'ç†Ÿæ‚‰Lightæ°æº–å‰‡èˆ‡æ›¿ä»£è¨ºæ–·æ¨™æº–',
                            'æŒæ¡å„é …æª¢é©—çš„ä¼¼ç„¶æ¯”èˆ‡è‡¨åºŠæ‡‰ç”¨',
                            'èªè­˜èƒ¸è…”ç©¿åˆºçš„ä½µç™¼ç—‡èˆ‡é é˜²'
                        ].map((t, i) => (
                            <div key={i} style={{ display: 'flex', gap: 12, marginBottom: 10, fontSize: 14 }}>
                                <span style={{
                                    background: 'linear-gradient(135deg, var(--suc), #43A047)',
                                    color: '#fff',
                                    borderRadius: 8,
                                    width: 26,
                                    height: 26,
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    fontSize: 13,
                                    flexShrink: 0,
                                    fontWeight: 600
                                }}>{i + 1}</span>
                                <span style={{ color: 'var(--txt2)', lineHeight: 1.6 }}>{t}</span>
                            </div>
                        ))}
                    </div>

                    <div className="info" style={{ marginBottom: 20 }}>
                        <strong style={{ color: 'var(--info)', display: 'flex', alignItems: 'center', gap: 6 }}>
                            ğŸ’¡ è‡¨åºŠé‡è¦æ€§
                        </strong>
                        <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 8, lineHeight: 1.7 }}>
                            è‚‹è†œç©æ¶²æ˜¯å¸¸è¦‹çš„è‡¨åºŠå•é¡Œï¼Œå€åˆ†æ¼å‡ºæ¶²(transudate)èˆ‡æ»²å‡ºæ¶²(exudate)å°æ–¼ç—…å› è¨ºæ–·å’Œæ²»ç™‚æ–¹å‘è‡³é—œé‡è¦ã€‚èƒ¸è…”ç©¿åˆºæ˜¯æœ€ç›´æ¥çš„è¨ºæ–·æ–¹å¼ï¼Œä½†éœ€äº†è§£å…¶ä½µç™¼ç—‡èˆ‡é é˜²æªæ–½ã€‚
                        </p>
                    </div>

                    <h3 style={{ fontSize: 18, fontWeight: 700, marginBottom: 16, color: 'var(--txt)' }}>ğŸ“š èª²ç¨‹å…§å®¹</h3>
                    {lessons.map(l => (
                        <div
                            key={l.id}
                            className="card"
                            onClick={() => { setLessonId(l.id); setPage('lesson'); }}
                            style={{ cursor: 'pointer', transition: 'all 0.3s ease' }}
                        >
                            <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>
                                <div style={{
                                    width: 52,
                                    height: 52,
                                    borderRadius: 14,
                                    background: `linear-gradient(135deg, ${l.color}, ${l.color}99)`,
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    color: '#fff',
                                    fontWeight: 700,
                                    fontSize: 18,
                                    boxShadow: `0 4px 12px ${l.color}33`
                                }}>{l.id}</div>
                                <div style={{ flex: 1 }}>
                                    <div style={{ fontSize: 11, color: l.color, fontWeight: 600, marginBottom: 2 }}>Lesson {l.id}</div>
                                    <div style={{ fontSize: 16, fontWeight: 700, color: 'var(--txt)' }}>{l.title}</div>
                                    <div style={{ fontSize: 13, color: 'var(--txt2)' }}>{l.sub}</div>
                                </div>
                                <svg viewBox="0 0 24 24" fill={l.color} width="22" height="22">
                                    <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"/>
                                </svg>
                            </div>
                        </div>
                    ))}

                    <button
                        className="btn btn-pri"
                        onClick={() => { setQIdx(0); setScore(0); setSel(null); setShow(false); setDone(false); setPage('quiz'); }}
                        style={{ width: '100%', justifyContent: 'center', marginTop: 24, marginBottom: 16, padding: '16px 24px' }}
                    >
                        ğŸ“ é–‹å§‹æ¸¬é©— (10é¡Œ)
                    </button>

                    <a
                        href="https://jamanetwork.com/journals/jama/fullarticle/1881316"
                        target="_blank"
                        rel="noopener noreferrer"
                        style={{
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            gap: 8,
                            padding: '14px 20px',
                            background: 'linear-gradient(135deg, #F8F9FA, #E9ECEF)',
                            borderRadius: 14,
                            textDecoration: 'none',
                            color: 'var(--pri)',
                            fontSize: 14,
                            fontWeight: 600,
                            marginBottom: 32,
                            border: '1px solid rgba(0, 131, 143, 0.2)'
                        }}
                    >
                        ğŸ“„ é–±è®€åŸæ–‡ (JAMA 2014)
                        <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                            <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
                        </svg>
                    </a>
                </div>
            </div>

            <footer style={{ background: 'linear-gradient(135deg, #E0F7FA, #B2EBF2)', padding: '28px 16px', textAlign: 'center' }}>
                <p style={{ fontSize: 13, color: 'var(--txt2)', fontWeight: 600 }}>æ–°ç«¹å°å¤§åˆ†é™¢æ•™å­¸éƒ¨</p>
                <p style={{ fontSize: 12, color: 'var(--txt2)', marginTop: 4 }}>è¬æ…•æš MD, PhD, FESC | é»ƒæ²›éŠ“ MD | é»ƒåœ‹è‰¯</p>
            </footer>
        </div>
    );

    // Lesson 1: è‚‹è†œç©æ¶²æ¦‚è«–
    const L1 = () => (
        <div className="fade-in">
            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--pri)', marginBottom: 14 }}>ğŸ« ä»€éº¼æ˜¯è‚‹è†œç©æ¶²ï¼Ÿ</h3>
                <p style={{ fontSize: 14, color: 'var(--txt2)', lineHeight: 1.8, marginBottom: 12 }}>
                    è‚‹è†œç©æ¶²(Pleural Effusion)æ˜¯æŒ‡è‚‹è†œè…”å…§æ¶²é«”çš„ç•°å¸¸ç©èšï¼Œå¯ç”±è‚ºéƒ¨ã€è‚‹è†œæˆ–è‚ºå¤–ç–¾ç—…å¼•èµ·ã€‚
                </p>
                <div className="formula">
                    è‚‹è†œç©æ¶² = æ¼å‡ºæ¶² (Transudate) + æ»²å‡ºæ¶² (Exudate)
                </div>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--sec)', marginBottom: 14 }}>ğŸ“Š æ¼å‡ºæ¶² vs æ»²å‡ºæ¶²</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ç‰¹æ€§</th>
                            <th>æ¼å‡ºæ¶² (Transudate)</th>
                            <th>æ»²å‡ºæ¶² (Exudate)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style={{ fontWeight: 600 }}>æ©Ÿè½‰</td>
                            <td>éœæ°´å£“â†‘ æˆ– è† é«”æ»²é€å£“â†“</td>
                            <td>è‚‹è†œé€šé€æ€§â†‘ æˆ– æ·‹å·´é˜»å¡</td>
                        </tr>
                        <tr>
                            <td style={{ fontWeight: 600 }}>å¸¸è¦‹ç—…å› </td>
                            <td>å¿ƒè¡°ç«­ã€è‚ç¡¬åŒ–ã€è…ç—…ç—‡å€™ç¾¤</td>
                            <td>æ„ŸæŸ“ã€æƒ¡æ€§è…«ç˜¤ã€ç™¼ç‚</td>
                        </tr>
                        <tr>
                            <td style={{ fontWeight: 600 }}>è›‹ç™½è³ªå«é‡</td>
                            <td>è¼ƒä½</td>
                            <td>è¼ƒé«˜</td>
                        </tr>
                        <tr>
                            <td style={{ fontWeight: 600 }}>LDHå«é‡</td>
                            <td>è¼ƒä½</td>
                            <td>è¼ƒé«˜</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--info)', marginBottom: 14 }}>ğŸ¥ è‡¨åºŠæƒ…å¢ƒ</h3>
                <div className="info">
                    <strong>å…¸å‹æ¡ˆä¾‹</strong>
                    <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 8, lineHeight: 1.7 }}>
                        74æ­²ç”·æ€§ï¼Œå› å’³å—½ã€å‘¼å¸å›°é›£å’Œç™¼ç‡’å…¥é™¢ã€‚ç—…å²æœ‰å……è¡€æ€§å¿ƒè¡°ç«­ã€‚é«”æº«39Â°Cï¼Œå‘¼å¸é€Ÿç‡26/minï¼Œè¡€æ°§é£½å’Œåº¦86%ï¼Œå·¦ä¸‹è‚ºå©è¨ºæ¿éŸ³ã€‚èƒ¸éƒ¨Xå…‰é¡¯ç¤ºå·¦å´è‚‹è†œç©æ¶²ã€‚
                    </p>
                </div>
                <div className="tip" style={{ marginTop: 14 }}>
                    <strong>ğŸ’¡ è‡¨åºŠæ€è€ƒ</strong>
                    <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 6 }}>
                        æ­¤ç—…æ‚£å¯èƒ½æ˜¯å¿ƒè¡°ç«­é€ æˆçš„æ¼å‡ºæ¶²ï¼Œä¹Ÿå¯èƒ½æ˜¯è‚ºç‚æ—ç©æ¶²(æ»²å‡ºæ¶²)ã€‚éœ€è¦èƒ¸è…”ç©¿åˆºä¾†å€åˆ†ï¼
                    </p>
                </div>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: '#00796B', marginBottom: 14 }}>âš ï¸ ç‚ºä½•å€åˆ†å¾ˆé‡è¦ï¼Ÿ</h3>
                <div style={{ display: 'grid', gap: 10 }}>
                    <div style={{
                        background: 'linear-gradient(135deg, #E0F7FA, #B2EBF2)',
                        padding: '12px 16px',
                        borderRadius: 12,
                        fontSize: 14
                    }}>
                        <strong>æ¼å‡ºæ¶²ï¼š</strong>æ²»ç™‚åŸç™¼ç–¾ç—…(å¦‚åˆ©å°¿åŠ‘æ²»ç™‚å¿ƒè¡°ç«­)
                    </div>
                    <div style={{
                        background: 'linear-gradient(135deg, #E0F7FA, #B2EBF2)',
                        padding: '12px 16px',
                        borderRadius: 12,
                        fontSize: 14
                    }}>
                        <strong>æ»²å‡ºæ¶²ï¼š</strong>éœ€é€²ä¸€æ­¥æª¢æŸ¥ç—…å› (æ„ŸæŸ“ã€æƒ¡æ€§è…«ç˜¤ç­‰)ä¸¦é‡å°ç—…å› æ²»ç™‚
                    </div>
                </div>
            </div>
        </div>
    );

    // Lesson 2: Lightæ°æº–å‰‡
    const L2 = () => (
        <div className="fade-in">
            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--pri)', marginBottom: 14 }}>ğŸ“‹ Lightæ°æº–å‰‡ (Light's Criteria)</h3>
                <p style={{ fontSize: 14, color: 'var(--txt2)', marginBottom: 12, lineHeight: 1.8 }}>
                    Lightæ°æº–å‰‡æ˜¯å€åˆ†æ»²å‡ºæ¶²èˆ‡æ¼å‡ºæ¶²æœ€å¸¸ç”¨çš„æ¨™æº–ï¼Œç¬¦åˆä»¥ä¸‹<strong>ä»»ä¸€é …</strong>å³ç‚ºæ»²å‡ºæ¶²ï¼š
                </p>
                <div style={{ display: 'grid', gap: 10 }}>
                    <div className="score-box">
                        <h4 style={{ color: 'var(--pri)', marginBottom: 8, fontSize: 14 }}>æ¨™æº– 1ï¼šè›‹ç™½è³ªæ¯”å€¼</h4>
                        <div className="formula" style={{ margin: '8px 0', fontSize: 16 }}>
                            è‚‹è†œæ¶²è›‹ç™½ / è¡€æ¸…è›‹ç™½ &gt; 0.5
                        </div>
                    </div>
                    <div className="score-box">
                        <h4 style={{ color: 'var(--sec)', marginBottom: 8, fontSize: 14 }}>æ¨™æº– 2ï¼šLDHæ¯”å€¼</h4>
                        <div className="formula" style={{ margin: '8px 0', fontSize: 16 }}>
                            è‚‹è†œæ¶²LDH / è¡€æ¸…LDH &gt; 0.6
                        </div>
                    </div>
                    <div className="score-box">
                        <h4 style={{ color: '#00796B', marginBottom: 8, fontSize: 14 }}>æ¨™æº– 3ï¼šè‚‹è†œæ¶²LDH</h4>
                        <div className="formula" style={{ margin: '8px 0', fontSize: 16 }}>
                            è‚‹è†œæ¶²LDH &gt; è¡€æ¸…æ­£å¸¸ä¸Šé™çš„ 2/3
                        </div>
                    </div>
                </div>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--sec)', marginBottom: 14 }}>ğŸ“Š Lightæ°æº–å‰‡çš„è¨ºæ–·åƒ¹å€¼</h3>
                <table>
                    <thead>
                        <tr>
                            <th>é …ç›®</th>
                            <th>æ•æ„Ÿåº¦</th>
                            <th>ç‰¹ç•°åº¦</th>
                            <th>LR+</th>
                            <th>LR-</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style={{ fontWeight: 600 }}>è›‹ç™½æ¯”å€¼ &gt;0.5</td>
                            <td>90%</td>
                            <td>90%</td>
                            <td>7.0</td>
                            <td>0.12</td>
                        </tr>
                        <tr>
                            <td style={{ fontWeight: 600 }}>LDHæ¯”å€¼ &gt;0.6</td>
                            <td>88%</td>
                            <td>91%</td>
                            <td>9.2</td>
                            <td>0.14</td>
                        </tr>
                        <tr style={{ background: '#E8F5E9' }}>
                            <td style={{ fontWeight: 700, color: 'var(--suc)' }}>â‰¥1é …ç¬¦åˆ</td>
                            <td>97%</td>
                            <td>85%</td>
                            <td><span className="lr-badge lr-mod">5.2</span></td>
                            <td><span className="lr-badge lr-low">0.04</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div className="good">
                <strong>âœ“ Lightæ°æº–å‰‡çš„å„ªå‹¢</strong>
                <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 6 }}>
                    ç•¶ä¸‰é …æ¨™æº–çš†ä¸ç¬¦åˆæ™‚ï¼Œ<strong>LR- = 0.04</strong>ï¼Œå¯æœ‰æ•ˆæ’é™¤æ»²å‡ºæ¶²ã€‚é«˜æ•æ„Ÿåº¦(97%)ä½¿å…¶æˆç‚ºç¯©æª¢æ»²å‡ºæ¶²çš„è‰¯å¥½å·¥å…·ã€‚
                </p>
            </div>

            <div className="danger">
                <strong>âš ï¸ Lightæ°æº–å‰‡çš„é™åˆ¶</strong>
                <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 6 }}>
                    ä½¿ç”¨Lightæ°æº–å‰‡æ™‚ï¼Œ<strong>7.8%è‡³15%</strong>çš„æ¼å‡ºæ¶²æœƒè¢«èª¤åˆ¤ç‚ºæ»²å‡ºæ¶²ã€‚ç‰¹åˆ¥æ˜¯æ¥å—åˆ©å°¿åŠ‘æ²»ç™‚çš„å¿ƒè¡°ç«­ç—…æ‚£ï¼Œå¯èƒ½å› æ¶²é«”æ¿ƒç¸®è€Œè¢«éŒ¯èª¤åˆ†é¡ã€‚
                </p>
            </div>
        </div>
    );

    // Lesson 3: æ›¿ä»£è¨ºæ–·æŒ‡æ¨™
    const L3 = () => (
        <div className="fade-in">
            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--pri)', marginBottom: 14 }}>ğŸ”¬ æ›¿ä»£è¨ºæ–·æŒ‡æ¨™</h3>
                <p style={{ fontSize: 14, color: 'var(--txt2)', marginBottom: 12, lineHeight: 1.8 }}>
                    é™¤äº†Lightæ°æº–å‰‡ï¼Œé‚„æœ‰å…¶ä»–ç”ŸåŒ–æŒ‡æ¨™å¯å”åŠ©å€åˆ†æ»²å‡ºæ¶²èˆ‡æ¼å‡ºæ¶²ï¼š
                </p>
                <table>
                    <thead>
                        <tr>
                            <th>æª¢é©—é …ç›®</th>
                            <th>é–¾å€¼</th>
                            <th>LR+ (95% CI)</th>
                            <th>LR-</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style={{ background: '#FFEBEE' }}>
                            <td style={{ fontWeight: 700, color: 'var(--danger)' }}>è‚‹è†œæ¶²è†½å›ºé†‡</td>
                            <td>&gt;55 mg/dL</td>
                            <td><span className="lr-badge lr-high">7.1-250</span></td>
                            <td>0.07-0.16</td>
                        </tr>
                        <tr style={{ background: '#FFEBEE' }}>
                            <td style={{ fontWeight: 700, color: 'var(--danger)' }}>è‚‹è†œæ¶²LDH</td>
                            <td>&gt;200 U/L</td>
                            <td><span className="lr-badge lr-high">18 (6.8-46)</span></td>
                            <td>0.32</td>
                        </tr>
                        <tr style={{ background: '#FFF8E1' }}>
                            <td style={{ fontWeight: 600 }}>è†½å›ºé†‡æ¯”å€¼</td>
                            <td>&gt;0.3</td>
                            <td><span className="lr-badge lr-mod">14 (5.5-38)</span></td>
                            <td>0.08</td>
                        </tr>
                        <tr>
                            <td style={{ fontWeight: 600 }}>è‚‹è†œæ¶²è›‹ç™½</td>
                            <td>&gt;3 g/dL</td>
                            <td>5.1 (2.5-11)</td>
                            <td>0.14</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--sec)', marginBottom: 14 }}>â­ æœ€ä½³è¨ºæ–·æŒ‡æ¨™</h3>
                <div className="good">
                    <strong>è‚‹è†œæ¶²è†½å›ºé†‡ &gt; 55 mg/dL</strong>
                    <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 8 }}>
                        æ•æ„Ÿåº¦ï¼š85-94%<br/>
                        ç‰¹ç•°åº¦ï¼š95-99%<br/>
                        <strong>LR+ ç¯„åœï¼š7.1-250</strong> - æ˜¯æ‰€æœ‰å–®ä¸€æŒ‡æ¨™ä¸­æœ€é«˜çš„ï¼
                    </p>
                </div>
                <div className="info" style={{ marginTop: 12 }}>
                    <strong>è‚‹è†œæ¶²LDH &gt; 200 U/L</strong>
                    <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 8 }}>
                        æ•æ„Ÿåº¦ï¼š70%<br/>
                        ç‰¹ç•°åº¦ï¼š98%<br/>
                        <strong>LR+ = 18</strong> - é«˜ç‰¹ç•°åº¦çš„ç¢ºèªæŒ‡æ¨™
                    </p>
                </div>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--info)', marginBottom: 14 }}>ğŸ’¡ è‡¨åºŠæ‡‰ç”¨å»ºè­°</h3>
                <div className="tip">
                    <strong>ç•¶æ‡·ç–‘èª¤åˆ¤æ™‚...</strong>
                    <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 6 }}>
                        è‹¥è‡¨åºŠä¸Šé«˜åº¦æ‡·ç–‘ç‚ºæ¼å‡ºæ¶²(å¦‚å¿ƒè¡°ç«­)ï¼Œä½†Lightæ°æº–å‰‡åˆ¤å®šç‚ºæ»²å‡ºæ¶²æ™‚ï¼Œå¯åŠ é©—ï¼š
                    </p>
                    <ul style={{ marginTop: 8, marginLeft: 16, color: 'var(--txt2)', fontSize: 14 }}>
                        <li>è‚‹è†œæ¶²è†½å›ºé†‡</li>
                        <li>è¡€æ¸…-è‚‹è†œæ¶²ç™½è›‹ç™½æ¢¯åº¦ (SEAG)</li>
                        <li>NT-proBNP (å¿ƒè¡°ç«­ç›¸é—œç©æ¶²)</li>
                    </ul>
                </div>
            </div>
        </div>
    );

    // Lesson 4: èƒ¸è…”ç©¿åˆºä½µç™¼ç—‡
    const L4 = () => (
        <div className="fade-in">
            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--pri)', marginBottom: 14 }}>âš ï¸ èƒ¸è…”ç©¿åˆºä½µç™¼ç—‡</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ä½µç™¼ç—‡</th>
                            <th>ç™¼ç”Ÿç‡ (95% CI)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style={{ background: '#FFEBEE' }}>
                            <td style={{ fontWeight: 700, color: 'var(--danger)' }}>æ°£èƒ¸</td>
                            <td>6.0% (4.0%-7.0%)</td>
                        </tr>
                        <tr>
                            <td style={{ fontWeight: 600 }}>ä¹¾æŠ½ (Dry tap)</td>
                            <td>7.4% (3.8%-13%)</td>
                        </tr>
                        <tr>
                            <td style={{ fontWeight: 600 }}>éœ€æ”¾ç½®èƒ¸ç®¡</td>
                            <td>2.0% (0.99%-2.9%)</td>
                        </tr>
                        <tr>
                            <td style={{ fontWeight: 600 }}>å‡ºè¡€ (è¡€èƒ¸)</td>
                            <td>1.0% (0.0%-1.0%)</td>
                        </tr>
                        <tr>
                            <td>ä½è¡€å£“</td>
                            <td>0.6%-1.7%</td>
                        </tr>
                        <tr>
                            <td>å†æ“´å¼µæ€§è‚ºæ°´è…«</td>
                            <td>0.0%-16%</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--danger)', marginBottom: 14 }}>ğŸš¨ æ°£èƒ¸é¢¨éšªå› å­</h3>
                <table>
                    <thead>
                        <tr>
                            <th>é¢¨éšªå› å­</th>
                            <th>OR (95% CI)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style={{ background: '#FFEBEE' }}>
                            <td style={{ fontWeight: 700 }}>ç©¿åˆºéç¨‹å‡ºç¾ç—‡ç‹€ (å‘¼å¸å›°é›£/å’³å—½)</td>
                            <td><span className="lr-badge lr-high">69 (3.2-1491)</span></td>
                        </tr>
                        <tr style={{ background: '#FFEBEE' }}>
                            <td style={{ fontWeight: 700 }}>æŠ½å‡ºç©ºæ°£</td>
                            <td><span className="lr-badge lr-high">52 (13-216)</span></td>
                        </tr>
                        <tr>
                            <td>å¤šæ¬¡ç©¿åˆºå˜—è©¦</td>
                            <td>2.3 (0.55-9.8)</td>
                        </tr>
                    </tbody>
                </table>
                <div className="danger" style={{ marginTop: 14 }}>
                    <strong>é‡è¦æé†’</strong>
                    <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 6 }}>
                        è‹¥ç—…æ‚£åœ¨ç©¿åˆºéç¨‹ä¸­å‡ºç¾å‘¼å¸å›°é›£æˆ–å’³å—½ï¼Œæˆ–æŠ½å‡ºç©ºæ°£ï¼Œæ‡‰ç«‹å³åœæ­¢ä¸¦å®‰æ’èƒ¸éƒ¨Xå…‰æª¢æŸ¥ï¼
                    </p>
                </div>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--sec)', marginBottom: 14 }}>ğŸ›¡ï¸ é™ä½ä½µç™¼ç—‡çš„æªæ–½</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æªæ–½</th>
                            <th>æ°£èƒ¸ OR (95% CI)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ä½¿ç”¨ç´°é‡ (&lt;20G) vs ç²—é‡</td>
                            <td>0.63 (0.10-4.0)</td>
                        </tr>
                        <tr>
                            <td>æŠ½å– &lt;1L vs &gt;1L</td>
                            <td>1.3 (0.63-2.8)</td>
                        </tr>
                        <tr>
                            <td>è¶…éŸ³æ³¢å®šä½æ¨™è¨˜</td>
                            <td>0.37 (0.08-1.7)</td>
                        </tr>
                        <tr>
                            <td>è¶…éŸ³æ³¢å³æ™‚å°å¼•</td>
                            <td>0.55 (0.06-5.3)</td>
                        </tr>
                    </tbody>
                </table>
                <div className="tip" style={{ marginTop: 14 }}>
                    <strong>ğŸ’¡ è¶…éŸ³æ³¢çš„åƒ¹å€¼</strong>
                    <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 6 }}>
                        é›–ç„¶è¶…éŸ³æ³¢å°é™ä½æ°£èƒ¸çš„æ•ˆæœæœªé”çµ±è¨ˆé¡¯è‘—ï¼Œä½†å°æ–¼<strong>å°é‡æˆ–åˆ†éš”æ€§ç©æ¶²</strong>ï¼Œå¯é¡¯è‘—é™ä½ä¹¾æŠ½é¢¨éšª (OR 0.23)ã€‚
                    </p>
                </div>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--info)', marginBottom: 14 }}>ğŸ“‹ ç©¿åˆºå¾Œèƒ¸éƒ¨Xå…‰</h3>
                <div className="good">
                    <strong>âœ“ ä¸éœ€è¦å¸¸è¦åŸ·è¡Œ</strong>
                    <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 6 }}>
                        ç©¿åˆºå¾Œçš„èƒ¸éƒ¨Xå…‰æª¢æŸ¥ä¸éœ€è¦å¸¸è¦åŸ·è¡Œã€‚
                    </p>
                </div>
                <div className="danger" style={{ marginTop: 12 }}>
                    <strong>âš ï¸ éœ€è¦åŸ·è¡Œçš„æƒ…æ³</strong>
                    <ul style={{ marginTop: 8, marginLeft: 16, color: 'var(--txt2)', fontSize: 14 }}>
                        <li>ç©¿åˆºéç¨‹ä¸­å‡ºç¾å‘¼å¸å›°é›£æˆ–å’³å—½</li>
                        <li>æŠ½å‡ºç©ºæ°£</li>
                        <li>è‡¨åºŠæ‡·ç–‘æ°£èƒ¸</li>
                    </ul>
                </div>
            </div>
        </div>
    );

    // Lesson 5: è‡¨åºŠæ‡‰ç”¨æ•´åˆ
    const L5 = () => (
        <div className="fade-in">
            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--pri)', marginBottom: 14 }}>ğŸ¥ æ¡ˆä¾‹è§£æ</h3>
                <div className="info">
                    <strong>ç—…æ‚£è³‡æ–™</strong>
                    <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 6 }}>
                        74æ­²ç”·æ€§ï¼Œæœ‰å¿ƒè¡°ç«­ç—…å²ï¼Œå› ç™¼ç‡’ã€å’³å—½å…¥é™¢ã€‚è‡¨åºŠåˆ¤æ–·æ»²å‡ºæ¶²æ©Ÿç‡50%ã€‚
                    </p>
                </div>
                <div style={{ marginTop: 14 }}>
                    <h4 style={{ color: 'var(--sec)', marginBottom: 10 }}>ğŸ“‹ èƒ¸è…”ç©¿åˆºçµæœ</h4>
                    <table>
                        <tbody>
                            <tr>
                                <td style={{ fontWeight: 600 }}>è‚‹è†œæ¶²LDH</td>
                                <td>220 U/L (&gt;200)</td>
                                <td style={{ color: 'var(--danger)' }}>LR+ = 18</td>
                            </tr>
                            <tr>
                                <td style={{ fontWeight: 600 }}>è‚‹è†œæ¶²è›‹ç™½</td>
                                <td>54 g/L (&gt;3)</td>
                                <td style={{ color: 'var(--danger)' }}>LR+ = 5.1</td>
                            </tr>
                            <tr>
                                <td style={{ fontWeight: 600 }}>è‚‹è†œæ¶²è†½å›ºé†‡</td>
                                <td>56 mg/dL (&gt;55)</td>
                                <td style={{ color: 'var(--danger)' }}>LR+ = 7.1-250</td>
                            </tr>
                            <tr>
                                <td style={{ fontWeight: 600 }}>è›‹ç™½æ¯”å€¼</td>
                                <td>54/35 = 1.54 (&gt;0.5)</td>
                                <td style={{ color: 'var(--danger)' }}>LR+ = 7.0</td>
                            </tr>
                            <tr>
                                <td style={{ fontWeight: 600 }}>LDHæ¯”å€¼</td>
                                <td>220/342 = 0.64 (&gt;0.6)</td>
                                <td style={{ color: 'var(--danger)' }}>LR+ = 9.2</td>
                            </tr>
                            <tr>
                                <td style={{ fontWeight: 600 }}>è†½å›ºé†‡æ¯”å€¼</td>
                                <td>56/156 = 0.36 (&gt;0.3)</td>
                                <td style={{ color: 'var(--danger)' }}>LR+ = 14</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div className="good" style={{ marginTop: 14 }}>
                    <strong>å¾Œæ¸¬æ©Ÿç‡è¨ˆç®—</strong>
                    <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 6 }}>
                        ä½¿ç”¨æœ€ä¿å®ˆçš„è‚‹è†œæ¶²è›‹ç™½ LR+ = 5.1ï¼š<br/>
                        å‰æ¸¬æ©Ÿç‡ 50% â†’ å¾Œæ¸¬æ©Ÿç‡ <strong>&gt; 84%</strong><br/><br/>
                        <strong>çµè«–ï¼š</strong>æ‰€æœ‰æŒ‡æ¨™ä¸€è‡´æŒ‡å‘æ»²å‡ºæ¶²ï¼Œè¨ºæ–·ç‚ºè‚ºç‚æ—ç©æ¶²ï¼Œé–‹å§‹æŠ—ç”Ÿç´ æ²»ç™‚ä¸¦å¼•æµã€‚
                    </p>
                </div>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--sec)', marginBottom: 14 }}>ğŸ“Š èƒ¸è…”ç©¿åˆºæ­¥é©Ÿ</h3>
                <div style={{ display: 'grid', gap: 10 }}>
                    {[
                        'ç—…æ‚£æ¡åå§¿ï¼Œèº«é«”å‰å‚¾ï¼Œé›™è‡‚é åœ¨åºŠæ—æ¡Œä¸Š',
                        'ç©¿åˆºé»ï¼šç©æ¶²æœ€é«˜è™•ä¸‹æ–¹1-2è‚‹é–“ï¼Œè·è„Šæ¤5-10å…¬åˆ†',
                        'ä¸è¦åœ¨ç¬¬9è‚‹ä»¥ä¸‹ç©¿åˆºï¼ˆé¿å…è…¹è…”å…§æå‚·ï¼‰',
                        'æ¶ˆæ¯’å¾Œï¼Œç”¨25Gç´°é‡å±€éƒ¨éº»é†‰',
                        'ç”¨20Gé‡æ²¿è‚‹éª¨ä¸Šç·£é€²é‡ï¼Œé¿é–‹è‚‹é–“ç¥ç¶“è¡€ç®¡',
                        'æŠ½å–åˆ°ç©æ¶²å¾Œæ³¨å…¥æ›´å¤šéº»é†‰åŠ‘æ–¼å£å±¤è‚‹è†œ',
                        'è¨ºæ–·æ€§ç©¿åˆºæŠ½å–è‡³å°‘10 mLï¼›æ²»ç™‚æ€§ç©¿åˆºä¸è¶…é1 L'
                    ].map((item, i) => (
                        <div key={i} style={{
                            background: 'linear-gradient(135deg, #E0F7FA, #B2EBF2)',
                            padding: '10px 14px',
                            borderRadius: 10,
                            fontSize: 13,
                            display: 'flex',
                            alignItems: 'center',
                            gap: 10
                        }}>
                            <span style={{
                                background: 'var(--pri)',
                                color: '#fff',
                                borderRadius: '50%',
                                width: 22,
                                height: 22,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontSize: 12,
                                fontWeight: 700,
                                flexShrink: 0
                            }}>{i + 1}</span>
                            {item}
                        </div>
                    ))}
                </div>
            </div>

            <div className="card">
                <h3 style={{ fontSize: 18, fontWeight: 700, color: 'var(--suc)', marginBottom: 14 }}>âœ… æ ¸å¿ƒé‡é»ç¸½çµ</h3>
                <div style={{ display: 'grid', gap: 12 }}>
                    {[
                        'Lightæ°æº–å‰‡ä»»ä¸€é …ç¬¦åˆå³ç‚ºæ»²å‡ºæ¶²ï¼ˆæ•æ„Ÿåº¦97%ï¼‰',
                        'ä¸‰é …çš†ä¸ç¬¦åˆå¯æœ‰æ•ˆæ’é™¤æ»²å‡ºæ¶²ï¼ˆLR- = 0.04ï¼‰',
                        'è‚‹è†œæ¶²è†½å›ºé†‡ >55 mg/dL æ˜¯æœ€ä½³å–®ä¸€æŒ‡æ¨™ï¼ˆLR+ 7.1-250ï¼‰',
                        'è‚‹è†œæ¶²LDH >200 U/L æ˜¯é«˜ç‰¹ç•°åº¦ç¢ºèªæŒ‡æ¨™ï¼ˆLR+ = 18ï¼‰',
                        'æ°£èƒ¸æ˜¯æœ€å¸¸è¦‹ä½µç™¼ç—‡ï¼ˆ6%ï¼‰ï¼Œç©¿åˆºä¸­å‡ºç¾ç—‡ç‹€è¦è­¦è¦º',
                        'è¶…éŸ³æ³¢å¯é™ä½ä¹¾æŠ½é¢¨éšªï¼Œå°å°é‡æˆ–åˆ†éš”æ€§ç©æ¶²ç‰¹åˆ¥æœ‰ç”¨',
                        'ç©¿åˆºå¾ŒXå…‰ä¸éœ€å¸¸è¦åŸ·è¡Œï¼Œé™¤éæœ‰ç—‡ç‹€æˆ–æŠ½å‡ºç©ºæ°£'
                    ].map((item, i) => (
                        <div key={i} style={{
                            background: 'linear-gradient(135deg, #E8F5E9, #C8E6C9)',
                            padding: '12px 16px',
                            borderRadius: 12,
                            display: 'flex',
                            alignItems: 'center',
                            gap: 12
                        }}>
                            <span style={{
                                background: 'var(--suc)',
                                color: '#fff',
                                borderRadius: '50%',
                                width: 24,
                                height: 24,
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontSize: 12,
                                fontWeight: 700,
                                flexShrink: 0
                            }}>âœ“</span>
                            <span style={{ fontSize: 14, color: 'var(--txt)' }}>{item}</span>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );

    const Lesson = () => {
        const l = lessons.find(x => x.id === lessonId);
        return (
            <div className="fade-in">
                <Header title={l.title} />
                <div style={{ background: `linear-gradient(135deg, ${l.color}, ${l.color}88)`, padding: '20px', color: '#fff' }}>
                    <div style={{ maxWidth: 480, margin: '0 auto' }}>
                        <div style={{ fontSize: 12, opacity: 0.9 }}>Lesson {l.id} â€¢ {l.sub}</div>
                        <h1 style={{ fontSize: 24, fontWeight: 700 }}>{l.title}</h1>
                    </div>
                </div>
                <div style={{ padding: '20px 16px' }}>
                    <div style={{ maxWidth: 480, margin: '0 auto' }}>
                        {lessonId === 1 && <L1 />}
                        {lessonId === 2 && <L2 />}
                        {lessonId === 3 && <L3 />}
                        {lessonId === 4 && <L4 />}
                        {lessonId === 5 && <L5 />}
                        <div style={{ display: 'flex', gap: 12, marginTop: 24 }}>
                            {lessonId > 1 && (
                                <button className="btn" style={{ flex: 1, background: '#fff', border: '2px solid var(--pri)', color: 'var(--pri)' }} onClick={() => setLessonId(lessonId - 1)}>
                                    â† ä¸Šä¸€èª²
                                </button>
                            )}
                            {lessonId < 5 ? (
                                <button className="btn btn-pri" style={{ flex: 1 }} onClick={() => setLessonId(lessonId + 1)}>
                                    ä¸‹ä¸€èª² â†’
                                </button>
                            ) : (
                                <button className="btn btn-sec" style={{ flex: 1 }} onClick={() => { setQIdx(0); setScore(0); setSel(null); setShow(false); setDone(false); setPage('quiz'); }}>
                                    é–‹å§‹æ¸¬é©— ğŸ“
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const Quiz = () => {
        const pick = (i) => { if (show) return; setSel(i); setShow(true); if (i === quiz[qIdx].c) setScore(score + 1); };
        const next = () => { if (qIdx < quiz.length - 1) { setQIdx(qIdx + 1); setSel(null); setShow(false); } else setDone(true); };

        if (done) {
            const pct = Math.round((score / quiz.length) * 100);
            return (
                <div className="fade-in">
                    <Header title="æ¸¬é©—çµæœ" />
                    <div style={{ padding: '48px 16px', textAlign: 'center' }}>
                        <div style={{
                            width: 150,
                            height: 150,
                            borderRadius: '50%',
                            background: `conic-gradient(${pct >= 80 ? 'var(--suc)' : pct >= 60 ? 'var(--warn)' : 'var(--danger)'} ${pct * 3.6}deg, #E5E5E5 0deg)`,
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            margin: '0 auto 28px',
                            boxShadow: '0 8px 32px rgba(0,0,0,0.1)'
                        }}>
                            <div style={{
                                width: 126,
                                height: 126,
                                borderRadius: '50%',
                                background: '#fff',
                                display: 'flex',
                                flexDirection: 'column',
                                alignItems: 'center',
                                justifyContent: 'center'
                            }}>
                                <div style={{ fontSize: 40, fontWeight: 700, color: 'var(--txt)' }}>{pct}%</div>
                                <div style={{ fontSize: 15, color: 'var(--txt2)' }}>{score}/{quiz.length}</div>
                            </div>
                        </div>
                        <h2 style={{ fontSize: 26, fontWeight: 700, marginBottom: 10 }}>
                            {pct >= 80 ? 'ğŸ‰ å„ªç§€ï¼' : pct >= 60 ? 'ğŸ‘ ä¸éŒ¯ï¼' : 'ğŸ’ª åŠ æ²¹ï¼'}
                        </h2>
                        <p style={{ color: 'var(--txt2)', marginBottom: 36, fontSize: 15 }}>
                            {pct >= 80 ? 'ä½ å°è‚‹è†œç©æ¶²è¨ºæ–·æŒæ¡è‰¯å¥½ï¼' : pct >= 60 ? 'å†è¤‡ç¿’å¯ä»¥æ›´é€²æ­¥ï¼' : 'å»ºè­°é‡æ–°é–±è®€èª²ç¨‹å…§å®¹'}
                        </p>
                        <div style={{ display: 'flex', gap: 14, justifyContent: 'center', flexWrap: 'wrap' }}>
                            <button className="btn btn-pri" onClick={() => { setQIdx(0); setScore(0); setSel(null); setShow(false); setDone(false); }}>
                                é‡æ–°æ¸¬é©—
                            </button>
                            <button className="btn" style={{ background: '#fff', border: '2px solid var(--pri)', color: 'var(--pri)' }} onClick={() => setPage('home')}>
                                è¿”å›èª²ç¨‹
                            </button>
                        </div>
                    </div>
                    <footer style={{ background: 'linear-gradient(135deg, #E0F7FA, #B2EBF2)', padding: '28px 16px', textAlign: 'center', marginTop: 48 }}>
                        <p style={{ fontSize: 12, color: 'var(--txt2)' }}>æ–°ç«¹å°å¤§åˆ†é™¢æ•™å­¸éƒ¨ | è¬æ…•æš MD, PhD, FESC | é»ƒæ²›éŠ“ MD | é»ƒåœ‹è‰¯</p>
                    </footer>
                </div>
            );
        }

        const q = quiz[qIdx];
        return (
            <div className="fade-in">
                <Header title="è‡ªæˆ‘æ¸¬é©—" />
                <div style={{ padding: '20px 16px' }}>
                    <div style={{ maxWidth: 480, margin: '0 auto' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 10, fontSize: 14 }}>
                            <span style={{ color: 'var(--txt2)' }}>é€²åº¦</span>
                            <span style={{ fontWeight: 600, color: 'var(--pri)' }}>{qIdx + 1}/{quiz.length}</span>
                        </div>
                        <div style={{ height: 10, background: '#E5E5E5', borderRadius: 5, marginBottom: 24, overflow: 'hidden' }}>
                            <div style={{
                                height: '100%',
                                width: `${((qIdx + 1) / quiz.length) * 100}%`,
                                background: 'linear-gradient(90deg, var(--pri), var(--pri2))',
                                borderRadius: 5,
                                transition: 'width 0.4s ease'
                            }} />
                        </div>
                        <div className="card">
                            <h3 style={{ fontSize: 16, fontWeight: 600, lineHeight: 1.7, marginBottom: 22, color: 'var(--txt)' }}>{q.q}</h3>
                            {q.o.map((opt, i) => {
                                let bg = '#fff', bd = '#E5E5E5';
                                if (show) {
                                    if (i === q.c) { bg = '#E8F5E9'; bd = 'var(--suc)'; }
                                    else if (i === sel) { bg = '#FFEBEE'; bd = 'var(--danger)'; }
                                } else if (i === sel) { bg = '#E0F7FA'; bd = 'var(--pri)'; }
                                return (
                                    <button
                                        key={i}
                                        onClick={() => pick(i)}
                                        disabled={show}
                                        style={{
                                            width: '100%',
                                            padding: '14px 16px',
                                            marginBottom: 12,
                                            background: bg,
                                            border: `2px solid ${bd}`,
                                            borderRadius: 14,
                                            textAlign: 'left',
                                            fontSize: 14,
                                            cursor: show ? 'default' : 'pointer',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: 14,
                                            transition: 'all 0.2s ease'
                                        }}
                                    >
                                        <span style={{
                                            width: 30,
                                            height: 30,
                                            borderRadius: 10,
                                            background: show && i === q.c ? 'var(--suc)' : show && i === sel ? 'var(--danger)' : 'linear-gradient(135deg, #E0F7FA, #B2EBF2)',
                                            color: show && (i === q.c || i === sel) ? '#fff' : 'var(--pri)',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            fontWeight: 700,
                                            fontSize: 14,
                                            flexShrink: 0
                                        }}>
                                            {show && i === q.c ? 'âœ“' : show && i === sel && i !== q.c ? 'âœ—' : String.fromCharCode(65 + i)}
                                        </span>
                                        <span style={{ lineHeight: 1.6, color: 'var(--txt)' }}>{opt}</span>
                                    </button>
                                );
                            })}
                        </div>
                        {show && (
                            <div className={sel === q.c ? 'good' : 'tip'}>
                                <strong style={{ color: sel === q.c ? 'var(--suc)' : '#F57F17' }}>
                                    {sel === q.c ? 'âœ“ æ­£ç¢ºï¼' : 'âœ— ç­”éŒ¯äº†'}
                                </strong>
                                <p style={{ fontSize: 14, color: 'var(--txt2)', marginTop: 10, lineHeight: 1.8 }}>{q.e}</p>
                            </div>
                        )}
                        {show && (
                            <button className="btn btn-pri" style={{ width: '100%', justifyContent: 'center', marginTop: 20 }} onClick={next}>
                                {qIdx < quiz.length - 1 ? 'ä¸‹ä¸€é¡Œ â†’' : 'æŸ¥çœ‹çµæœ'}
                            </button>
                        )}
                    </div>
                </div>
            </div>
        );
    };

    const closeBadge = (id) => setNewBadges(prev => prev.filter(b => b !== id));

    return (
        <div style={{ maxWidth: '100%', minHeight: '100vh', background: 'var(--bg)' }}>
            <BadgeToast badges={newBadges} onClose={closeBadge} />
            {page === 'home' ? <Home /> : page === 'lesson' ? <Lesson /> : <Quiz />}
        </div>
    );
};

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
