<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¸ç¿’é€²åº¦ | EBM æ•™å­¸å¹³å°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--pri:#0077B6;--pri2:#00B4D8;--acc:#FF6B35;--suc:#2EC4B6;--warn:#FFBE0B;--err:#EF476F;--bg:#FAFBFC;--txt:#1A1A2E;--txt2:#6B7280}
        body{font-family:'Noto Sans TC',sans-serif;background:var(--bg);color:var(--txt);line-height:1.7}
        .card{background:#fff;border-radius:16px;padding:20px;margin-bottom:16px;box-shadow:0 2px 12px rgba(0,119,182,0.08)}
        .btn{padding:14px 24px;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
        .btn-pri{background:linear-gradient(135deg,var(--pri),var(--pri2));color:#fff}
        .btn-danger{background:linear-gradient(135deg,var(--err),#C62828);color:#fff}
        .btn-outline{background:#fff;border:2px solid var(--pri);color:var(--pri)}
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect}=React;

const ProgressTracker = {
    STORAGE_KEY: 'ebm-progress',
    getProgress: () => {
        try {
            const data = localStorage.getItem(ProgressTracker.STORAGE_KEY);
            return data ? JSON.parse(data) : ProgressTracker.initProgress();
        } catch { return ProgressTracker.initProgress(); }
    },
    initProgress: () => ({
        version: 1,
        lastUpdated: new Date().toISOString(),
        modules: {},
        badges: [],
        totalTimeSpent: 0
    }),
    clearProgress: () => {
        localStorage.removeItem(ProgressTracker.STORAGE_KEY);
    },
    exportProgress: () => {
        const data = ProgressTracker.getProgress();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ebm-progress-${new Date().toISOString().slice(0,10)}.json`;
        a.click();
        URL.revokeObjectURL(url);
    }
};

const allModules = [
    { id: 'critical-appraisal', name: 'æ–‡ç»è©•è®€åŸºç¤', shortName: 'è©•è®€', category: 'core', href: 'critical-appraisal.html' },
    { id: 'diagnostic-study', name: 'è¨ºæ–·æ€§ç ”ç©¶è©•è®€', shortName: 'è¨ºæ–·', category: 'core', href: 'diagnostic-study.html' },
    { id: 'prognosis-study', name: 'é å¾Œç ”ç©¶è©•è®€', shortName: 'é å¾Œ', category: 'core', href: 'prognosis-study.html' },
    { id: 'rct-appraisal', name: 'éš¨æ©Ÿå°ç…§è©¦é©—è©•è®€', shortName: 'RCT', category: 'core', href: 'rct-appraisal.html' },
    { id: 'systematic-review', name: 'ç³»çµ±æ€§å›é¡§è©•è®€', shortName: 'SR', category: 'core', href: 'systematic-review.html' },
    { id: 'literature-search', name: 'æ–‡ç»æœå°‹è¨“ç·´', shortName: 'æœå°‹', category: 'core', href: 'literature-search.html' },
    { id: 'jama-chest-pain-acs', name: 'èƒ¸ç—›èˆ‡æ€¥æ€§å† å¿ƒç—‡', shortName: 'ACS', category: 'jama', href: 'jama-chest-pain-acs.html' },
    { id: 'jama-syncope', name: 'æ˜å¥', shortName: 'æ˜å¥', category: 'jama', href: 'jama-syncope.html' },
    { id: 'jama-hypertension', name: 'é«˜è¡€å£“', shortName: 'é«˜è¡€å£“', category: 'jama', href: 'jama-hypertension.html' },
    { id: 'jama-pleural-effusion', name: 'è‚‹è†œç©æ¶²', shortName: 'è‚‹è†œ', category: 'jama', href: 'jama-pleural-effusion.html' },
    { id: 'jama-osa', name: 'é˜»å¡æ€§ç¡çœ å‘¼å¸ä¸­æ­¢', shortName: 'OSA', category: 'jama', href: 'jama-osa.html' },
    { id: 'jama-head-trauma', name: 'é ­éƒ¨å¤–å‚·', shortName: 'é ­å¤–', category: 'jama', href: 'jama-head-trauma.html' },
    { id: 'jama-fluid-responsiveness', name: 'è¼¸æ¶²åæ‡‰æ€§', shortName: 'è¼¸æ¶²', category: 'jama', href: 'jama-fluid-responsiveness.html' },
    { id: 'jama-difficult-intubation', name: 'å›°é›£æ’ç®¡', shortName: 'æ’ç®¡', category: 'jama', href: 'jama-difficult-intubation.html' },
    { id: 'jama-hip-oa', name: 'é«–é—œç¯€éª¨é—œç¯€ç‚', shortName: 'é«–OA', category: 'jama', href: 'jama-hip-oa.html' },
    { id: 'jama-pediatric-htn', name: 'å…’ç«¥é«˜è¡€å£“', shortName: 'å…’é«˜è¡€', category: 'jama', href: 'jama-pediatric-htn.html' },
    { id: 'jama-ectopic-pregnancy', name: 'å­å®®å¤–å­•', shortName: 'å¤–å­•', category: 'jama', href: 'jama-ectopic-pregnancy.html' },
    { id: 'jama-luts-boo', name: 'ä¸‹æ³Œå°¿é“ç—‡ç‹€', shortName: 'LUTS', category: 'jama', href: 'jama-luts-boo.html' }
];

const badgeDefinitions = [
    // Milestone badges (existing)
    { id: 'first-quiz', name: 'åˆè©¦å•¼è²', desc: 'å®Œæˆç¬¬ä¸€æ¬¡æ¸¬é©—', icon: 'ğŸ¯', category: 'milestone' },
    { id: 'five-complete', name: 'å°æœ‰æˆå°±', desc: 'å®Œæˆ5å€‹æ¨¡çµ„', icon: 'â­', category: 'milestone' },
    { id: 'ten-complete', name: 'å­¸æœ‰å°ˆç²¾', desc: 'å®Œæˆ10å€‹æ¨¡çµ„', icon: 'ğŸŒŸ', category: 'milestone' },
    { id: 'master', name: 'EBMå¤§å¸«', desc: 'å®Œæˆå…¨éƒ¨18å€‹æ¨¡çµ„', icon: 'ğŸ‘‘', category: 'milestone' },

    // Achievement badges (existing + new)
    { id: 'perfect-score', name: 'æ»¿åˆ†é”äºº', desc: 'ä»»ä¸€æ¸¬é©—ç²å¾—100åˆ†', icon: 'ğŸ’¯', category: 'achievement' },
    { id: 'speed-demon', name: 'ç¥é€Ÿç­”é¡Œ', desc: '2åˆ†é˜å…§å®Œæˆæ¸¬é©—', icon: 'âš¡', category: 'achievement' },
    { id: 'persistent', name: 'å …æŒä¸æ‡ˆ', desc: 'åŒä¸€æ¸¬é©—é‡è©¦3æ¬¡ä»¥ä¸Š', icon: 'ğŸ’ª', category: 'achievement' },
    { id: 'three-streak', name: 'é€£å‹ä¸‰å ´', desc: 'é€£çºŒä¸‰æ¬¡æ¸¬é©—åŠæ ¼', icon: 'ğŸ”¥', category: 'achievement' },
    { id: 'five-streak', name: 'äº”é€£å‹', desc: 'é€£çºŒäº”æ¬¡æ¸¬é©—åŠæ ¼', icon: 'ğŸ†', category: 'achievement' },
    { id: 'triple-perfect', name: 'ä¸‰å† ç‹', desc: 'é€£çºŒä¸‰æ¬¡æ¸¬é©—æ»¿åˆ†', icon: 'ğŸ‘‘', category: 'achievement' },
    { id: 'comeback-kid', name: 'é€†è½‰å‹', desc: 'å¾ä¸åŠæ ¼é€²æ­¥åˆ°æ»¿åˆ†', icon: 'ğŸš€', category: 'achievement' },
    { id: 'quick-learner', name: 'ä¸€é»å°±é€š', desc: 'é¦–æ¬¡æ¸¬é©—å³æ»¿åˆ†', icon: 'ğŸ’¡', category: 'achievement' },
    { id: 'improvement-king', name: 'é€²æ­¥ç‹', desc: 'åŒä¸€æ¸¬é©—é€²æ­¥5åˆ†ä»¥ä¸Š', icon: 'ğŸ“ˆ', category: 'achievement' },
    { id: 'marathon-runner', name: 'é¦¬æ‹‰æ¾å­¸ç¿’è€…', desc: 'å–®æ—¥å­¸ç¿’è¶…é60åˆ†é˜', icon: 'ğŸƒ', category: 'achievement' },
    { id: 'reviewer', name: 'æº«æ•…çŸ¥æ–°', desc: 'é‡æ¸¬å·²å®Œæˆæ¨¡çµ„ä¸¦åŠæ ¼', icon: 'ğŸ“–', category: 'achievement' },

    // Fun/time-based badges
    { id: 'early-bird', name: 'æ—©èµ·çš„é³¥', desc: 'æ—©ä¸Šå…­é»å‰å®Œæˆæ¸¬é©—', icon: 'ğŸ¦', category: 'fun' },
    { id: 'night-owl', name: 'å¤œè²“å­', desc: 'æ·±å¤œåäºŒé»å¾Œå®Œæˆæ¸¬é©—', icon: 'ğŸ¦‰', category: 'fun' },
    { id: 'weekend-warrior', name: 'å‡æ—¥æˆ°å£«', desc: 'åœ¨é€±æœ«å®Œæˆæ¸¬é©—', icon: 'ğŸ“…', category: 'fun' },
    { id: 'lucky-seven', name: 'å¹¸é‹ä¸ƒ', desc: 'é¦–æ¬¡æ¸¬é©—å‰›å¥½70åˆ†', icon: 'ğŸ€', category: 'fun' },

    // Humorous badges
    { id: 'almost-there', name: 'å·®ä¸€é»é»', desc: 'æ¸¬é©—å¾—åˆ°60åˆ†', icon: 'ğŸ˜…', category: 'humor' },
    { id: 'generous-guesser', name: 'ä½›ç³»ç­”é¡Œ', desc: 'æ¸¬é©—å¾—åˆ†20-30%', icon: 'ğŸ™', category: 'humor' },
    { id: 'learning-worm', name: 'å­¸è¡“èš¯èš“', desc: 'é‡è¤‡åŒä¸€æ¨¡çµ„è¶…é10æ¬¡', icon: 'ğŸª±', category: 'humor' },
    { id: 'eternal-student', name: 'æ°¸æ†çš„å­¸ç”Ÿ', desc: 'æ¸¬é©—50æ¬¡ä»æœªç•¢æ¥­', icon: 'â™¾ï¸', category: 'humor' },
    { id: 'speed-fail', name: 'å…‰é€Ÿé™£äº¡', desc: '30ç§’å…§å®Œæˆæ¸¬é©—ä½†ä¸åŠæ ¼', icon: 'ğŸ’«', category: 'humor' },
    { id: 'slow-and-wrong', name: 'æƒ³å¾ˆä¹…é‚„æ˜¯éŒ¯', desc: 'èŠ±è¶…é10åˆ†é˜ä½†ä¸åŠæ ¼', icon: 'ğŸ¤”', category: 'humor' },
    { id: 'zero-hero', name: 'é›¶åˆ†è‹±é›„', desc: 'æ¸¬é©—å¾—åˆ°0åˆ†', icon: 'ğŸ’€', category: 'humor' },
    { id: 'procrastinator', name: 'æœ€å¾Œä¸€ç§’', desc: 'é€£çºŒ7å¤©æ²’æ´»å‹•å¾Œå›ä¾†', icon: 'â°', category: 'humor' },
    { id: 'deja-vu', name: 'æ—¢è¦–æ„Ÿ', desc: 'åŒä¸€æ¨¡çµ„é€£çºŒä¸‰æ¬¡åŒåˆ†', icon: 'ğŸ‘€', category: 'humor' },
    { id: 'coffee-needed', name: 'éœ€è¦å’–å•¡', desc: 'å‡Œæ™¨2-5é»æ¸¬é©—ä¸åŠæ ¼', icon: 'â˜•', category: 'humor' },
    { id: 'wanderer', name: 'æ¼«éŠè€…', desc: 'é–‹å§‹5å€‹æ¨¡çµ„éƒ½æœªå®Œæˆ', icon: 'ğŸ§­', category: 'humor' },
    { id: 'consistent-output', name: 'ç©©å®šè¼¸å‡º', desc: 'é€£çºŒä¸‰æ¬¡åŒä¸€åˆ†æ•¸', icon: 'ğŸ¯', category: 'humor' },

    // Specialty badges
    { id: 'heart-expert', name: 'å¿ƒè‡Ÿé”äºº', desc: 'å®Œæˆæ‰€æœ‰å¿ƒè¡€ç®¡æ¨¡çµ„', icon: 'â¤ï¸', category: 'specialty' },
    { id: 'critical-master', name: 'æ€¥é‡ç—‡å°ˆå®¶', desc: 'å®Œæˆæ‰€æœ‰é‡ç—‡æ€¥è¨ºæ¨¡çµ„', icon: 'ğŸš¨', category: 'specialty' },
    { id: 'neuro-ninja', name: 'ç¥ç¶“å¿è€…', desc: 'å®Œæˆæ‰€æœ‰ç¥ç¶“ç§‘æ¨¡çµ„', icon: 'ğŸ§ ', category: 'specialty' },
    { id: 'pulm-pro', name: 'èƒ¸è…”é«˜æ‰‹', desc: 'å®Œæˆæ‰€æœ‰èƒ¸è…”æ¨¡çµ„', icon: 'ğŸ«', category: 'specialty' },
    { id: 'ebm-foundation', name: 'EBMåŸºçŸ³', desc: 'å®Œæˆæ‰€æœ‰åŸºç¤è©•è®€èª²ç¨‹', icon: 'ğŸ›ï¸', category: 'specialty' },
    { id: 'jama-collector', name: 'JAMAæ”¶è—å®¶', desc: 'å®Œæˆæ‰€æœ‰JAMAç³»åˆ—', icon: 'ğŸ“š', category: 'specialty' },

    // Meta badges
    { id: 'achievement-hunter', name: 'æˆå°±çµäºº', desc: 'ç²å¾—10å€‹æˆå°±', icon: 'ğŸ…', category: 'meta' },
    { id: 'completionist', name: 'å…¨æˆå°±é”æˆ', desc: 'ç²å¾—æ‰€æœ‰æˆå°±', icon: 'ğŸ–ï¸', category: 'meta' }
];

const badgeCategories = [
    { id: 'all', name: 'å…¨éƒ¨', icon: 'ğŸ“‹' },
    { id: 'milestone', name: 'é‡Œç¨‹ç¢‘', icon: 'ğŸ' },
    { id: 'achievement', name: 'æˆå°±', icon: 'ğŸ†' },
    { id: 'specialty', name: 'å°ˆç§‘', icon: 'ğŸ©º' },
    { id: 'fun', name: 'è¶£å‘³', icon: 'ğŸ‰' },
    { id: 'humor', name: 'æç¬‘', icon: 'ğŸ˜‚' },
    { id: 'meta', name: 'å…ƒæˆå°±', icon: 'ğŸ–ï¸' }
];

const App=()=>{
    const [progress, setProgress] = useState(ProgressTracker.getProgress());
    const [showReset, setShowReset] = useState(false);
    const [badgeCategory, setBadgeCategory] = useState('all');

    useEffect(() => {
        const handleStorage = () => setProgress(ProgressTracker.getProgress());
        window.addEventListener('storage', handleStorage);
        return () => window.removeEventListener('storage', handleStorage);
    }, []);

    const completedCount = Object.values(progress.modules).filter(m => m.completed).length;
    const totalAttempts = Object.values(progress.modules).reduce((sum, m) => sum + (m.totalAttempts || 0), 0);
    const allScores = Object.values(progress.modules).filter(m => m.bestScore > 0);
    const avgScore = allScores.length > 0 ? Math.round(allScores.reduce((sum, m) => sum + (m.bestScore / 10) * 100, 0) / allScores.length) : 0;

    const formatTime = (seconds) => {
        if (!seconds || seconds < 60) return `${seconds || 0} ç§’`;
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        if (mins < 60) return `${mins} åˆ† ${secs} ç§’`;
        const hrs = Math.floor(mins / 60);
        return `${hrs} æ™‚ ${mins % 60} åˆ†`;
    };

    const handleReset = () => {
        ProgressTracker.clearProgress();
        setProgress(ProgressTracker.initProgress());
        setShowReset(false);
    };

    const recentAttempts = Object.entries(progress.modules)
        .flatMap(([modId, mod]) =>
            (mod.allAttempts || []).map(a => ({ ...a, moduleId: modId, moduleName: allModules.find(m => m.id === modId)?.name || modId }))
        )
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 10);

    const earnedBadges = progress.badges || [];
    const earnedBadgeIds = earnedBadges.map(b => b.id);

    return (
        <div style={{maxWidth:'100%',minHeight:'100vh',background:'var(--bg)'}}>
            <header style={{background:'#fff',borderBottom:'1px solid #eee',padding:'12px 16px',position:'sticky',top:0,zIndex:10}}>
                <div style={{maxWidth:800,margin:'0 auto',display:'flex',alignItems:'center',gap:12}}>
                    <button onClick={()=>window.location.href='index.html'} style={{background:'#E3F2FD',border:'none',borderRadius:10,width:40,height:40,cursor:'pointer',color:'var(--pri)',display:'flex',alignItems:'center',justifyContent:'center'}}>
                        <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                    </button>
                    <span style={{fontWeight:700,color:'var(--pri)'}}>å­¸ç¿’é€²åº¦ç¸½è¦½</span>
                </div>
            </header>

            <div style={{background:'linear-gradient(135deg,#0077B6,#00B4D8)',padding:'32px 20px',color:'#fff'}}>
                <div style={{maxWidth:800,margin:'0 auto'}}>
                    <div style={{background:'rgba(255,255,255,0.2)',display:'inline-block',padding:'6px 14px',borderRadius:50,fontSize:12,fontWeight:600,marginBottom:16}}>ğŸ“Š Progress Dashboard</div>
                    <h1 style={{fontSize:26,fontWeight:700,marginBottom:12}}>å­¸ç¿’é€²åº¦ç¸½è¦½</h1>
                    <p style={{opacity:0.9,fontSize:14}}>è¿½è¹¤ä½ çš„ EBM å­¸ç¿’æ­·ç¨‹èˆ‡æˆå°±</p>
                </div>
            </div>

            <div style={{padding:'0 16px',marginTop:-20}}>
                <div style={{maxWidth:800,margin:'0 auto'}}>
                    {/* Summary Cards */}
                    <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(150px, 1fr))',gap:12,marginBottom:24}}>
                        <div className="card" style={{textAlign:'center'}}>
                            <div style={{fontSize:36,fontWeight:700,color:'var(--pri)'}}>{completedCount}</div>
                            <div style={{fontSize:13,color:'var(--txt2)'}}>å®Œæˆæ¨¡çµ„ / 18</div>
                            <div style={{height:6,background:'#E5E5E5',borderRadius:3,marginTop:8}}>
                                <div style={{height:'100%',width:`${(completedCount/18)*100}%`,background:'linear-gradient(90deg,var(--pri),var(--suc))',borderRadius:3}}/>
                            </div>
                        </div>
                        <div className="card" style={{textAlign:'center'}}>
                            <div style={{fontSize:36,fontWeight:700,color:'var(--suc)'}}>{totalAttempts}</div>
                            <div style={{fontSize:13,color:'var(--txt2)'}}>ç¸½æ¸¬é©—æ¬¡æ•¸</div>
                        </div>
                        <div className="card" style={{textAlign:'center'}}>
                            <div style={{fontSize:36,fontWeight:700,color:'var(--acc)'}}>{avgScore}%</div>
                            <div style={{fontSize:13,color:'var(--txt2)'}}>å¹³å‡æœ€ä½³æˆç¸¾</div>
                        </div>
                        <div className="card" style={{textAlign:'center'}}>
                            <div style={{fontSize:24,fontWeight:700,color:'#7209B7'}}>{formatTime(progress.totalTimeSpent)}</div>
                            <div style={{fontSize:13,color:'var(--txt2)'}}>ç¸½å­¸ç¿’æ™‚é–“</div>
                        </div>
                    </div>

                    {/* Progress Chart */}
                    <div className="card">
                        <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri)',marginBottom:16}}>ğŸ“ˆ å„æ¨¡çµ„æˆç¸¾</h3>
                        <div style={{overflowX:'auto',paddingBottom:8}}>
                            <svg width={allModules.length * 44 + 20} height={180} style={{minWidth:'100%'}}>
                                {/* Y-axis labels */}
                                {[0, 25, 50, 75, 100].map((v, i) => (
                                    <g key={v}>
                                        <line x1={35} y1={140 - v * 1.2} x2={allModules.length * 44 + 15} y2={140 - v * 1.2} stroke="#E5E5E5" strokeWidth={1} />
                                        <text x={30} y={144 - v * 1.2} fontSize={10} fill="#999" textAnchor="end">{v}</text>
                                    </g>
                                ))}
                                {/* Bars */}
                                {allModules.map((mod, i) => {
                                    const modData = progress.modules[mod.id];
                                    const score = modData?.bestScore || 0;
                                    const pct = score * 10;
                                    const barHeight = pct * 1.2;
                                    const isCompleted = modData?.completed;
                                    return (
                                        <g key={mod.id} transform={`translate(${40 + i * 44}, 0)`}>
                                            <rect y={140 - barHeight} width={30} height={barHeight} rx={4} fill={isCompleted ? 'var(--suc)' : score > 0 ? 'var(--warn)' : '#E5E5E5'} />
                                            {score > 0 && <text x={15} y={135 - barHeight} fontSize={10} fill={isCompleted ? 'var(--suc)' : 'var(--warn)'} textAnchor="middle" fontWeight="600">{score * 10}</text>}
                                            <text x={15} y={158} fontSize={9} fill="var(--txt2)" textAnchor="middle">{mod.shortName}</text>
                                        </g>
                                    );
                                })}
                            </svg>
                        </div>
                        <div style={{display:'flex',gap:16,marginTop:8,fontSize:12}}>
                            <span><span style={{display:'inline-block',width:12,height:12,background:'var(--suc)',borderRadius:2,marginRight:4}}></span>å·²é€šé (â‰¥70%)</span>
                            <span><span style={{display:'inline-block',width:12,height:12,background:'var(--warn)',borderRadius:2,marginRight:4}}></span>é€²è¡Œä¸­</span>
                            <span><span style={{display:'inline-block',width:12,height:12,background:'#E5E5E5',borderRadius:2,marginRight:4}}></span>å°šæœªé–‹å§‹</span>
                        </div>
                    </div>

                    {/* Badges */}
                    <div className="card">
                        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:16}}>
                            <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri)'}}>ğŸ† æˆå°±å¾½ç« </h3>
                            <div style={{fontSize:13,color:'var(--suc)',fontWeight:600}}>{earnedBadges.length} / {badgeDefinitions.length}</div>
                        </div>
                        {/* Category tabs */}
                        <div style={{display:'flex',gap:8,marginBottom:16,overflowX:'auto',paddingBottom:4}}>
                            {badgeCategories.map(cat => (
                                <button key={cat.id} onClick={()=>setBadgeCategory(cat.id)} style={{
                                    padding:'6px 12px',border:'none',borderRadius:20,fontSize:12,fontWeight:600,cursor:'pointer',whiteSpace:'nowrap',
                                    background:badgeCategory===cat.id?'var(--pri)':'#F0F0F0',color:badgeCategory===cat.id?'#fff':'var(--txt2)'
                                }}>{cat.icon} {cat.name}</button>
                            ))}
                        </div>
                        <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill, minmax(100px, 1fr))',gap:12}}>
                            {badgeDefinitions.filter(b=>badgeCategory==='all'||b.category===badgeCategory).map(badge => {
                                const earned = earnedBadgeIds.includes(badge.id);
                                const earnedData = earnedBadges.find(b => b.id === badge.id);
                                const catInfo = badgeCategories.find(c=>c.id===badge.category);
                                return (
                                    <div key={badge.id} style={{textAlign:'center',padding:12,background:earned?'#F0FFF4':'#F5F5F5',borderRadius:12,opacity:earned?1:0.5,position:'relative'}}>
                                        {badge.category==='humor'&&<div style={{position:'absolute',top:4,right:4,fontSize:10}}>ğŸ˜‚</div>}
                                        <div style={{fontSize:32}}>{earned ? badge.icon : 'ğŸ”’'}</div>
                                        <div style={{fontSize:12,fontWeight:600,marginTop:4,color:earned?'var(--suc)':'#999'}}>{badge.name}</div>
                                        <div style={{fontSize:10,color:'var(--txt2)',marginTop:2}}>{badge.desc}</div>
                                        {earned && earnedData && (
                                            <div style={{fontSize:9,color:'var(--suc)',marginTop:4}}>{new Date(earnedData.earnedAt).toLocaleDateString()}</div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* Module Grid */}
                    <div className="card">
                        <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri)',marginBottom:16}}>ğŸ“š æ¨¡çµ„é€²åº¦</h3>
                        <div style={{marginBottom:12}}>
                            <span style={{fontSize:13,fontWeight:600,color:'var(--txt2)'}}>åŸºç¤è©•è®€èª²ç¨‹</span>
                        </div>
                        <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill, minmax(140px, 1fr))',gap:10,marginBottom:20}}>
                            {allModules.filter(m=>m.category==='core').map(mod => {
                                const modData = progress.modules[mod.id];
                                const isCompleted = modData?.completed;
                                const score = modData?.bestScore || 0;
                                return (
                                    <a key={mod.id} href={mod.href} style={{textDecoration:'none',padding:12,background:isCompleted?'#F0FFF4':'#FAFAFA',border:`2px solid ${isCompleted?'var(--suc)':'#E5E5E5'}`,borderRadius:10}}>
                                        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                                            <span style={{fontSize:12,fontWeight:600,color:isCompleted?'var(--suc)':'var(--txt)'}}>{mod.name}</span>
                                            {isCompleted && <span>âœ…</span>}
                                        </div>
                                        {score > 0 && <div style={{fontSize:11,color:'var(--txt2)',marginTop:4}}>æœ€ä½³ï¼š{score*10}%</div>}
                                        {modData?.totalAttempts > 0 && <div style={{fontSize:10,color:'var(--txt2)'}}>æ¸¬é©— {modData.totalAttempts} æ¬¡</div>}
                                    </a>
                                );
                            })}
                        </div>
                        <div style={{marginBottom:12}}>
                            <span style={{fontSize:13,fontWeight:600,color:'var(--txt2)'}}>JAMA ç†å­¸æª¢æŸ¥ç³»åˆ—</span>
                        </div>
                        <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill, minmax(140px, 1fr))',gap:10}}>
                            {allModules.filter(m=>m.category==='jama').map(mod => {
                                const modData = progress.modules[mod.id];
                                const isCompleted = modData?.completed;
                                const score = modData?.bestScore || 0;
                                return (
                                    <a key={mod.id} href={mod.href} style={{textDecoration:'none',padding:12,background:isCompleted?'#F0FFF4':'#FAFAFA',border:`2px solid ${isCompleted?'var(--suc)':'#E5E5E5'}`,borderRadius:10}}>
                                        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                                            <span style={{fontSize:12,fontWeight:600,color:isCompleted?'var(--suc)':'var(--txt)'}}>{mod.name}</span>
                                            {isCompleted && <span>âœ…</span>}
                                        </div>
                                        {score > 0 && <div style={{fontSize:11,color:'var(--txt2)',marginTop:4}}>æœ€ä½³ï¼š{score*10}%</div>}
                                        {modData?.totalAttempts > 0 && <div style={{fontSize:10,color:'var(--txt2)'}}>æ¸¬é©— {modData.totalAttempts} æ¬¡</div>}
                                    </a>
                                );
                            })}
                        </div>
                    </div>

                    {/* Recent Activity */}
                    <div className="card">
                        <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri)',marginBottom:16}}>ğŸ“… æœ€è¿‘æ´»å‹•</h3>
                        {recentAttempts.length === 0 ? (
                            <p style={{color:'var(--txt2)',fontSize:14,textAlign:'center',padding:20}}>å°šç„¡æ¸¬é©—è¨˜éŒ„ï¼Œé–‹å§‹å­¸ç¿’å§ï¼</p>
                        ) : (
                            <div>
                                {recentAttempts.map((attempt, i) => (
                                    <div key={i} style={{display:'flex',alignItems:'center',gap:12,padding:'10px 0',borderBottom:i<recentAttempts.length-1?'1px solid #eee':'none'}}>
                                        <div style={{width:36,height:36,borderRadius:8,background:attempt.score>=7?'#E8F5E9':'#FFF3E0',display:'flex',alignItems:'center',justifyContent:'center',fontSize:14}}>
                                            {attempt.score>=7?'âœ…':'ğŸ“'}
                                        </div>
                                        <div style={{flex:1}}>
                                            <div style={{fontSize:13,fontWeight:600}}>{attempt.moduleName}</div>
                                            <div style={{fontSize:11,color:'var(--txt2)'}}>{new Date(attempt.date).toLocaleString()}</div>
                                        </div>
                                        <div style={{textAlign:'right'}}>
                                            <div style={{fontSize:14,fontWeight:700,color:attempt.score>=7?'var(--suc)':'var(--acc)'}}>{attempt.score*10}%</div>
                                            <div style={{fontSize:10,color:'var(--txt2)'}}>{formatTime(attempt.timeSpent)}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Actions */}
                    <div className="card" style={{marginBottom:32}}>
                        <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri)',marginBottom:16}}>âš™ï¸ è³‡æ–™ç®¡ç†</h3>
                        <div style={{display:'flex',gap:12,flexWrap:'wrap'}}>
                            <button className="btn btn-outline" onClick={ProgressTracker.exportProgress}>
                                ğŸ“¥ åŒ¯å‡ºé€²åº¦
                            </button>
                            <button className="btn btn-danger" onClick={()=>setShowReset(true)}>
                                ğŸ—‘ï¸ é‡ç½®é€²åº¦
                            </button>
                        </div>
                        {showReset && (
                            <div style={{marginTop:16,padding:16,background:'#FFEBEE',borderRadius:12}}>
                                <p style={{fontSize:14,color:'var(--err)',marginBottom:12}}>âš ï¸ ç¢ºå®šè¦é‡ç½®æ‰€æœ‰å­¸ç¿’é€²åº¦å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼</p>
                                <div style={{display:'flex',gap:12}}>
                                    <button className="btn btn-danger" onClick={handleReset}>ç¢ºå®šé‡ç½®</button>
                                    <button className="btn btn-outline" onClick={()=>setShowReset(false)}>å–æ¶ˆ</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            </div>

            <footer style={{background:'#E3F2FD',padding:'24px 16px',textAlign:'center'}}>
                <p style={{fontSize:13,color:'var(--txt2)'}}>æ–°ç«¹å°å¤§åˆ†é™¢æ•™å­¸éƒ¨</p>
                <p style={{fontSize:12,color:'var(--txt2)'}}>è¬æ…•æš MD, PhD, FESC | é»ƒæ²›éŠ“ MD | é»ƒåœ‹è‰¯</p>
            </footer>
        </div>
    );
};

ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
