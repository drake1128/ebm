<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨ºæ–·æ€§ç ”ç©¶è©•è®€ | EBM æ•™å­¸å¹³å°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --pri:#F72585;
            --pri2:#B5179E;
            --blue:#0077B6;
            --pur:#7209B7;
            --teal:#2EC4B6;
            --orange:#FF6B35;
            --suc:#38A169;
            --warn:#D69E2E;
            --err:#E53E3E;
            --bg:#FFF5F8;
            --txt:#1A1A2E;
            --txt2:#6B7280
        }
        body{font-family:'Noto Sans TC',sans-serif;background:var(--bg);color:var(--txt);line-height:1.7}
        .card{background:#fff;border-radius:16px;padding:20px;margin-bottom:16px;box-shadow:0 2px 12px rgba(247,37,133,0.08)}
        .btn{padding:14px 24px;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px;transition:all 0.3s}
        .btn-pri{background:linear-gradient(135deg,var(--pri),var(--pri2));color:#fff}
        .btn-pri:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(247,37,133,0.3)}
        table{width:100%;border-collapse:collapse;font-size:13px;margin:12px 0}
        th,td{padding:10px;text-align:center;border-bottom:1px solid #eee}
        th{background:#FFF0F5;font-weight:600;color:var(--pri)}
        .formula{background:linear-gradient(135deg,#FFF0F5,#FFE4EC);border:2px solid var(--pri);border-radius:12px;padding:16px;margin:12px 0;text-align:center;font-size:16px;color:#9D174D;font-weight:600}
        .tip{background:#FFFBEB;border-left:4px solid var(--warn);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .good{background:#F0FFF4;border-left:4px solid var(--suc);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .info{background:#EBF8FF;border-left:4px solid var(--blue);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .warn{background:#FFF5F5;border-left:4px solid var(--err);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .purple{background:#FAF5FF;border-left:4px solid var(--pur);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .pink{background:#FFF0F5;border-left:4px solid var(--pri);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .roc-container{background:#fff;border:2px solid #E2E8F0;border-radius:12px;padding:16px;margin:12px 0}
        .two-by-two{background:#F8F9FA;border-radius:12px;overflow:hidden;margin:12px 0}
        .two-by-two table{margin:0}
        .two-by-two th,.two-by-two td{border:1px solid #E2E8F0}
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect}=React;

const MODULE_ID='diagnostic-study';

// Badge definitions for notifications
const badgeDefs = {
    'first-quiz': { name: 'åˆè©¦å•¼è²', icon: 'ğŸ¯' },
    'perfect-score': { name: 'æ»¿åˆ†é”äºº', icon: 'ğŸ’¯' },
    'five-complete': { name: 'å°æœ‰æˆå°±', icon: 'â­' },
    'ten-complete': { name: 'å­¸æœ‰å°ˆç²¾', icon: 'ğŸŒŸ' },
    'master': { name: 'EBMå¤§å¸«', icon: 'ğŸ‘‘' },
    'speed-demon': { name: 'ç¥é€Ÿç­”é¡Œ', icon: 'âš¡' },
    'persistent': { name: 'å …æŒä¸æ‡ˆ', icon: 'ğŸ’ª' },
    'three-streak': { name: 'é€£å‹ä¸‰å ´', icon: 'ğŸ”¥' },
    'five-streak': { name: 'äº”é€£å‹', icon: 'ğŸ†' },
    'triple-perfect': { name: 'ä¸‰å† ç‹', icon: 'ğŸ‘‘' },
    'early-bird': { name: 'æ—©èµ·çš„é³¥', icon: 'ğŸ¦' },
    'night-owl': { name: 'å¤œè²“å­', icon: 'ğŸ¦‰' },
    'weekend-warrior': { name: 'å‡æ—¥æˆ°å£«', icon: 'ğŸ“…' },
    'comeback-kid': { name: 'é€†è½‰å‹', icon: 'ğŸš€' },
    'quick-learner': { name: 'ä¸€é»å°±é€š', icon: 'ğŸ’¡' },
    'improvement-king': { name: 'é€²æ­¥ç‹', icon: 'ğŸ“ˆ' },
    'marathon-runner': { name: 'é¦¬æ‹‰æ¾å­¸ç¿’è€…', icon: 'ğŸƒ' },
    'reviewer': { name: 'æº«æ•…çŸ¥æ–°', icon: 'ğŸ“–' },
    'almost-there': { name: 'å·®ä¸€é»é»', icon: 'ğŸ˜…' },
    'generous-guesser': { name: 'ä½›ç³»ç­”é¡Œ', icon: 'ğŸ™' },
    'learning-worm': { name: 'å­¸è¡“èš¯èš“', icon: 'ğŸª±' },
    'eternal-student': { name: 'æ°¸æ†çš„å­¸ç”Ÿ', icon: 'â™¾ï¸' },
    'speed-fail': { name: 'å…‰é€Ÿé™£äº¡', icon: 'ğŸ’«' },
    'slow-and-wrong': { name: 'æƒ³å¾ˆä¹…é‚„æ˜¯éŒ¯', icon: 'ğŸ¤”' },
    'zero-hero': { name: 'é›¶åˆ†è‹±é›„', icon: 'ğŸ’€' },
    'procrastinator': { name: 'æœ€å¾Œä¸€ç§’', icon: 'â°' },
    'deja-vu': { name: 'æ—¢è¦–æ„Ÿ', icon: 'ğŸ‘€' },
    'coffee-needed': { name: 'éœ€è¦å’–å•¡', icon: 'â˜•' },
    'wanderer': { name: 'æ¼«éŠè€…', icon: 'ğŸ§­' },
    'consistent-output': { name: 'ç©©å®šè¼¸å‡º', icon: 'ğŸ¯' },
    'heart-expert': { name: 'å¿ƒè‡Ÿé”äºº', icon: 'â¤ï¸' },
    'critical-master': { name: 'æ€¥é‡ç—‡å°ˆå®¶', icon: 'ğŸš¨' },
    'neuro-ninja': { name: 'ç¥ç¶“å¿è€…', icon: 'ğŸ§ ' },
    'pulm-pro': { name: 'èƒ¸è…”é«˜æ‰‹', icon: 'ğŸ«' },
    'ebm-foundation': { name: 'EBMåŸºçŸ³', icon: 'ğŸ›ï¸' },
    'jama-collector': { name: 'JAMAæ”¶è—å®¶', icon: 'ğŸ“š' },
    'achievement-hunter': { name: 'æˆå°±çµäºº', icon: 'ğŸ…' },
    'lucky-seven': { name: 'å¹¸é‹ä¸ƒ', icon: 'ğŸ€' },
    'completionist': { name: 'å…¨æˆå°±é”æˆ', icon: 'ğŸ–ï¸' }
};

const categoryModules = {
    cardio: ['jama-chest-pain-acs', 'jama-syncope', 'jama-hypertension'],
    critical: ['jama-bacteremia', 'jama-gi-bleed', 'jama-fluid-responsiveness', 'jama-difficult-intubation', 'jama-cirrhosis', 'jama-wound-infection'],
    neuro: ['jama-head-trauma', 'jama-delirium', 'jama-decision-capacity'],
    pulm: ['jama-pleural-effusion', 'jama-osa'],
    core: ['critical-appraisal', 'diagnostic-study', 'prognosis-study', 'rct-appraisal', 'systematic-review', 'literature-search']
};

const ProgressTracker={
    STORAGE_KEY:'ebm-progress',
    newBadges: [],
    getProgress:()=>{try{const d=localStorage.getItem(ProgressTracker.STORAGE_KEY);return d?JSON.parse(d):{version:1,modules:{},badges:[],totalTimeSpent:0,streakData:{currentPassStreak:0,currentPerfectStreak:0},lastActivityDate:null}}catch{return{version:1,modules:{},badges:[],totalTimeSpent:0,streakData:{currentPassStreak:0,currentPerfectStreak:0},lastActivityDate:null}}},
    saveQuizResult:(moduleId,score,total,timeSpent)=>{
        ProgressTracker.newBadges = [];
        const progress=ProgressTracker.getProgress();
        const mod=progress.modules[moduleId]||{bestScore:0,totalAttempts:0,allAttempts:[],lessonsViewed:[],completed:false,firstCompleted:null};
        const attempt={date:new Date().toISOString(),score,timeSpent};
        mod.allAttempts.push(attempt);mod.totalAttempts++;
        if(score>mod.bestScore)mod.bestScore=score;
        const passingScore=Math.ceil(total*0.7);
        if(score>=passingScore&&!mod.completed){mod.completed=true;mod.firstCompleted=attempt.date}
        progress.modules[moduleId]=mod;progress.totalTimeSpent+=timeSpent;progress.lastUpdated=new Date().toISOString();
        ProgressTracker.checkBadges(progress,moduleId,score,total,timeSpent);
        localStorage.setItem(ProgressTracker.STORAGE_KEY,JSON.stringify(progress));return progress;
    },
    checkBadges:(progress,moduleId,score,total,timeSpent)=>{
        const badges=progress.badges||[];const ids=badges.map(b=>b.id);const now=new Date();const nowStr=now.toISOString();
        const hour=now.getHours();const day=now.getDay();
        const passed=score>=Math.ceil(total*0.7);const perfect=score===total;
        const addBadge=(id)=>{if(!ids.includes(id)){badges.push({id,earnedAt:nowStr});ids.push(id);ProgressTracker.newBadges.push(id);return true}return false};

        addBadge('first-quiz');
        if(perfect)addBadge('perfect-score');
        if(timeSpent<120&&passed)addBadge('speed-demon');
        const completed=Object.values(progress.modules).filter(m=>m.completed).length;
        if(completed>=5)addBadge('five-complete');
        if(completed>=10)addBadge('ten-complete');
        if(completed>=18)addBadge('master');
        const mod=progress.modules[moduleId];
        if(mod&&mod.totalAttempts>=3)addBadge('persistent');

        if(hour<6)addBadge('early-bird');
        if(hour>=0&&hour<5)addBadge('night-owl');
        if(day===0||day===6)addBadge('weekend-warrior');
        if(hour>=2&&hour<5&&!passed)addBadge('coffee-needed');

        const streakData=progress.streakData||{currentPassStreak:0,currentPerfectStreak:0};
        if(passed){streakData.currentPassStreak++;if(perfect)streakData.currentPerfectStreak++;else streakData.currentPerfectStreak=0}
        else{streakData.currentPassStreak=0;streakData.currentPerfectStreak=0}
        if(streakData.currentPassStreak>=3)addBadge('three-streak');
        if(streakData.currentPassStreak>=5)addBadge('five-streak');
        if(streakData.currentPerfectStreak>=3)addBadge('triple-perfect');
        progress.streakData=streakData;

        if(mod){
            if(mod.totalAttempts===1&&perfect)addBadge('quick-learner');
            if(mod.totalAttempts===1&&score===7)addBadge('lucky-seven');
            if(mod.allAttempts&&mod.allAttempts.length>1){
                const firstScore=mod.allAttempts[0].score;
                if(firstScore<7&&perfect)addBadge('comeback-kid');
                if(score-firstScore>=5)addBadge('improvement-king');
                const lastThree=mod.allAttempts.slice(-3);
                if(lastThree.length===3&&lastThree[0].score===lastThree[1].score&&lastThree[1].score===lastThree[2].score)addBadge('deja-vu');
                if(lastThree.length===3&&lastThree.every(a=>a.score===score))addBadge('consistent-output');
            }
            if(mod.totalAttempts>=10)addBadge('learning-worm');
            if(mod.completed&&mod.totalAttempts>1&&passed)addBadge('reviewer');
        }

        if(score===6)addBadge('almost-there');
        if(score===0)addBadge('zero-hero');
        if(score>=2&&score<=3)addBadge('generous-guesser');
        if(timeSpent<30&&!passed)addBadge('speed-fail');
        if(timeSpent>600&&!passed)addBadge('slow-and-wrong');

        const totalAttempts=Object.values(progress.modules).reduce((sum,m)=>sum+(m.totalAttempts||0),0);
        if(totalAttempts>=50&&completed<18)addBadge('eternal-student');
        const startedNotCompleted=Object.values(progress.modules).filter(m=>m.totalAttempts>0&&!m.completed).length;
        if(startedNotCompleted>=5&&completed===0)addBadge('wanderer');

        if(progress.lastActivityDate){
            const lastActivity=new Date(progress.lastActivityDate);
            const daysSince=(now-lastActivity)/(1000*60*60*24);
            if(daysSince>=7)addBadge('procrastinator');
        }
        progress.lastActivityDate=nowStr;

        const checkCat=(cat,badgeId)=>{const mods=categoryModules[cat]||[];if(mods.length>0&&mods.every(id=>progress.modules[id]?.completed))addBadge(badgeId)};
        checkCat('cardio','heart-expert');
        checkCat('critical','critical-master');
        checkCat('neuro','neuro-ninja');
        checkCat('pulm','pulm-pro');
        checkCat('core','ebm-foundation');
        const jamaComplete=Object.keys(progress.modules).filter(k=>k.startsWith('jama-')&&progress.modules[k]?.completed).length;
        if(jamaComplete>=12)addBadge('jama-collector');

        if(badges.length>=10)addBadge('achievement-hunter');
        if(badges.length>=39)addBadge('completionist');

        progress.badges=badges;
    }
};

const BadgeToast = ({ badges, onClose }) => {
    if (!badges || badges.length === 0) return null;
    return (
        <div style={{position:'fixed',top:20,right:20,zIndex:9999,display:'flex',flexDirection:'column',gap:10}}>
            {badges.map((badgeId, i) => {
                const badge = badgeDefs[badgeId];
                if (!badge) return null;
                return (
                    <div key={badgeId} style={{
                        background:'linear-gradient(135deg, #FFD700, #FFA500)',
                        padding:'16px 20px',borderRadius:16,boxShadow:'0 8px 32px rgba(0,0,0,0.2)',
                        display:'flex',alignItems:'center',gap:12,animation:'slideIn 0.5s ease-out',minWidth:240
                    }}>
                        <span style={{fontSize:36}}>{badge.icon}</span>
                        <div style={{flex:1}}>
                            <div style={{fontSize:12,fontWeight:600,color:'#5D4037'}}>æ–°æˆå°±è§£é–!</div>
                            <div style={{fontSize:16,fontWeight:700,color:'#3E2723'}}>{badge.name}</div>
                        </div>
                        <button onClick={()=>onClose(badgeId)} style={{background:'rgba(0,0,0,0.1)',border:'none',borderRadius:8,width:28,height:28,cursor:'pointer',fontSize:14}}>âœ•</button>
                    </div>
                );
            })}
            <style>{`@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}`}</style>
        </div>
    );
};

const lessons=[
    {id:1,title:'è¨ºæ–·ç ”ç©¶åŸºæœ¬æ¦‚å¿µ',sub:'Diagnostic Study Basics',color:'#F72585'},
    {id:2,title:'æ•æ„Ÿåº¦ã€ç‰¹ç•°åº¦èˆ‡é æ¸¬å€¼',sub:'Sensitivity, Specificity & Predictive Values',color:'#0077B6'},
    {id:3,title:'ä¼¼ç„¶æ¯”èˆ‡è¨ºæ–·å‹ç®—æ¯”',sub:'Likelihood Ratios & DOR',color:'#7209B7'},
    {id:4,title:'ROC æ›²ç·šåˆ†æ',sub:'ROC Curve Analysis',color:'#2EC4B6'},
    {id:5,title:'STARD æŒ‡å¼•èˆ‡è‡¨åºŠæ‡‰ç”¨',sub:'STARD Guidelines & Clinical Application',color:'#FF6B35'}
];

const quiz=[
    {q:'è¨ºæ–·æ€§ç ”ç©¶ä¸­ï¼Œã€Œåƒè€ƒæ¨™æº–ï¼ˆReference Standardï¼‰ã€çš„å®šç¾©ç‚ºä½•ï¼Ÿ',o:['æœ€å¸¸ä½¿ç”¨çš„è¨ºæ–·æ–¹æ³•','ç›®å‰èªå®šæœ€èƒ½ç¢ºèªç–¾ç—…ç‹€æ…‹çš„æ–¹æ³•','æœ€æ–°ç™¼å±•çš„è¨ºæ–·æŠ€è¡“','æˆæœ¬æœ€ä½çš„è¨ºæ–·æ–¹å¼'],c:1,e:'åƒè€ƒæ¨™æº–ï¼ˆåˆç¨±é»ƒé‡‘æ¨™æº–ï¼‰æ˜¯ç›®å‰èªå®šæœ€èƒ½æ­£ç¢ºåˆ¤å®šç–¾ç—…æœ‰ç„¡çš„æ–¹æ³•ï¼Œç”¨ä¾†è©•ä¼°å¾…æ¸¬è©¦é©—çš„è¨ºæ–·æº–ç¢ºåº¦ã€‚'},
    {q:'æ•æ„Ÿåº¦ï¼ˆSensitivityï¼‰çš„æ­£ç¢ºå®šç¾©ç‚ºä½•ï¼Ÿ',o:['æª¢é©—é™½æ€§è€…ä¸­ï¼ŒçœŸæ­£æœ‰ç—…çš„æ¯”ä¾‹','æª¢é©—é™°æ€§è€…ä¸­ï¼ŒçœŸæ­£æ²’ç—…çš„æ¯”ä¾‹','æœ‰ç—…è€…ä¸­ï¼Œæª¢é©—çµæœç‚ºé™½æ€§çš„æ¯”ä¾‹','æ²’ç—…è€…ä¸­ï¼Œæª¢é©—çµæœç‚ºé™°æ€§çš„æ¯”ä¾‹'],c:2,e:'æ•æ„Ÿåº¦ = TP/(TP+FN)ï¼Œä»£è¡¨æ‰€æœ‰çœŸæ­£æœ‰ç—…çš„äººä¸­ï¼Œè¢«æª¢é©—æ­£ç¢ºè­˜åˆ¥ç‚ºé™½æ€§çš„æ¯”ä¾‹ã€‚'},
    {q:'ç‰¹ç•°åº¦ï¼ˆSpecificityï¼‰çš„æ­£ç¢ºå®šç¾©ç‚ºä½•ï¼Ÿ',o:['æª¢é©—é™½æ€§è€…ä¸­ï¼ŒçœŸæ­£æœ‰ç—…çš„æ¯”ä¾‹','æª¢é©—é™°æ€§è€…ä¸­ï¼ŒçœŸæ­£æ²’ç—…çš„æ¯”ä¾‹','æœ‰ç—…è€…ä¸­ï¼Œæª¢é©—çµæœç‚ºé™½æ€§çš„æ¯”ä¾‹','æ²’ç—…è€…ä¸­ï¼Œæª¢é©—çµæœç‚ºé™°æ€§çš„æ¯”ä¾‹'],c:3,e:'ç‰¹ç•°åº¦ = TN/(TN+FP)ï¼Œä»£è¡¨æ‰€æœ‰çœŸæ­£æ²’ç—…çš„äººä¸­ï¼Œè¢«æª¢é©—æ­£ç¢ºè­˜åˆ¥ç‚ºé™°æ€§çš„æ¯”ä¾‹ã€‚'},
    {q:'é™½æ€§é æ¸¬å€¼ï¼ˆPPVï¼‰æœƒå—åˆ°ä¸‹åˆ—ä½•è€…å½±éŸ¿æœ€å¤§ï¼Ÿ',o:['æª¢é©—çš„æ•æ„Ÿåº¦','æª¢é©—çš„ç‰¹ç•°åº¦','ç–¾ç—…ç››è¡Œç‡','æª¢é©—æˆæœ¬'],c:2,e:'PPV å—ç››è¡Œç‡å½±éŸ¿æ¥µå¤§ã€‚ç›¸åŒçš„æ•æ„Ÿåº¦å’Œç‰¹ç•°åº¦ï¼Œåœ¨ä½ç››è¡Œç‡æ—ç¾¤ä¸­ PPV æœƒæ˜é¡¯ä¸‹é™ï¼Œé«˜ç››è¡Œç‡æ—ç¾¤ä¸­ PPV æœƒæé«˜ã€‚'},
    {q:'LR+ï¼ˆæ­£ä¼¼ç„¶æ¯”ï¼‰çš„è¨ˆç®—å…¬å¼ç‚ºä½•ï¼Ÿ',o:['æ•æ„Ÿåº¦ / ç‰¹ç•°åº¦','æ•æ„Ÿåº¦ / (1-ç‰¹ç•°åº¦)','(1-æ•æ„Ÿåº¦) / ç‰¹ç•°åº¦','ç‰¹ç•°åº¦ / (1-æ•æ„Ÿåº¦)'],c:1,e:'LR+ = Sensitivity / (1-Specificity)ã€‚ä»£è¡¨é™½æ€§çµæœåœ¨æœ‰ç—…è€…å‡ºç¾çš„æ©Ÿç‡ï¼Œç›¸å°æ–¼åœ¨ç„¡ç—…è€…å‡ºç¾çš„æ©Ÿç‡ã€‚'},
    {q:'ç•¶ LR+ = 1 æ™‚ï¼Œä»£è¡¨ä»€éº¼æ„ç¾©ï¼Ÿ',o:['æª¢é©—éå¸¸æœ‰ç”¨','æª¢é©—çµæœä¸å½±éŸ¿ç–¾ç—…æ©Ÿç‡','å¯ä»¥ç¢ºè¨ºç–¾ç—…','å¯ä»¥æ’é™¤ç–¾ç—…'],c:1,e:'LR+ = 1 è¡¨ç¤ºé™½æ€§çµæœåœ¨æœ‰ç—…å’Œç„¡ç—…è€…ä¸­å‡ºç¾çš„æ©Ÿç‡ç›¸åŒï¼Œå› æ­¤æª¢é©—çµæœå°æ–¼æ”¹è®Šç–¾ç—…æ©Ÿç‡æ²’æœ‰å¹«åŠ©ã€‚'},
    {q:'ROC æ›²ç·šä¸‹é¢ç©ï¼ˆAUCï¼‰= 0.5 ä»£è¡¨ä»€éº¼æ„ç¾©ï¼Ÿ',o:['å®Œç¾çš„è¨ºæ–·èƒ½åŠ›','è¨ºæ–·èƒ½åŠ›ç­‰åŒéš¨æ©ŸçŒœæ¸¬','ä¸­ç­‰çš„è¨ºæ–·èƒ½åŠ›','ç„¡æ³•è¨ˆç®—'],c:1,e:'AUC = 0.5 è¡¨ç¤ºè¨ºæ–·èƒ½åŠ›ç­‰åŒæ–¼éš¨æ©ŸçŒœæ¸¬ï¼ˆæ“²ç¡¬å¹£ï¼‰ã€‚AUC = 1.0 ä»£è¡¨å®Œç¾è¨ºæ–·ï¼ŒAUC > 0.9 é€šå¸¸è¦–ç‚ºå„ªç§€ã€‚'},
    {q:'STARD æŒ‡å¼•çš„ä¸»è¦ç›®çš„ç‚ºä½•ï¼Ÿ',o:['è¦ç¯„è¨ºæ–·è©¦åŠ‘çš„ç”Ÿç”¢æ¨™æº–','æå‡è¨ºæ–·ç ”ç©¶å ±å‘Šçš„å®Œæ•´æ€§èˆ‡é€æ˜åº¦','è¨­å®šè¨ºæ–·é–¾å€¼æ¨™æº–','è©•ä¼°è¨ºæ–·æˆæœ¬æ•ˆç›Š'],c:1,e:'STARDï¼ˆStandards for Reporting of Diagnostic Accuracy Studiesï¼‰æ—¨åœ¨æå‡è¨ºæ–·æº–ç¢ºåº¦ç ”ç©¶å ±å‘Šçš„å“è³ªï¼Œç¢ºä¿ç ”ç©¶æ–¹æ³•èˆ‡çµæœçš„å®Œæ•´å‘ˆç¾ã€‚'},
    {q:'ä¸‹åˆ—ä½•ç¨®åå·®æ˜¯è¨ºæ–·ç ”ç©¶ä¸­æœ€éœ€è¦æ³¨æ„çš„ï¼Ÿ',o:['ç™¼è¡¨åå·®','é©—è­‰åå·®ï¼ˆVerification Biasï¼‰','èªè¨€åå·®','æ™‚é–“åå·®'],c:1,e:'é©—è­‰åå·®ï¼ˆåˆç¨± work-up biasï¼‰ç™¼ç”Ÿåœ¨ä¸¦éæ‰€æœ‰å—è©¦è€…éƒ½æ¥å—åƒè€ƒæ¨™æº–æª¢é©—æ™‚ï¼Œé€™æœƒå°è‡´æ•æ„Ÿåº¦è¢«é«˜ä¼°ã€ç‰¹ç•°åº¦è¢«ä½ä¼°ã€‚'},
    {q:'é—œæ–¼è¨ºæ–·é–¾å€¼ï¼ˆCut-off valueï¼‰çš„é¸æ“‡ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ',o:['æ‡‰é¸æ“‡æ•æ„Ÿåº¦æœ€é«˜çš„é–¾å€¼','æ‡‰é¸æ“‡ç‰¹ç•°åº¦æœ€é«˜çš„é–¾å€¼','æ‡‰æ ¹æ“šè‡¨åºŠæƒ…å¢ƒèˆ‡å¾Œæœä¾†æ±ºå®š','æ‡‰é¸æ“‡ ROC æ›²ç·šä¸Šé›¢åŸé»æœ€è¿‘çš„é»'],c:2,e:'è¨ºæ–·é–¾å€¼çš„é¸æ“‡æ‡‰æ ¹æ“šè‡¨åºŠæƒ…å¢ƒã€‚è‹¥æ¼è¨ºå¾Œæœåš´é‡ï¼ˆå¦‚ç™Œç—‡ç¯©æª¢ï¼‰ï¼Œæ‡‰é¸é«˜æ•æ„Ÿåº¦é–¾å€¼ï¼›è‹¥å½é™½æ€§å¾Œæœåš´é‡ï¼ˆå¦‚ä¾µå…¥æ€§æ²»ç™‚ï¼‰ï¼Œæ‡‰é¸é«˜ç‰¹ç•°åº¦é–¾å€¼ã€‚'}
];

const App=()=>{
    const[page,setPage]=useState('home');
    const[lessonId,setLessonId]=useState(1);
    const[qIdx,setQIdx]=useState(0);
    const[score,setScore]=useState(0);
    const[sel,setSel]=useState(null);
    const[show,setShow]=useState(false);
    const[done,setDone]=useState(false);
    const[quizStartTime,setQuizStartTime]=useState(null);
    const[newBadges,setNewBadges]=useState([]);

    useEffect(()=>{if(page==='quiz'&&!done&&!quizStartTime)setQuizStartTime(Date.now())},[page,done]);
    useEffect(()=>{if(done&&quizStartTime){const t=Math.round((Date.now()-quizStartTime)/1000);ProgressTracker.saveQuizResult(MODULE_ID,score,quiz.length,t);if(ProgressTracker.newBadges.length>0){setNewBadges([...ProgressTracker.newBadges])}}},[done]);
    useEffect(()=>{if(newBadges.length>0){const timer=setTimeout(()=>{setNewBadges(prev=>prev.slice(1))},4000);return ()=>clearTimeout(timer)}},[newBadges]);

    const closeBadge=(badgeId)=>{setNewBadges(prev=>prev.filter(id=>id!==badgeId))};

    const Header=({title})=>(
        <header style={{background:'#fff',borderBottom:'1px solid #FFD6E8',padding:'12px 16px',position:'sticky',top:0,zIndex:10}}>
            <div style={{maxWidth:480,margin:'0 auto',display:'flex',alignItems:'center',gap:12}}>
                <button onClick={()=>page==='home'?window.location.href='index.html':setPage('home')} style={{background:'#FFF0F5',border:'none',borderRadius:10,width:40,height:40,cursor:'pointer',color:'var(--pri)',display:'flex',alignItems:'center',justifyContent:'center'}}>
                    <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <span style={{fontWeight:700,color:'#9D174D'}}>{title}</span>
            </div>
        </header>
    );

    const Home=()=>(
        <div>
            <Header title="è¨ºæ–·æ€§ç ”ç©¶è©•è®€"/>
            <div style={{background:'linear-gradient(135deg,#F72585,#B5179E)',padding:'32px 20px',color:'#fff'}}>
                <div style={{maxWidth:480,margin:'0 auto'}}>
                    <div style={{background:'rgba(255,255,255,0.2)',display:'inline-block',padding:'6px 14px',borderRadius:50,fontSize:12,fontWeight:600,marginBottom:16}}>ğŸ¯ Diagnostic Study Appraisal</div>
                    <h1 style={{fontSize:26,fontWeight:700,marginBottom:12}}>è¨ºæ–·æ€§ç ”ç©¶è©•è®€</h1>
                    <p style={{opacity:0.95,fontSize:14}}>å­¸ç¿’è©•ä¼°è¨ºæ–·å·¥å…·çš„æº–ç¢ºåº¦èˆ‡è‡¨åºŠåƒ¹å€¼</p>
                </div>
            </div>
            <div style={{padding:'0 16px',marginTop:-20}}>
                <div style={{maxWidth:480,margin:'0 auto'}}>
                    <div className="card">
                        <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri)',marginBottom:12}}>ğŸ¯ å­¸ç¿’ç›®æ¨™</h3>
                        {['ç†è§£è¨ºæ–·ç ”ç©¶çš„åŸºæœ¬æ¶æ§‹','è¨ˆç®—èˆ‡è§£è®€æ•æ„Ÿåº¦ã€ç‰¹ç•°åº¦ã€é æ¸¬å€¼','é‹ç”¨ä¼¼ç„¶æ¯”èª¿æ•´è¨ºæ–·æ©Ÿç‡','è§£è®€ ROC æ›²ç·šèˆ‡ AUC','æ‡‰ç”¨ STARD æŒ‡å¼•è©•è®€æ–‡ç»'].map((t,i)=>(
                            <div key={i} style={{display:'flex',gap:10,marginBottom:8,fontSize:14}}>
                                <span style={{background:'var(--suc)',color:'#fff',borderRadius:6,width:22,height:22,display:'flex',alignItems:'center',justifyContent:'center',fontSize:12,flexShrink:0}}>{i+1}</span>
                                <span style={{color:'var(--txt2)'}}>{t}</span>
                            </div>
                        ))}
                    </div>
                    <h3 style={{fontSize:18,fontWeight:700,marginBottom:16}}>ğŸ“š èª²ç¨‹å…§å®¹</h3>
                    {lessons.map(l=>(
                        <div key={l.id} className="card" onClick={()=>{setLessonId(l.id);setPage('lesson')}} style={{cursor:'pointer'}}>
                            <div style={{display:'flex',alignItems:'center',gap:16}}>
                                <div style={{width:48,height:48,borderRadius:12,background:`linear-gradient(135deg,${l.color},${l.color}88)`,display:'flex',alignItems:'center',justifyContent:'center',color:'#fff',fontWeight:700}}>{l.id}</div>
                                <div style={{flex:1}}>
                                    <div style={{fontSize:11,color:l.color,fontWeight:600}}>Lesson {l.id}</div>
                                    <div style={{fontSize:16,fontWeight:700}}>{l.title}</div>
                                    <div style={{fontSize:13,color:'var(--txt2)'}}>{l.sub}</div>
                                </div>
                                <svg viewBox="0 0 24 24" fill={l.color} width="20" height="20"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"/></svg>
                            </div>
                        </div>
                    ))}
                    <button className="btn btn-pri" onClick={()=>{setQIdx(0);setScore(0);setSel(null);setShow(false);setDone(false);setPage('quiz')}} style={{width:'100%',justifyContent:'center',marginTop:20,marginBottom:32}}>
                        ğŸ“ é–‹å§‹æ¸¬é©— (10é¡Œ)
                    </button>
                </div>
            </div>
            <footer style={{background:'#FFF0F5',padding:'24px 16px',textAlign:'center'}}>
                <p style={{fontSize:13,color:'var(--txt2)'}}>æ–°ç«¹å°å¤§åˆ†é™¢æ•™å­¸éƒ¨</p>
                <p style={{fontSize:12,color:'var(--txt2)'}}>è¬æ…•æš MD, PhD, FESC | é»ƒæ²›éŠ“ MD | é»ƒåœ‹è‰¯</p>
            </footer>
        </div>
    );

    const L1=()=>(
        <div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--pri)',marginBottom:12}}>ğŸ”¬ è¨ºæ–·æ€§ç ”ç©¶çš„ç›®çš„</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:16}}>è¨ºæ–·æ€§ç ”ç©¶æ—¨åœ¨è©•ä¼°æŸé …<strong>è¨ºæ–·å·¥å…·ï¼ˆIndex Testï¼‰</strong>ç›¸å°æ–¼<strong>åƒè€ƒæ¨™æº–ï¼ˆReference Standardï¼‰</strong>çš„æº–ç¢ºåº¦ã€‚</p>
                
                <div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:12,padding:20,background:'#F8F9FA',borderRadius:12,flexWrap:'wrap'}}>
                    <div style={{background:'var(--pri)',color:'#fff',padding:'12px 16px',borderRadius:10,textAlign:'center'}}>
                        <div style={{fontSize:12,opacity:0.9}}>Index Test</div>
                        <div style={{fontWeight:700}}>å¾…è©•ä¼°æª¢é©—</div>
                    </div>
                    <div style={{fontSize:24}}>â†’</div>
                    <div style={{background:'var(--blue)',color:'#fff',padding:'12px 16px',borderRadius:10,textAlign:'center'}}>
                        <div style={{fontSize:12,opacity:0.9}}>vs</div>
                        <div style={{fontWeight:700}}>æ¯”è¼ƒ</div>
                    </div>
                    <div style={{fontSize:24}}>â†’</div>
                    <div style={{background:'var(--suc)',color:'#fff',padding:'12px 16px',borderRadius:10,textAlign:'center'}}>
                        <div style={{fontSize:12,opacity:0.9}}>Reference Standard</div>
                        <div style={{fontWeight:700}}>é»ƒé‡‘æ¨™æº–</div>
                    </div>
                </div>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--blue)',marginBottom:12}}>ğŸ“‹ è¨ºæ–·ç ”ç©¶çš„é—œéµè¦ç´ </h3>
                <div style={{display:'grid',gap:10}}>
                    {[
                        {title:'ç ”ç©¶æ—ç¾¤',desc:'æ‡‰ä»£è¡¨è‡¨åºŠå¯¦éš›æœƒæ¥å—æª¢é©—çš„ç—…äºº',icon:'ğŸ‘¥'},
                        {title:'Index Test',desc:'å¾…è©•ä¼°çš„è¨ºæ–·å·¥å…·ï¼Œéœ€æ¨™æº–åŒ–åŸ·è¡Œ',icon:'ğŸ”¬'},
                        {title:'Reference Standard',desc:'ç›®å‰æœ€ä½³çš„ç–¾ç—…ç¢ºèªæ–¹æ³•',icon:'ğŸ†'},
                        {title:'ç›²åŒ–',desc:'åˆ¤è®€è€…ä¸æ‡‰çŸ¥é“å¦ä¸€æª¢é©—çµæœ',icon:'ğŸ™ˆ'},
                        {title:'æ™‚åº',desc:'å…©é …æª¢é©—æ‡‰åœ¨é©ç•¶æ™‚é–“å…§å®Œæˆ',icon:'â±ï¸'}
                    ].map((item,idx)=>(
                        <div key={idx} style={{display:'flex',alignItems:'flex-start',gap:12,padding:'12px',background:'#F8F9FA',borderRadius:10}}>
                            <div style={{fontSize:24}}>{item.icon}</div>
                            <div>
                                <div style={{fontWeight:600,color:'var(--txt)'}}>{item.title}</div>
                                <div style={{fontSize:13,color:'var(--txt2)'}}>{item.desc}</div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
            
            <div className="warn">
                <strong style={{color:'var(--err)'}}>âš ï¸ å¸¸è¦‹åå·®é¡å‹</strong><br/>
                <span style={{fontSize:14,color:'var(--txt2)'}}>
                â€¢ <strong>é¸æ¨£åå·®</strong>ï¼šåªç´å…¥ç‰¹å®šåš´é‡åº¦çš„ç—…äºº<br/>
                â€¢ <strong>é©—è­‰åå·®</strong>ï¼šä¸¦éæ‰€æœ‰äººéƒ½æ¥å—åƒè€ƒæ¨™æº–<br/>
                â€¢ <strong>åˆ¤è®€åå·®</strong>ï¼šåˆ¤è®€è€…çŸ¥é“å…¶ä»–æª¢é©—çµæœ<br/>
                â€¢ <strong>ç–¾ç—…é€²å±•åå·®</strong>ï¼šå…©æª¢é©—é–“éš”éé•·
                </span>
            </div>
            
            <div className="good">
                <strong style={{color:'var(--suc)'}}>ğŸ’¡ ç†æƒ³çš„è¨ºæ–·ç ”ç©¶è¨­è¨ˆ</strong><br/>
                <span style={{fontSize:14,color:'var(--txt2)'}}>
                â€¢ é€£çºŒæˆ–éš¨æ©Ÿæ”¶æ¡ˆ<br/>
                â€¢ æ‰€æœ‰å—è©¦è€…éƒ½æ¥å— Index Test å’Œ Reference Standard<br/>
                â€¢ åˆ¤è®€è€…ç›¸äº’ç›²åŒ–<br/>
                â€¢ é å…ˆå®šç¾©è¨ºæ–·é–¾å€¼
                </span>
            </div>
        </div>
    );

    const L2=()=>(
        <div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--pri)',marginBottom:12}}>ğŸ“Š 2Ã—2 åˆ—è¯è¡¨</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>è¨ºæ–·ç ”ç©¶çš„æ ¸å¿ƒæ˜¯å°‡æª¢é©—çµæœèˆ‡ç–¾ç—…ç‹€æ…‹äº¤å‰åˆ†é¡</p>
                
                <div className="two-by-two">
                    <table>
                        <thead>
                            <tr>
                                <th style={{background:'#F8F9FA'}}></th>
                                <th style={{background:'#E8F5E9',color:'var(--suc)'}}>æœ‰ç—… (D+)</th>
                                <th style={{background:'#FFEBEE',color:'var(--err)'}}>ç„¡ç—… (D-)</th>
                                <th style={{background:'#F3E5F5',color:'var(--pur)'}}>åˆè¨ˆ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style={{fontWeight:600,background:'#E3F2FD'}}>æª¢é©—é™½æ€§ (T+)</td>
                                <td style={{background:'#C8E6C9',fontWeight:700,color:'var(--suc)'}}>TP<br/><span style={{fontSize:11}}>çœŸé™½æ€§</span></td>
                                <td style={{background:'#FFCDD2',fontWeight:700,color:'var(--err)'}}>FP<br/><span style={{fontSize:11}}>å½é™½æ€§</span></td>
                                <td style={{background:'#E1BEE7'}}>TP+FP</td>
                            </tr>
                            <tr>
                                <td style={{fontWeight:600,background:'#E3F2FD'}}>æª¢é©—é™°æ€§ (T-)</td>
                                <td style={{background:'#FFCDD2',fontWeight:700,color:'var(--err)'}}>FN<br/><span style={{fontSize:11}}>å½é™°æ€§</span></td>
                                <td style={{background:'#C8E6C9',fontWeight:700,color:'var(--suc)'}}>TN<br/><span style={{fontSize:11}}>çœŸé™°æ€§</span></td>
                                <td style={{background:'#E1BEE7'}}>FN+TN</td>
                            </tr>
                            <tr>
                                <td style={{fontWeight:600,background:'#E3F2FD'}}>åˆè¨ˆ</td>
                                <td style={{background:'#F3E5F5'}}>TP+FN</td>
                                <td style={{background:'#F3E5F5'}}>FP+TN</td>
                                <td style={{background:'#CE93D8',color:'#fff',fontWeight:700}}>N</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--suc)',marginBottom:12}}>ğŸ¯ æ•æ„Ÿåº¦ Sensitivity</h3>
                <div className="formula">Sensitivity = TP / (TP + FN)</div>
                <p style={{fontSize:14,color:'var(--txt2)',marginTop:12}}>
                    <strong>å®šç¾©ï¼š</strong>åœ¨æ‰€æœ‰<span style={{color:'var(--suc)',fontWeight:600}}>æœ‰ç—…</span>çš„äººä¸­ï¼Œæª¢é©—çµæœç‚ºé™½æ€§çš„æ¯”ä¾‹<br/>
                    <strong>æ„ç¾©ï¼š</strong>æª¢é©—ã€Œæ‰¾å‡ºç—…äººã€çš„èƒ½åŠ›
                </p>
                <div className="pink" style={{marginTop:12}}>
                    <strong style={{color:'var(--pri)'}}>ğŸ”‘ SnNOut å£è¨£</strong><br/>
                    <span style={{fontSize:14}}>
                    <strong>S</strong>ensitivity high â†’ <strong>N</strong>egative â†’ Rules <strong>Out</strong><br/>
                    é«˜æ•æ„Ÿåº¦çš„<strong>é™°æ€§</strong>çµæœå¯æ’é™¤ç–¾ç—…
                    </span>
                </div>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--pur)',marginBottom:12}}>ğŸ”’ ç‰¹ç•°åº¦ Specificity</h3>
                <div className="formula" style={{background:'linear-gradient(135deg,#FAF5FF,#F3E5F5)',borderColor:'var(--pur)'}}>Specificity = TN / (TN + FP)</div>
                <p style={{fontSize:14,color:'var(--txt2)',marginTop:12}}>
                    <strong>å®šç¾©ï¼š</strong>åœ¨æ‰€æœ‰<span style={{color:'var(--err)',fontWeight:600}}>æ²’ç—…</span>çš„äººä¸­ï¼Œæª¢é©—çµæœç‚ºé™°æ€§çš„æ¯”ä¾‹<br/>
                    <strong>æ„ç¾©ï¼š</strong>æª¢é©—ã€Œæ’é™¤å¥åº·äººã€çš„èƒ½åŠ›
                </p>
                <div className="purple" style={{marginTop:12}}>
                    <strong style={{color:'var(--pur)'}}>ğŸ”‘ SpPIn å£è¨£</strong><br/>
                    <span style={{fontSize:14}}>
                    <strong>Sp</strong>ecificity high â†’ <strong>P</strong>ositive â†’ Rules <strong>In</strong><br/>
                    é«˜ç‰¹ç•°åº¦çš„<strong>é™½æ€§</strong>çµæœå¯ç¢ºèªç–¾ç—…
                    </span>
                </div>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--orange)',marginBottom:12}}>ğŸ“ˆ é æ¸¬å€¼ Predictive Values</h3>
                <table>
                    <thead>
                        <tr><th>æŒ‡æ¨™</th><th>å…¬å¼</th><th>è‡¨åºŠå•é¡Œ</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style={{fontWeight:600,color:'var(--suc)'}}>PPV<br/>é™½æ€§é æ¸¬å€¼</td>
                            <td>TP/(TP+FP)</td>
                            <td style={{textAlign:'left',fontSize:12}}>æª¢é©—é™½æ€§æ™‚ï¼ŒçœŸçš„æœ‰ç—…çš„æ©Ÿç‡ï¼Ÿ</td>
                        </tr>
                        <tr>
                            <td style={{fontWeight:600,color:'var(--blue)'}}>NPV<br/>é™°æ€§é æ¸¬å€¼</td>
                            <td>TN/(TN+FN)</td>
                            <td style={{textAlign:'left',fontSize:12}}>æª¢é©—é™°æ€§æ™‚ï¼ŒçœŸçš„æ²’ç—…çš„æ©Ÿç‡ï¼Ÿ</td>
                        </tr>
                    </tbody>
                </table>
                
                <div className="tip" style={{marginTop:12}}>
                    <strong style={{color:'var(--warn)'}}>âš ï¸ é æ¸¬å€¼å—ç››è¡Œç‡å½±éŸ¿</strong><br/>
                    <span style={{fontSize:14,color:'var(--txt2)'}}>
                    ç›¸åŒçš„æ•æ„Ÿåº¦å’Œç‰¹ç•°åº¦ï¼š<br/>
                    â€¢ ä½ç››è¡Œç‡ â†’ PPV â†“â†“ã€NPV â†‘<br/>
                    â€¢ é«˜ç››è¡Œç‡ â†’ PPV â†‘ã€NPV â†“â†“
                    </span>
                </div>
            </div>
        </div>
    );

    const L3=()=>(
        <div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--pur)',marginBottom:12}}>âš–ï¸ ä¼¼ç„¶æ¯” Likelihood Ratio</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>
                    ä¼¼ç„¶æ¯”è¡¨ç¤ºæŸæª¢é©—çµæœåœ¨<strong>æœ‰ç—…è€…</strong>å‡ºç¾çš„æ©Ÿç‡ï¼Œç›¸å°æ–¼åœ¨<strong>ç„¡ç—…è€…</strong>å‡ºç¾çš„æ©Ÿç‡ã€‚<br/>
                    <strong>å„ªé»ï¼š</strong>ä¸å—ç››è¡Œç‡å½±éŸ¿ï¼Œå¯ç›´æ¥èª¿æ•´è¨ºæ–·æ©Ÿç‡ã€‚
                </p>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--suc)',marginBottom:12}}>â• æ­£ä¼¼ç„¶æ¯” LR+</h3>
                <div className="formula" style={{background:'linear-gradient(135deg,#F0FFF4,#C6F6D5)',borderColor:'var(--suc)'}}>
                    LR+ = Sensitivity / (1 - Specificity)
                </div>
                <p style={{fontSize:14,color:'var(--txt2)',marginTop:12}}>
                    <strong>æ„ç¾©ï¼š</strong>é™½æ€§çµæœä½¿ç–¾ç—…æ©Ÿç‡<strong>å¢åŠ </strong>çš„å¹…åº¦
                </p>
                <table style={{marginTop:12}}>
                    <thead><tr><th>LR+ å€¼</th><th>è¨ºæ–·åƒ¹å€¼</th><th>æ©Ÿç‡è®ŠåŒ–</th></tr></thead>
                    <tbody>
                        <tr><td style={{color:'var(--suc)',fontWeight:700}}>&gt;10</td><td>æ¥µä½³</td><td>å¤§å¹…å¢åŠ  (~+45%)</td></tr>
                        <tr><td style={{color:'var(--blue)',fontWeight:700}}>5-10</td><td>è‰¯å¥½</td><td>ä¸­åº¦å¢åŠ  (~+30%)</td></tr>
                        <tr><td style={{color:'var(--warn)',fontWeight:700}}>2-5</td><td>æ™®é€š</td><td>è¼•åº¦å¢åŠ  (~+15%)</td></tr>
                        <tr><td style={{color:'var(--txt2)'}}>1-2</td><td>å¾®å¼±</td><td>å¹¾ä¹ä¸è®Š</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--err)',marginBottom:12}}>â– è² ä¼¼ç„¶æ¯” LR-</h3>
                <div className="formula" style={{background:'linear-gradient(135deg,#FFF5F5,#FED7D7)',borderColor:'var(--err)'}}>
                    LR- = (1 - Sensitivity) / Specificity
                </div>
                <p style={{fontSize:14,color:'var(--txt2)',marginTop:12}}>
                    <strong>æ„ç¾©ï¼š</strong>é™°æ€§çµæœä½¿ç–¾ç—…æ©Ÿç‡<strong>é™ä½</strong>çš„å¹…åº¦
                </p>
                <table style={{marginTop:12}}>
                    <thead><tr><th>LR- å€¼</th><th>æ’é™¤åƒ¹å€¼</th><th>æ©Ÿç‡è®ŠåŒ–</th></tr></thead>
                    <tbody>
                        <tr><td style={{color:'var(--suc)',fontWeight:700}}>&lt;0.1</td><td>æ¥µä½³æ’é™¤</td><td>å¤§å¹…é™ä½ (~-45%)</td></tr>
                        <tr><td style={{color:'var(--blue)',fontWeight:700}}>0.1-0.2</td><td>è‰¯å¥½æ’é™¤</td><td>ä¸­åº¦é™ä½ (~-30%)</td></tr>
                        <tr><td style={{color:'var(--warn)',fontWeight:700}}>0.2-0.5</td><td>æ™®é€šæ’é™¤</td><td>è¼•åº¦é™ä½ (~-15%)</td></tr>
                        <tr><td style={{color:'var(--txt2)'}}>0.5-1</td><td>ç„¡æ’é™¤åƒ¹å€¼</td><td>å¹¾ä¹ä¸è®Š</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--orange)',marginBottom:12}}>ğŸ² æ©Ÿç‡è½‰æ›å…¬å¼</h3>
                <div style={{background:'#FFF9F0',padding:16,borderRadius:12,fontSize:14,lineHeight:2}}>
                    <strong>Step 1ï¼š</strong>å‰æ¸¬æ©Ÿç‡ â†’ å‰æ¸¬å‹ç®—<br/>
                    <div className="formula" style={{margin:'8px 0',fontSize:14,padding:10}}>Pre-test Odds = Prob / (1 - Prob)</div>
                    
                    <strong>Step 2ï¼š</strong>å‰æ¸¬å‹ç®— Ã— LR â†’ å¾Œæ¸¬å‹ç®—<br/>
                    <div className="formula" style={{margin:'8px 0',fontSize:14,padding:10}}>Post-test Odds = Pre-test Odds Ã— LR</div>
                    
                    <strong>Step 3ï¼š</strong>å¾Œæ¸¬å‹ç®— â†’ å¾Œæ¸¬æ©Ÿç‡<br/>
                    <div className="formula" style={{margin:'8px 0',fontSize:14,padding:10}}>Post-test Prob = Odds / (1 + Odds)</div>
                </div>
            </div>
            
            <div className="info">
                <strong style={{color:'var(--blue)'}}>ğŸ“Š è¨ºæ–·å‹ç®—æ¯” DOR</strong><br/>
                <span style={{fontSize:14,color:'var(--txt2)'}}>
                <strong>DOR = LR+ / LR- = (TP Ã— TN) / (FP Ã— FN)</strong><br/>
                ç¶œåˆåæ˜ è¨ºæ–·èƒ½åŠ›çš„å–®ä¸€æŒ‡æ¨™ï¼Œå¸¸ç”¨æ–¼çµ±åˆåˆ†æã€‚<br/>
                DOR = 1 è¡¨ç¤ºç„¡è¨ºæ–·èƒ½åŠ›ï¼Œè¶Šå¤§è¶Šå¥½ã€‚
                </span>
            </div>
        </div>
    );

    const L4=()=>(
        <div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--teal)',marginBottom:12}}>ğŸ“ˆ ROC æ›²ç·šç°¡ä»‹</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>
                    ROCï¼ˆReceiver Operating Characteristicï¼‰æ›²ç·šæ˜¯ä»¥<strong>å‡é™½æ€§ç‡ï¼ˆ1-ç‰¹ç•°åº¦ï¼‰</strong>ç‚ºXè»¸ã€<strong>çœŸé™½æ€§ç‡ï¼ˆæ•æ„Ÿåº¦ï¼‰</strong>ç‚ºYè»¸ç¹ªè£½çš„æ›²ç·šã€‚
                </p>
                
                <div className="roc-container">
                    <svg viewBox="0 0 300 280" style={{width:'100%',maxWidth:300,display:'block',margin:'0 auto'}}>
                        {/* èƒŒæ™¯ç¶²æ ¼ */}
                        <defs>
                            <pattern id="grid" width="30" height="25" patternUnits="userSpaceOnUse">
                                <path d="M 30 0 L 0 0 0 25" fill="none" stroke="#E2E8F0" strokeWidth="0.5"/>
                            </pattern>
                        </defs>
                        <rect x="50" y="20" width="240" height="200" fill="url(#grid)"/>
                        
                        {/* åº§æ¨™è»¸ */}
                        <line x1="50" y1="220" x2="290" y2="220" stroke="#333" strokeWidth="2"/>
                        <line x1="50" y1="20" x2="50" y2="220" stroke="#333" strokeWidth="2"/>
                        
                        {/* å°è§’ç·šï¼ˆéš¨æ©ŸçŒœæ¸¬ï¼‰ */}
                        <line x1="50" y1="220" x2="290" y2="20" stroke="#E53E3E" strokeWidth="2" strokeDasharray="5,5"/>
                        
                        {/* ROC æ›²ç·šï¼ˆå„ªç§€ï¼‰ */}
                        <path d="M 50 220 Q 60 80 100 50 Q 150 30 200 25 L 290 20" fill="none" stroke="#2EC4B6" strokeWidth="3"/>
                        
                        {/* ROC æ›²ç·šï¼ˆæ™®é€šï¼‰ */}
                        <path d="M 50 220 Q 100 150 150 100 Q 200 60 290 20" fill="none" stroke="#F7931E" strokeWidth="2" strokeDasharray="8,4"/>
                        
                        {/* AUC å€åŸŸæ¨™ç¤º */}
                        <text x="120" y="130" fontSize="12" fill="var(--teal)" fontWeight="600">AUC = 0.92</text>
                        <text x="180" y="95" fontSize="11" fill="#F7931E">AUC = 0.75</text>
                        <text x="200" y="160" fontSize="11" fill="var(--err)">AUC = 0.50</text>
                        
                        {/* è»¸æ¨™ç±¤ */}
                        <text x="170" y="250" textAnchor="middle" fontSize="12" fill="#333">1 - Specificity (FPR)</text>
                        <text x="15" y="120" textAnchor="middle" fontSize="12" fill="#333" transform="rotate(-90,15,120)">Sensitivity (TPR)</text>
                        
                        {/* åˆ»åº¦ */}
                        <text x="50" y="235" textAnchor="middle" fontSize="10" fill="#666">0</text>
                        <text x="170" y="235" textAnchor="middle" fontSize="10" fill="#666">0.5</text>
                        <text x="290" y="235" textAnchor="middle" fontSize="10" fill="#666">1.0</text>
                        <text x="40" y="220" textAnchor="end" fontSize="10" fill="#666">0</text>
                        <text x="40" y="120" textAnchor="end" fontSize="10" fill="#666">0.5</text>
                        <text x="40" y="25" textAnchor="end" fontSize="10" fill="#666">1.0</text>
                    </svg>
                    
                    <div style={{display:'flex',justifyContent:'center',gap:16,marginTop:12,fontSize:12}}>
                        <span><span style={{color:'var(--teal)'}}>â”â”</span> å„ªç§€æª¢é©—</span>
                        <span><span style={{color:'#F7931E'}}>â•Œâ•Œ</span> æ™®é€šæª¢é©—</span>
                        <span><span style={{color:'var(--err)'}}>â•Œâ•Œ</span> éš¨æ©ŸçŒœæ¸¬</span>
                    </div>
                </div>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--blue)',marginBottom:12}}>ğŸ¯ AUC è§£è®€æ¨™æº–</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>AUCï¼ˆArea Under Curveï¼‰ä»£è¡¨æ›²ç·šä¸‹é¢ç©ï¼Œåæ˜ æ•´é«”è¨ºæ–·èƒ½åŠ›</p>
                
                <table>
                    <thead><tr><th>AUC ç¯„åœ</th><th>è¨ºæ–·èƒ½åŠ›</th><th>è‡¨åºŠæ„ç¾©</th></tr></thead>
                    <tbody>
                        <tr><td style={{color:'var(--suc)',fontWeight:700}}>0.9 - 1.0</td><td>å„ªç§€</td><td>å¯ä½œç‚ºä¸»è¦è¨ºæ–·å·¥å…·</td></tr>
                        <tr><td style={{color:'var(--blue)',fontWeight:700}}>0.8 - 0.9</td><td>è‰¯å¥½</td><td>æœ‰å¯¦ç”¨è¨ºæ–·åƒ¹å€¼</td></tr>
                        <tr><td style={{color:'var(--warn)',fontWeight:700}}>0.7 - 0.8</td><td>æ™®é€š</td><td>å¯ä½œç‚ºè¼”åŠ©åƒè€ƒ</td></tr>
                        <tr><td style={{color:'var(--orange)',fontWeight:700}}>0.6 - 0.7</td><td>è¼ƒå·®</td><td>è¨ºæ–·åƒ¹å€¼æœ‰é™</td></tr>
                        <tr><td style={{color:'var(--err)',fontWeight:700}}>0.5 - 0.6</td><td>ç„¡æ•ˆ</td><td>ç­‰åŒéš¨æ©ŸçŒœæ¸¬</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--pur)',marginBottom:12}}>âœ‚ï¸ è¨ºæ–·é–¾å€¼é¸æ“‡</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>ROC æ›²ç·šä¸Šæ¯å€‹é»ä»£è¡¨ä¸€å€‹å¯èƒ½çš„è¨ºæ–·é–¾å€¼</p>
                
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
                    <div style={{background:'#F0FFF4',padding:12,borderRadius:10}}>
                        <div style={{fontWeight:600,color:'var(--suc)',marginBottom:4}}>é«˜æ•æ„Ÿåº¦é–¾å€¼</div>
                        <div style={{fontSize:12,color:'var(--txt2)'}}>
                            â€¢ æ¸›å°‘æ¼è¨º<br/>
                            â€¢ é©åˆï¼šåš´é‡ç–¾ç—…ç¯©æª¢<br/>
                            â€¢ ä»£åƒ¹ï¼šè¼ƒå¤šå½é™½æ€§
                        </div>
                    </div>
                    <div style={{background:'#FAF5FF',padding:12,borderRadius:10}}>
                        <div style={{fontWeight:600,color:'var(--pur)',marginBottom:4}}>é«˜ç‰¹ç•°åº¦é–¾å€¼</div>
                        <div style={{fontSize:12,color:'var(--txt2)'}}>
                            â€¢ æ¸›å°‘èª¤è¨º<br/>
                            â€¢ é©åˆï¼šä¾µå…¥æ€§æ²»ç™‚å‰<br/>
                            â€¢ ä»£åƒ¹ï¼šè¼ƒå¤šå½é™°æ€§
                        </div>
                    </div>
                </div>
                
                <div className="tip" style={{marginTop:12}}>
                    <strong style={{color:'var(--warn)'}}>ğŸ’¡ Youden's Index</strong><br/>
                    <span style={{fontSize:14,color:'var(--txt2)'}}>
                    <strong>J = Sensitivity + Specificity - 1</strong><br/>
                    æœ€å¤§åŒ– J å€¼çš„é»é€šå¸¸ä½œç‚ºã€Œæœ€ä½³ã€é–¾å€¼ï¼ˆå¹³è¡¡æ•æ„Ÿåº¦èˆ‡ç‰¹ç•°åº¦ï¼‰
                    </span>
                </div>
            </div>
            
            <div className="info">
                <strong style={{color:'var(--blue)'}}>ğŸ“Š æ¯”è¼ƒå…©å€‹ ROC æ›²ç·š</strong><br/>
                <span style={{fontSize:14,color:'var(--txt2)'}}>
                å¯ä½¿ç”¨ <strong>DeLong's test</strong> æ¯”è¼ƒå…©æ¢ ROC æ›²ç·šçš„ AUC æ˜¯å¦æœ‰çµ±è¨ˆé¡¯è‘—å·®ç•°ï¼Œç”¨æ–¼è©•ä¼°æ–°èˆŠè¨ºæ–·å·¥å…·çš„å„ªåŠ£ã€‚
                </span>
            </div>
        </div>
    );

    const L5=()=>(
        <div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--orange)',marginBottom:12}}>ğŸ“‹ STARD æŒ‡å¼•ç°¡ä»‹</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>
                    <strong>STARD</strong>ï¼ˆStandards for Reporting of Diagnostic Accuracy Studiesï¼‰æ˜¯è¨ºæ–·æº–ç¢ºåº¦ç ”ç©¶çš„å ±å‘Šæ¨™æº–ï¼ŒåŒ…å« <strong>30 é …</strong>æª¢æ ¸æ¸…å–®ã€‚
                </p>
                
                <div style={{background:'#FFF9F0',padding:16,borderRadius:12}}>
                    <div style={{fontWeight:600,marginBottom:12,color:'var(--orange)'}}>ğŸ“Œ STARD 2015 ä¸»è¦ç« ç¯€</div>
                    <div style={{display:'grid',gap:8}}>
                        {[
                            {section:'æ¨™é¡Œ/æ‘˜è¦',items:'ç ”ç©¶è¨­è¨ˆã€ä¸»è¦ç™¼ç¾'},
                            {section:'å‰è¨€',items:'ç§‘å­¸èƒŒæ™¯ã€ç ”ç©¶ç›®çš„'},
                            {section:'æ–¹æ³•',items:'ç ”ç©¶è¨­è¨ˆã€åƒèˆ‡è€…ã€æª¢é©—æ–¹æ³•ã€åˆ†æ'},
                            {section:'çµæœ',items:'åƒèˆ‡è€…æµç¨‹ã€è¨ºæ–·æº–ç¢ºåº¦ä¼°è¨ˆ'},
                            {section:'è¨è«–',items:'é™åˆ¶ã€æ‡‰ç”¨æ€§ã€æ„æ¶µ'}
                        ].map((item,idx)=>(
                            <div key={idx} style={{display:'flex',gap:8,fontSize:13}}>
                                <span style={{background:'var(--orange)',color:'#fff',padding:'2px 8px',borderRadius:4,fontWeight:600,flexShrink:0}}>{idx+1}</span>
                                <span><strong>{item.section}</strong>ï¼š{item.items}</span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--pri)',marginBottom:12}}>ğŸ” STARD æµç¨‹åœ–</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>æ¯ç¯‡è¨ºæ–·ç ”ç©¶éƒ½æ‡‰åŒ…å«æ¨™æº–åŒ–æµç¨‹åœ–</p>
                
                <div style={{background:'#F8F9FA',padding:16,borderRadius:12}}>
                    <div style={{display:'flex',flexDirection:'column',alignItems:'center',gap:8}}>
                        <div style={{background:'var(--blue)',color:'#fff',padding:'8px 16px',borderRadius:8,fontWeight:600}}>ç¬¦åˆè³‡æ ¼çš„ç—…äºº (n=?)</div>
                        <div style={{fontSize:20}}>â†“</div>
                        <div style={{display:'flex',gap:16,alignItems:'center'}}>
                            <div style={{background:'var(--err)',color:'#fff',padding:'6px 12px',borderRadius:6,fontSize:12}}>æ’é™¤ (n=?)</div>
                            <div style={{background:'var(--teal)',color:'#fff',padding:'8px 16px',borderRadius:8,fontWeight:600}}>ç´å…¥ç ”ç©¶ (n=?)</div>
                        </div>
                        <div style={{fontSize:20}}>â†“</div>
                        <div style={{background:'var(--pur)',color:'#fff',padding:'8px 16px',borderRadius:8,fontWeight:600}}>æ¥å— Index Test (n=?)</div>
                        <div style={{fontSize:20}}>â†“</div>
                        <div style={{background:'var(--suc)',color:'#fff',padding:'8px 16px',borderRadius:8,fontWeight:600}}>æ¥å— Reference Standard (n=?)</div>
                        <div style={{fontSize:20}}>â†“</div>
                        <div style={{display:'flex',gap:12}}>
                            <div style={{background:'#C8E6C9',padding:'6px 12px',borderRadius:6,fontSize:12,fontWeight:600}}>D+ (n=?)</div>
                            <div style={{background:'#FFCDD2',padding:'6px 12px',borderRadius:6,fontSize:12,fontWeight:600}}>D- (n=?)</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--blue)',marginBottom:12}}>âœ… è¨ºæ–·ç ”ç©¶è©•è®€æª¢æ ¸è¡¨</h3>
                <div style={{display:'grid',gap:8}}>
                    {[
                        {q:'ç ”ç©¶æ—ç¾¤æ˜¯å¦ä»£è¡¨ç›®æ¨™æ—ç¾¤ï¼Ÿ',key:'å¤–æ¨æ€§'},
                        {q:'Index test æ˜¯å¦æ¨™æº–åŒ–åŸ·è¡Œï¼Ÿ',key:'å†ç¾æ€§'},
                        {q:'Reference standard æ˜¯å¦é©ç•¶ï¼Ÿ',key:'æ•ˆåº¦'},
                        {q:'æ‰€æœ‰å—è©¦è€…æ˜¯å¦éƒ½æ¥å—åƒè€ƒæ¨™æº–ï¼Ÿ',key:'é©—è­‰åå·®'},
                        {q:'åˆ¤è®€è€…æ˜¯å¦ç›¸äº’ç›²åŒ–ï¼Ÿ',key:'åˆ¤è®€åå·®'},
                        {q:'è¨ºæ–·é–¾å€¼æ˜¯å¦é å…ˆè¨­å®šï¼Ÿ',key:'é¸æ“‡æ€§å ±å‘Š'},
                        {q:'æ˜¯å¦å ±å‘Šä¸ç¢ºå®šæˆ–ç„¡æ³•åˆ¤è®€çš„çµæœï¼Ÿ',key:'å®Œæ•´æ€§'},
                        {q:'æ˜¯å¦æä¾›è¶³å¤ è³‡è¨Šè¨ˆç®— LRï¼Ÿ',key:'å¯¦ç”¨æ€§'}
                    ].map((item,idx)=>(
                        <div key={idx} style={{display:'flex',alignItems:'center',gap:10,padding:'10px 12px',background:'#F8F9FA',borderRadius:8}}>
                            <div style={{width:24,height:24,borderRadius:6,border:'2px solid var(--blue)',display:'flex',alignItems:'center',justifyContent:'center',flexShrink:0}}>
                                <span style={{color:'var(--blue)',fontWeight:700,fontSize:12}}>âœ“</span>
                            </div>
                            <div style={{flex:1,fontSize:13}}>{item.q}</div>
                            <span style={{background:'#E3F2FD',color:'var(--blue)',padding:'2px 8px',borderRadius:4,fontSize:11,fontWeight:600}}>{item.key}</span>
                        </div>
                    ))}
                </div>
            </div>
            
            <div className="good">
                <strong style={{color:'var(--suc)'}}>ğŸ’¡ è‡¨åºŠæ‡‰ç”¨è¦é»</strong><br/>
                <span style={{fontSize:14,color:'var(--txt2)'}}>
                1. ç¢ºèªç ”ç©¶æ—ç¾¤èˆ‡æ‚¨çš„ç—…äººç›¸ä¼¼<br/>
                2. ä½¿ç”¨ LR è€Œé PPV/NPVï¼ˆå› å¾Œè€…å—ç››è¡Œç‡å½±éŸ¿ï¼‰<br/>
                3. çµåˆè‡¨åºŠåˆ¤æ–·ä¼°è¨ˆå‰æ¸¬æ©Ÿç‡<br/>
                4. æ ¹æ“šå¾Œæ¸¬æ©Ÿç‡æ±ºå®šä¸‹ä¸€æ­¥è™•ç½®<br/>
                5. è€ƒæ…®æª¢é©—çš„é¢¨éšªã€æˆæœ¬èˆ‡å¯è¿‘æ€§
                </span>
            </div>
            
            <div className="purple">
                <strong style={{color:'var(--pur)'}}>ğŸ¯ è¨ºæ–·ç­–ç•¥æ€è€ƒ</strong><br/>
                <span style={{fontSize:14,color:'var(--txt2)'}}>
                â€¢ <strong>ç¯©æª¢ç›®çš„</strong>ï¼šé¸é«˜æ•æ„Ÿåº¦ã€ä½ LR- çš„æª¢é©—<br/>
                â€¢ <strong>ç¢ºè¨ºç›®çš„</strong>ï¼šé¸é«˜ç‰¹ç•°åº¦ã€é«˜ LR+ çš„æª¢é©—<br/>
                â€¢ <strong>é€£çºŒæª¢é©—</strong>ï¼šå…ˆç¯©æª¢å¾Œç¢ºè¨ºï¼Œé€æ­¥æé«˜ç¢ºå®šæ€§
                </span>
            </div>
        </div>
    );

    const Lesson=()=>{
        const l=lessons.find(x=>x.id===lessonId);
        return(
            <div>
                <Header title={l.title}/>
                <div style={{background:`linear-gradient(135deg,${l.color},${l.color}88)`,padding:'20px',color:'#fff'}}>
                    <div style={{maxWidth:480,margin:'0 auto'}}>
                        <div style={{fontSize:12,opacity:0.9}}>Lesson {l.id} â€¢ {l.sub}</div>
                        <h1 style={{fontSize:24,fontWeight:700}}>{l.title}</h1>
                    </div>
                </div>
                <div style={{padding:'20px 16px'}}>
                    <div style={{maxWidth:480,margin:'0 auto'}}>
                        {lessonId===1&&<L1/>}{lessonId===2&&<L2/>}{lessonId===3&&<L3/>}{lessonId===4&&<L4/>}{lessonId===5&&<L5/>}
                        <div style={{display:'flex',gap:12,marginTop:24}}>
                            {lessonId>1&&<button className="btn" style={{flex:1,background:'#fff',border:'2px solid var(--pri)',color:'var(--pri)'}} onClick={()=>setLessonId(lessonId-1)}>â† ä¸Šä¸€èª²</button>}
                            {lessonId<5?<button className="btn btn-pri" style={{flex:1}} onClick={()=>setLessonId(lessonId+1)}>ä¸‹ä¸€èª² â†’</button>
                            :<button className="btn btn-pri" style={{flex:1}} onClick={()=>{setQIdx(0);setScore(0);setSel(null);setShow(false);setDone(false);setPage('quiz')}}>é–‹å§‹æ¸¬é©— ğŸ“</button>}
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const Quiz=()=>{
        const pick=(i)=>{if(show)return;setSel(i);setShow(true);if(i===quiz[qIdx].c)setScore(score+1)};
        const next=()=>{if(qIdx<quiz.length-1){setQIdx(qIdx+1);setSel(null);setShow(false)}else setDone(true)};

        if(done){
            const pct=Math.round((score/quiz.length)*100);
            return(
                <div>
                    <Header title="æ¸¬é©—çµæœ"/>
                    <div style={{padding:'40px 16px',textAlign:'center'}}>
                        <div style={{width:140,height:140,borderRadius:'50%',background:`conic-gradient(${pct>=80?'var(--suc)':pct>=60?'var(--warn)':'var(--err)'} ${pct*3.6}deg,#E5E5E5 0deg)`,display:'flex',alignItems:'center',justifyContent:'center',margin:'0 auto 24px'}}>
                            <div style={{width:120,height:120,borderRadius:'50%',background:'#fff',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center'}}>
                                <div style={{fontSize:36,fontWeight:700}}>{pct}%</div>
                                <div style={{fontSize:14,color:'var(--txt2)'}}>{score}/{quiz.length}</div>
                            </div>
                        </div>
                        <h2 style={{fontSize:24,fontWeight:700,marginBottom:8}}>{pct>=80?'ğŸ‰ å¤ªæ£’äº†ï¼':pct>=60?'ğŸ‘ ä¸éŒ¯ï¼':'ğŸ’ª åŠ æ²¹ï¼'}</h2>
                        <p style={{color:'var(--txt2)',marginBottom:32}}>{pct>=80?'ä½ å°è¨ºæ–·ç ”ç©¶æœ‰å¾ˆå¥½çš„æŒæ¡ï¼':pct>=60?'å†è¤‡ç¿’å¯ä»¥æ›´é€²æ­¥ï¼':'å»ºè­°é‡æ–°é–±è®€èª²ç¨‹'}</p>
                        <div style={{display:'flex',gap:12,justifyContent:'center',flexWrap:'wrap'}}>
                            <button className="btn btn-pri" onClick={()=>{setQIdx(0);setScore(0);setSel(null);setShow(false);setDone(false)}}>é‡æ–°æ¸¬é©—</button>
                            <button className="btn" style={{background:'#fff',border:'2px solid var(--pri)',color:'var(--pri)'}} onClick={()=>setPage('home')}>è¿”å›èª²ç¨‹</button>
                        </div>
                    </div>
                    <footer style={{background:'#FFF0F5',padding:'24px 16px',textAlign:'center',marginTop:40}}>
                        <p style={{fontSize:12,color:'var(--txt2)'}}>æ–°ç«¹å°å¤§åˆ†é™¢æ•™å­¸éƒ¨ | è¬æ…•æš MD, PhD, FESC | é»ƒæ²›éŠ“ MD | é»ƒåœ‹è‰¯</p>
                    </footer>
                </div>
            );
        }

        const q=quiz[qIdx];
        return(
            <div>
                <Header title="è‡ªæˆ‘æ¸¬é©—"/>
                <div style={{padding:'20px 16px'}}>
                    <div style={{maxWidth:480,margin:'0 auto'}}>
                        <div style={{display:'flex',justifyContent:'space-between',marginBottom:8,fontSize:14}}>
                            <span style={{color:'var(--txt2)'}}>é€²åº¦</span>
                            <span style={{fontWeight:600,color:'var(--pri)'}}>{qIdx+1}/{quiz.length}</span>
                        </div>
                        <div style={{height:8,background:'#E5E5E5',borderRadius:4,marginBottom:20}}>
                            <div style={{height:'100%',width:`${((qIdx+1)/quiz.length)*100}%`,background:'linear-gradient(90deg,var(--pri),var(--pri2))',borderRadius:4,transition:'width 0.3s'}}/>
                        </div>
                        <div className="card">
                            <h3 style={{fontSize:16,fontWeight:600,lineHeight:1.6,marginBottom:20}}>{q.q}</h3>
                            {q.o.map((opt,i)=>{
                                let bg='#fff',bd='#E5E5E5';
                                if(show){
                                    if(i===q.c){bg='#F0FFF4';bd='var(--suc)'}
                                    else if(i===sel){bg='#FFF5F5';bd='var(--err)'}
                                }else if(i===sel){bg='#FFF0F5';bd='var(--pri)'}
                                return(
                                    <button key={i} onClick={()=>pick(i)} disabled={show} style={{width:'100%',padding:'12px 14px',marginBottom:10,background:bg,border:`2px solid ${bd}`,borderRadius:12,textAlign:'left',fontSize:14,cursor:show?'default':'pointer',display:'flex',alignItems:'center',gap:12}}>
                                        <span style={{width:26,height:26,borderRadius:8,background:show&&i===q.c?'var(--suc)':show&&i===sel?'var(--err)':'#FFF0F5',color:show&&(i===q.c||i===sel)?'#fff':'var(--pri)',display:'flex',alignItems:'center',justifyContent:'center',fontWeight:700,fontSize:13,flexShrink:0}}>
                                            {show&&i===q.c?'âœ”':show&&i===sel&&i!==q.c?'âœ—':String.fromCharCode(65+i)}
                                        </span>
                                        <span style={{lineHeight:1.5}}>{opt}</span>
                                    </button>
                                );
                            })}
                        </div>
                        {show&&(
                            <div className={sel===q.c?'good':'tip'}>
                                <strong style={{color:sel===q.c?'var(--suc)':'var(--warn)'}}>{sel===q.c?'âœ” æ­£ç¢ºï¼':'âœ— ç­”éŒ¯äº†'}</strong>
                                <p style={{fontSize:14,color:'var(--txt2)',marginTop:8,lineHeight:1.7}}>{q.e}</p>
                            </div>
                        )}
                        {show&&<button className="btn btn-pri" style={{width:'100%',justifyContent:'center',marginTop:16}} onClick={next}>{qIdx<quiz.length-1?'ä¸‹ä¸€é¡Œ â†’':'æŸ¥çœ‹çµæœ'}</button>}
                    </div>
                </div>
            </div>
        );
    };

    return <div style={{maxWidth:'100%',minHeight:'100vh',background:'var(--bg)'}}><BadgeToast badges={newBadges} onClose={closeBadge} />{page==='home'?<Home/>:page==='lesson'?<Lesson/>:<Quiz/>}</div>;
};

ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
