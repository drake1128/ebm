<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ç»æœå°‹è¨“ç·´ | EBM æ•™å­¸å¹³å°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--pri:#7209B7;--pri2:#4361EE;--acc:#FF6B35;--suc:#2EC4B6;--warn:#FFBE0B;--err:#EF476F;--blue:#0077B6;--bg:#FAFBFC;--txt:#1A1A2E;--txt2:#6B7280}
        body{font-family:'Noto Sans TC',sans-serif;background:var(--bg);color:var(--txt);line-height:1.7}
        .card{background:#fff;border-radius:16px;padding:20px;margin-bottom:16px;box-shadow:0 2px 12px rgba(114,9,183,0.08)}
        .btn{padding:14px 24px;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px;transition:all 0.3s}
        .btn:hover{transform:translateY(-2px)}
        .btn-pri{background:linear-gradient(135deg,var(--pri),var(--pri2));color:#fff}
        .btn-acc{background:linear-gradient(135deg,var(--acc),#F7931E);color:#fff}
        .btn-suc{background:linear-gradient(135deg,var(--suc),#06D6A0);color:#fff}
        .btn-blue{background:linear-gradient(135deg,var(--blue),#00B4D8);color:#fff}
        .btn-outline{background:#fff;border:2px solid var(--pri);color:var(--pri)}
        .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
        table{width:100%;border-collapse:collapse;font-size:13px;margin:12px 0}
        th,td{padding:10px;text-align:left;border-bottom:1px solid #eee}
        th{background:#EDE7F6;font-weight:600;color:var(--pri)}
        .formula{background:linear-gradient(135deg,#EDE7F6,#E3F2FD);border:2px solid var(--pri2);border-radius:12px;padding:16px;margin:12px 0;text-align:center;font-size:15px;color:#311B92;font-weight:600;font-family:'Consolas','Monaco',monospace}
        .tip{background:#FFF9F0;border-left:4px solid var(--acc);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .good{background:#F0FFF4;border-left:4px solid var(--suc);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .info{background:#F0F7FF;border-left:4px solid var(--blue);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .purple{background:#F3E5F5;border-left:4px solid var(--pri);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .warn{background:#FFFDE7;border-left:4px solid var(--warn);border-radius:0 12px 12px 0;padding:14px;margin:12px 0}
        .pico-input{width:100%;padding:14px 16px;border:2px solid #E5E5E5;border-radius:12px;font-size:15px;font-family:'Noto Sans TC',sans-serif;transition:all 0.3s;background:#fff}
        .pico-input:focus{outline:none;border-color:var(--pri);box-shadow:0 0 0 3px rgba(114,9,183,0.1)}
        .pico-input::placeholder{color:#9CA3AF}
        .search-output{background:linear-gradient(135deg,#EDE7F6,#E3F2FD);border:2px solid var(--pri2);border-radius:12px;padding:16px;font-family:'Consolas','Monaco',monospace;font-size:13px;word-break:break-all;line-height:1.6;min-height:60px}
        .template-card{background:#fff;border:2px solid #E5E5E5;border-radius:12px;padding:12px;cursor:pointer;transition:all 0.3s}
        .template-card:hover{border-color:var(--pri);transform:translateY(-2px)}
        .template-card.active{border-color:var(--pri);background:#F3E5F5}
        .copy-feedback{position:fixed;top:20px;right:20px;background:var(--suc);color:#fff;padding:12px 20px;border-radius:10px;font-weight:600;z-index:1000;animation:fadeIn 0.3s}
        @keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useMemo,useEffect}=React;

const MODULE_ID='literature-search';

// Badge definitions for notifications
const badgeDefs = {
    'first-quiz': { name: 'åˆè©¦å•¼è²', icon: 'ğŸ¯' },
    'perfect-score': { name: 'æ»¿åˆ†é”äºº', icon: 'ğŸ’¯' },
    'five-complete': { name: 'å°æœ‰æˆå°±', icon: 'â­' },
    'ten-complete': { name: 'å­¸æœ‰å°ˆç²¾', icon: 'ğŸŒŸ' },
    'master': { name: 'EBMå¤§å¸«', icon: 'ğŸ‘‘' },
    'speed-demon': { name: 'ç¥é€Ÿç­”é¡Œ', icon: 'âš¡' },
    'persistent': { name: 'å …æŒä¸æ‡ˆ', icon: 'ğŸ’ª' },
    'three-streak': { name: 'é€£å‹ä¸‰å ´', icon: 'ğŸ”¥' },
    'five-streak': { name: 'äº”é€£å‹', icon: 'ğŸ†' },
    'triple-perfect': { name: 'ä¸‰å† ç‹', icon: 'ğŸ‘‘' },
    'early-bird': { name: 'æ—©èµ·çš„é³¥', icon: 'ğŸ¦' },
    'night-owl': { name: 'å¤œè²“å­', icon: 'ğŸ¦‰' },
    'weekend-warrior': { name: 'å‡æ—¥æˆ°å£«', icon: 'ğŸ“…' },
    'comeback-kid': { name: 'é€†è½‰å‹', icon: 'ğŸš€' },
    'quick-learner': { name: 'ä¸€é»å°±é€š', icon: 'ğŸ’¡' },
    'improvement-king': { name: 'é€²æ­¥ç‹', icon: 'ğŸ“ˆ' },
    'marathon-runner': { name: 'é¦¬æ‹‰æ¾å­¸ç¿’è€…', icon: 'ğŸƒ' },
    'reviewer': { name: 'æº«æ•…çŸ¥æ–°', icon: 'ğŸ“–' },
    'almost-there': { name: 'å·®ä¸€é»é»', icon: 'ğŸ˜…' },
    'generous-guesser': { name: 'ä½›ç³»ç­”é¡Œ', icon: 'ğŸ™' },
    'learning-worm': { name: 'å­¸è¡“èš¯èš“', icon: 'ğŸª±' },
    'eternal-student': { name: 'æ°¸æ†çš„å­¸ç”Ÿ', icon: 'â™¾ï¸' },
    'speed-fail': { name: 'å…‰é€Ÿé™£äº¡', icon: 'ğŸ’«' },
    'slow-and-wrong': { name: 'æƒ³å¾ˆä¹…é‚„æ˜¯éŒ¯', icon: 'ğŸ¤”' },
    'zero-hero': { name: 'é›¶åˆ†è‹±é›„', icon: 'ğŸ’€' },
    'procrastinator': { name: 'æœ€å¾Œä¸€ç§’', icon: 'â°' },
    'deja-vu': { name: 'æ—¢è¦–æ„Ÿ', icon: 'ğŸ‘€' },
    'coffee-needed': { name: 'éœ€è¦å’–å•¡', icon: 'â˜•' },
    'wanderer': { name: 'æ¼«éŠè€…', icon: 'ğŸ§­' },
    'consistent-output': { name: 'ç©©å®šè¼¸å‡º', icon: 'ğŸ¯' },
    'heart-expert': { name: 'å¿ƒè‡Ÿé”äºº', icon: 'â¤ï¸' },
    'critical-master': { name: 'æ€¥é‡ç—‡å°ˆå®¶', icon: 'ğŸš¨' },
    'neuro-ninja': { name: 'ç¥ç¶“å¿è€…', icon: 'ğŸ§ ' },
    'pulm-pro': { name: 'èƒ¸è…”é«˜æ‰‹', icon: 'ğŸ«' },
    'ebm-foundation': { name: 'EBMåŸºçŸ³', icon: 'ğŸ›ï¸' },
    'jama-collector': { name: 'JAMAæ”¶è—å®¶', icon: 'ğŸ“š' },
    'achievement-hunter': { name: 'æˆå°±çµäºº', icon: 'ğŸ…' },
    'lucky-seven': { name: 'å¹¸é‹ä¸ƒ', icon: 'ğŸ€' },
    'completionist': { name: 'å…¨æˆå°±é”æˆ', icon: 'ğŸ–ï¸' }
};

const categoryModules = {
    cardio: ['jama-chest-pain-acs', 'jama-syncope', 'jama-hypertension'],
    critical: ['jama-bacteremia', 'jama-gi-bleed', 'jama-fluid-responsiveness', 'jama-difficult-intubation', 'jama-cirrhosis', 'jama-wound-infection'],
    neuro: ['jama-head-trauma', 'jama-delirium', 'jama-decision-capacity'],
    pulm: ['jama-pleural-effusion', 'jama-osa'],
    core: ['critical-appraisal', 'diagnostic-study', 'prognosis-study', 'rct-appraisal', 'systematic-review', 'literature-search']
};

const ProgressTracker={
    STORAGE_KEY:'ebm-progress',
    newBadges: [],
    getProgress:()=>{try{const d=localStorage.getItem(ProgressTracker.STORAGE_KEY);return d?JSON.parse(d):{version:1,modules:{},badges:[],totalTimeSpent:0,streakData:{currentPassStreak:0,currentPerfectStreak:0},lastActivityDate:null}}catch{return{version:1,modules:{},badges:[],totalTimeSpent:0,streakData:{currentPassStreak:0,currentPerfectStreak:0},lastActivityDate:null}}},
    saveQuizResult:(moduleId,score,total,timeSpent)=>{
        ProgressTracker.newBadges = [];
        const progress=ProgressTracker.getProgress();
        const mod=progress.modules[moduleId]||{bestScore:0,totalAttempts:0,allAttempts:[],lessonsViewed:[],completed:false,firstCompleted:null};
        const attempt={date:new Date().toISOString(),score,timeSpent};
        mod.allAttempts.push(attempt);mod.totalAttempts++;
        if(score>mod.bestScore)mod.bestScore=score;
        const passingScore=Math.ceil(total*0.7);
        if(score>=passingScore&&!mod.completed){mod.completed=true;mod.firstCompleted=attempt.date}
        progress.modules[moduleId]=mod;progress.totalTimeSpent+=timeSpent;progress.lastUpdated=new Date().toISOString();
        ProgressTracker.checkBadges(progress,moduleId,score,total,timeSpent);
        localStorage.setItem(ProgressTracker.STORAGE_KEY,JSON.stringify(progress));return progress;
    },
    checkBadges:(progress,moduleId,score,total,timeSpent)=>{
        const badges=progress.badges||[];const ids=badges.map(b=>b.id);const now=new Date();const nowStr=now.toISOString();
        const hour=now.getHours();const day=now.getDay();
        const passed=score>=Math.ceil(total*0.7);const perfect=score===total;
        const addBadge=(id)=>{if(!ids.includes(id)){badges.push({id,earnedAt:nowStr});ids.push(id);ProgressTracker.newBadges.push(id);return true}return false};

        addBadge('first-quiz');
        if(perfect)addBadge('perfect-score');
        if(timeSpent<120&&passed)addBadge('speed-demon');
        const completed=Object.values(progress.modules).filter(m=>m.completed).length;
        if(completed>=5)addBadge('five-complete');
        if(completed>=10)addBadge('ten-complete');
        if(completed>=18)addBadge('master');
        const mod=progress.modules[moduleId];
        if(mod&&mod.totalAttempts>=3)addBadge('persistent');

        if(hour<6)addBadge('early-bird');
        if(hour>=0&&hour<5)addBadge('night-owl');
        if(day===0||day===6)addBadge('weekend-warrior');
        if(hour>=2&&hour<5&&!passed)addBadge('coffee-needed');

        const streakData=progress.streakData||{currentPassStreak:0,currentPerfectStreak:0};
        if(passed){streakData.currentPassStreak++;if(perfect)streakData.currentPerfectStreak++;else streakData.currentPerfectStreak=0}
        else{streakData.currentPassStreak=0;streakData.currentPerfectStreak=0}
        if(streakData.currentPassStreak>=3)addBadge('three-streak');
        if(streakData.currentPassStreak>=5)addBadge('five-streak');
        if(streakData.currentPerfectStreak>=3)addBadge('triple-perfect');
        progress.streakData=streakData;

        if(mod){
            if(mod.totalAttempts===1&&perfect)addBadge('quick-learner');
            if(mod.totalAttempts===1&&score===7)addBadge('lucky-seven');
            if(mod.allAttempts&&mod.allAttempts.length>1){
                const firstScore=mod.allAttempts[0].score;
                if(firstScore<7&&perfect)addBadge('comeback-kid');
                if(score-firstScore>=5)addBadge('improvement-king');
                const lastThree=mod.allAttempts.slice(-3);
                if(lastThree.length===3&&lastThree[0].score===lastThree[1].score&&lastThree[1].score===lastThree[2].score)addBadge('deja-vu');
                if(lastThree.length===3&&lastThree.every(a=>a.score===score))addBadge('consistent-output');
            }
            if(mod.totalAttempts>=10)addBadge('learning-worm');
            if(mod.completed&&mod.totalAttempts>1&&passed)addBadge('reviewer');
        }

        if(score===6)addBadge('almost-there');
        if(score===0)addBadge('zero-hero');
        if(score>=2&&score<=3)addBadge('generous-guesser');
        if(timeSpent<30&&!passed)addBadge('speed-fail');
        if(timeSpent>600&&!passed)addBadge('slow-and-wrong');

        const totalAttempts=Object.values(progress.modules).reduce((sum,m)=>sum+(m.totalAttempts||0),0);
        if(totalAttempts>=50&&completed<18)addBadge('eternal-student');
        const startedNotCompleted=Object.values(progress.modules).filter(m=>m.totalAttempts>0&&!m.completed).length;
        if(startedNotCompleted>=5&&completed===0)addBadge('wanderer');

        if(progress.lastActivityDate){
            const lastActivity=new Date(progress.lastActivityDate);
            const daysSince=(now-lastActivity)/(1000*60*60*24);
            if(daysSince>=7)addBadge('procrastinator');
        }
        progress.lastActivityDate=nowStr;

        const checkCat=(cat,badgeId)=>{const mods=categoryModules[cat]||[];if(mods.length>0&&mods.every(id=>progress.modules[id]?.completed))addBadge(badgeId)};
        checkCat('cardio','heart-expert');
        checkCat('critical','critical-master');
        checkCat('neuro','neuro-ninja');
        checkCat('pulm','pulm-pro');
        checkCat('core','ebm-foundation');
        const jamaComplete=Object.keys(progress.modules).filter(k=>k.startsWith('jama-')&&progress.modules[k]?.completed).length;
        if(jamaComplete>=12)addBadge('jama-collector');

        if(badges.length>=10)addBadge('achievement-hunter');
        if(badges.length>=39)addBadge('completionist');

        progress.badges=badges;
    }
};

const BadgeToast = ({ badges, onClose }) => {
    if (!badges || badges.length === 0) return null;
    return (
        <div style={{position:'fixed',top:20,right:20,zIndex:9999,display:'flex',flexDirection:'column',gap:10}}>
            {badges.map((badgeId, i) => {
                const badge = badgeDefs[badgeId];
                if (!badge) return null;
                return (
                    <div key={badgeId} style={{
                        background:'linear-gradient(135deg, #FFD700, #FFA500)',
                        padding:'16px 20px',borderRadius:16,boxShadow:'0 8px 32px rgba(0,0,0,0.2)',
                        display:'flex',alignItems:'center',gap:12,animation:'slideIn 0.5s ease-out',minWidth:240
                    }}>
                        <span style={{fontSize:36}}>{badge.icon}</span>
                        <div style={{flex:1}}>
                            <div style={{fontSize:12,fontWeight:600,color:'#5D4037'}}>æ–°æˆå°±è§£é–!</div>
                            <div style={{fontSize:16,fontWeight:700,color:'#3E2723'}}>{badge.name}</div>
                        </div>
                        <button onClick={()=>onClose(badgeId)} style={{background:'rgba(0,0,0,0.1)',border:'none',borderRadius:8,width:28,height:28,cursor:'pointer',fontSize:14}}>âœ•</button>
                    </div>
                );
            })}
            <style>{`@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}`}</style>
        </div>
    );
};

const lessons=[
    {id:1,title:'æ–‡ç»æœå°‹å°è«–',sub:'Why Systematic Searching Matters',color:'#7209B7'},
    {id:2,title:'PICO æ¶æ§‹èˆ‡å•é¡Œå»ºæ§‹',sub:'Building Answerable Questions',color:'#4361EE'},
    {id:3,title:'PubMed æœå°‹ç­–ç•¥',sub:'Boolean Operators & MeSH',color:'#0077B6'},
    {id:4,title:'Cochrane Library å°è¦½',sub:'Finding Systematic Reviews',color:'#2EC4B6'},
    {id:5,title:'é€²éšæœå°‹æŠ€å·§',sub:'Advanced Search & Citation Management',color:'#FF6B35'}
];

const quiz=[
    {q:'PICOä¸­çš„ã€ŒPã€ä»£è¡¨ä»€éº¼ï¼Ÿ',o:['Problem å•é¡Œ','Patient/Population ç—…äºº/æ—ç¾¤','Prognosis é å¾Œ','Prevention é é˜²'],c:1,e:'Pä»£è¡¨Patient/Populationï¼ˆç—…äºº/æ—ç¾¤ï¼‰ï¼Œæè¿°æ‚¨æƒ³ç ”ç©¶çš„ç—…äººç¾¤é«”ç‰¹å¾µï¼ŒåŒ…æ‹¬å¹´é½¡ã€æ€§åˆ¥ã€ç–¾ç—…ç‹€æ…‹ç­‰ã€‚'},
    {q:'åœ¨PubMedæœå°‹ä¸­ï¼Œä½¿ç”¨ã€ŒANDã€é‹ç®—å­çš„æ•ˆæœç‚ºä½•ï¼Ÿ',o:['æ“´å¤§æœå°‹çµæœ','ç¸®å°æœå°‹çµæœ','æ’é™¤æŸäº›çµæœ','æœå°‹åŒç¾©è©'],c:1,e:'ANDé‹ç®—å­è¦æ±‚æ‰€æœ‰é—œéµè©éƒ½å¿…é ˆå‡ºç¾åœ¨æ–‡ç« ä¸­ï¼Œå› æ­¤æœƒç¸®å°æœå°‹çµæœã€‚ä¾‹å¦‚ï¼š"diabetes AND metformin"åªæœƒæ‰¾åˆ°åŒæ™‚åŒ…å«é€™å…©å€‹è©çš„æ–‡ç« ã€‚'},
    {q:'ä¸‹åˆ—ä½•è€…æ˜¯MeSHè©å½™çš„ä¸»è¦å„ªé»ï¼Ÿ',o:['æœå°‹é€Ÿåº¦è¼ƒå¿«','å¯ä»¥æ‰¾åˆ°ä½¿ç”¨ä¸åŒè¡“èªæè¿°ç›¸åŒæ¦‚å¿µçš„æ–‡ç« ','å¯ä»¥æœå°‹å…¨æ–‡','ä¸éœ€è¦å­¸ç¿’ä½¿ç”¨æ–¹æ³•'],c:1,e:'MeSH (Medical Subject Headings) æ˜¯æ¨™æº–åŒ–çš„é†«å­¸ä¸»é¡Œè©å½™ï¼Œå¯ä»¥å¹«åŠ©æ‰¾åˆ°ä½¿ç”¨ä¸åŒè¡“èªæè¿°ç›¸åŒæ¦‚å¿µçš„æ–‡ç« ï¼Œæé«˜æœå°‹çš„å®Œæ•´æ€§ã€‚'},
    {q:'å°æ–¼ã€Œç³–å°¿ç—…ç—…äººä½¿ç”¨Metforminç›¸è¼ƒæ–¼Sulfonylureaæ˜¯å¦èƒ½é™ä½å¿ƒè¡€ç®¡æ­»äº¡ã€é€™å€‹å•é¡Œï¼Œã€ŒIã€æ‡‰è©²æ˜¯ä»€éº¼ï¼Ÿ',o:['ç³–å°¿ç—…ç—…äºº','Metformin','å¿ƒè¡€ç®¡æ­»äº¡','Sulfonylurea'],c:1,e:'Iä»£è¡¨Interventionï¼ˆä»‹å…¥æªæ–½ï¼‰ï¼Œåœ¨é€™å€‹å•é¡Œä¸­ï¼Œæˆ‘å€‘æƒ³è©•ä¼°çš„ä»‹å…¥æªæ–½æ˜¯Metforminã€‚Sulfonylureaæ˜¯æ¯”è¼ƒå°è±¡ï¼ˆCï¼‰ï¼Œå¿ƒè¡€ç®¡æ­»äº¡æ˜¯çµæœï¼ˆOï¼‰ã€‚'},
    {q:'ä½¿ç”¨ã€ŒORã€é‹ç®—å­æœ€é©åˆç”¨æ–¼å“ªç¨®æƒ…æ³ï¼Ÿ',o:['é€£æ¥PICOçš„å„å€‹å…ƒç´ ','æœå°‹åŒç¾©è©æˆ–ç›¸é—œè©å½™','æ’é™¤ä¸ç›¸é—œæ–‡ç« ','é™åˆ¶ç™¼è¡¨å¹´ä»½'],c:1,e:'ORé‹ç®—å­é©åˆç”¨æ–¼æœå°‹åŒç¾©è©æˆ–ç›¸é—œè©å½™ï¼Œå¯ä»¥æ“´å¤§æœå°‹çµæœã€‚ä¾‹å¦‚ï¼š"heart attack" OR "myocardial infarction" OR "MI"ã€‚'},
    {q:'Cochrane Libraryä¸»è¦æ”¶éŒ„çš„å…§å®¹ç‚ºä½•ï¼Ÿ',o:['ç—…ä¾‹å ±å‘Š','ç³»çµ±æ€§å›é¡§èˆ‡çµ±åˆåˆ†æ','æ•™ç§‘æ›¸ç« ç¯€','å°ˆå®¶æ„è¦‹'],c:1,e:'Cochrane Libraryä¸»è¦æ”¶éŒ„ç³»çµ±æ€§å›é¡§(Systematic Reviews)èˆ‡çµ±åˆåˆ†æ(Meta-analyses)ï¼Œæ˜¯å°‹æ‰¾é«˜å“è³ªè­‰æ“šçš„é‡è¦è³‡æºã€‚'},
    {q:'ä¸‹åˆ—å“ªå€‹æœå°‹ç­–ç•¥æœ€èƒ½æ‰¾åˆ°éš¨æ©Ÿå°ç…§è©¦é©—ï¼Ÿ',o:['diabetes AND treatment','diabetes[MeSH] AND randomized controlled trial[pt]','diabetes OR RCT','"diabetes" NOT "type 2"'],c:1,e:'ä½¿ç”¨[pt]ï¼ˆpublication typeï¼‰é™å®šæœå°‹éš¨æ©Ÿå°ç…§è©¦é©—æ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚[MeSH]å¯ä»¥æ“´å¤§ç–¾ç—…ç›¸é—œæ–‡ç« çš„æœå°‹ç¯„åœã€‚'},
    {q:'PICOå•é¡Œä¸­çš„ã€ŒCã€å¦‚æœç©ºç™½ï¼Œä»£è¡¨ä»€éº¼æ„æ€ï¼Ÿ',o:['å•é¡Œæ ¼å¼éŒ¯èª¤','æ¯”è¼ƒå°è±¡ç‚ºå®‰æ…°åŠ‘æˆ–ç„¡æ²»ç™‚','æœå°‹æœƒå¤±æ•—','çµæœç„¡æ³•æ¯”è¼ƒ'],c:1,e:'ç•¶Cï¼ˆComparisonï¼‰ç©ºç™½æ™‚ï¼Œé€šå¸¸ä»£è¡¨æ¯”è¼ƒå°è±¡ç‚ºå®‰æ…°åŠ‘ã€ç„¡æ²»ç™‚æˆ–æ¨™æº–ç…§è­·ã€‚é€™åœ¨è¨±å¤šè‡¨åºŠå•é¡Œä¸­æ˜¯åˆç†çš„ã€‚'},
    {q:'åœ¨æ–‡ç»æœå°‹æ™‚ï¼Œç‚ºä»€éº¼è¦è¨˜éŒ„æœå°‹ç­–ç•¥ï¼Ÿ',o:['ç¯€çœæ™‚é–“','ç¢ºä¿æœå°‹å¯é‡è¤‡æ€§èˆ‡é€æ˜æ€§','å¢åŠ æœå°‹çµæœ','ç¬¦åˆæœŸåˆŠè¦æ±‚'],c:1,e:'è¨˜éŒ„æœå°‹ç­–ç•¥å¯ä»¥ç¢ºä¿ç ”ç©¶çš„å¯é‡è¤‡æ€§èˆ‡é€æ˜æ€§ï¼Œé€™æ˜¯ç³»çµ±æ€§å›é¡§å’Œå¯¦è­‰é†«å­¸çš„æ ¸å¿ƒåŸå‰‡ä¹‹ä¸€ã€‚'},
    {q:'ä¸‹åˆ—é—œæ–¼PubMedæˆªè©æœå°‹(Truncation)çš„æ•˜è¿°ï¼Œä½•è€…æ­£ç¢ºï¼Ÿ',o:['ä½¿ç”¨ # ç¬¦è™Ÿ','ä½¿ç”¨ * ç¬¦è™Ÿå¯ä»¥æœå°‹ç›¸åŒå­—æ ¹çš„è®ŠåŒ–å½¢å¼','åªèƒ½ç”¨æ–¼MeSHè©å½™','æœƒæ¸›å°‘æœå°‹çµæœ'],c:1,e:'åœ¨PubMedä¸­ä½¿ç”¨ * ç¬¦è™Ÿå¯ä»¥é€²è¡Œæˆªè©æœå°‹ã€‚ä¾‹å¦‚ï¼štherap* å¯ä»¥æ‰¾åˆ° therapy, therapies, therapeutic ç­‰ç›¸åŒå­—æ ¹çš„è®ŠåŒ–å½¢å¼ï¼Œæ“´å¤§æœå°‹ç¯„åœã€‚'}
];

const picoTemplates=[
    {id:'cardio-1',specialty:'å¿ƒè‡Ÿå…§ç§‘',icon:'â¤ï¸',color:'#E63946',title:'æ€¥æ€§å¿ƒè‚Œæ¢—å¡æŠ—è¡€å°æ¿æ²»ç™‚',p:'acute myocardial infarction, STEMI',i:'ticagrelor, prasugrel',c:'clopidogrel',o:'major adverse cardiovascular events, bleeding, mortality'},
    {id:'cardio-2',specialty:'å¿ƒè‡Ÿå…§ç§‘',icon:'â¤ï¸',color:'#E63946',title:'å¿ƒæˆ¿é¡«å‹•æŠ—å‡æ²»ç™‚',p:'atrial fibrillation, AF',i:'NOAC, apixaban, rivaroxaban, dabigatran',c:'warfarin',o:'stroke, systemic embolism, major bleeding'},
    {id:'onco-1',specialty:'è…«ç˜¤ç§‘',icon:'ğŸ—ï¸',color:'#9B59B6',title:'éå°ç´°èƒè‚ºç™Œå…ç–«æ²»ç™‚',p:'non-small cell lung cancer, NSCLC',i:'pembrolizumab, nivolumab, immunotherapy',c:'chemotherapy, platinum-based',o:'overall survival, progression-free survival'},
    {id:'peds-1',specialty:'å…’ç§‘',icon:'ğŸ‘¶',color:'#27AE60',title:'å…’ç«¥ä¸­è€³ç‚æŠ—ç”Ÿç´ æ²»ç™‚',p:'acute otitis media, children, pediatric',i:'amoxicillin, antibiotic',c:'watchful waiting, placebo',o:'symptom resolution, treatment failure'},
    {id:'infect-1',specialty:'æ„ŸæŸ“ç§‘',icon:'ğŸ¦ ',color:'#F39C12',title:'ç¤¾å€å‹è‚ºç‚æ²»ç™‚',p:'community-acquired pneumonia, CAP',i:'azithromycin, respiratory fluoroquinolone',c:'beta-lactam, amoxicillin-clavulanate',o:'clinical cure, mortality, hospital stay'},
    {id:'neuro-1',specialty:'ç¥ç¶“å…§ç§‘',icon:'ğŸ§ ',color:'#3498DB',title:'æ€¥æ€§ç¼ºè¡€æ€§ä¸­é¢¨è¡€æ “æº¶è§£',p:'acute ischemic stroke',i:'alteplase, tPA, thrombolysis',c:'standard care, placebo',o:'functional outcome, mRS, intracerebral hemorrhage'},
    {id:'endo-1',specialty:'å…§åˆ†æ³Œç§‘',icon:'ğŸ©º',color:'#1ABC9C',title:'ç¬¬äºŒå‹ç³–å°¿ç—…SGLT2æŠ‘åˆ¶åŠ‘',p:'type 2 diabetes mellitus, T2DM',i:'SGLT2 inhibitor, empagliflozin, dapagliflozin',c:'placebo, standard care',o:'HbA1c, cardiovascular death, heart failure'},
    {id:'rheum-1',specialty:'é¢¨æ¿•å…ç–«ç§‘',icon:'ğŸ¦´',color:'#8E44AD',title:'é¡é¢¨æ¿•æ€§é—œç¯€ç‚ç”Ÿç‰©è£½åŠ‘',p:'rheumatoid arthritis, RA',i:'TNF inhibitor, adalimumab, etanercept',c:'methotrexate, DMARD',o:'ACR response, DAS28, radiographic progression'}
];

const App=()=>{
    const[page,setPage]=useState('home');
    const[lessonId,setLessonId]=useState(1);
    const[qIdx,setQIdx]=useState(0);
    const[score,setScore]=useState(0);
    const[sel,setSel]=useState(null);
    const[show,setShow]=useState(false);
    const[done,setDone]=useState(false);
    const[picoData,setPicoData]=useState({p:'',i:'',c:'',o:''});
    const[copied,setCopied]=useState('');
    const[activeTemplate,setActiveTemplate]=useState(null);
    const[quizStartTime,setQuizStartTime]=useState(null);
    const[newBadges,setNewBadges]=useState([]);

    useEffect(()=>{if(page==='quiz'&&!done&&!quizStartTime)setQuizStartTime(Date.now())},[page,done]);
    useEffect(()=>{if(done&&quizStartTime){const t=Math.round((Date.now()-quizStartTime)/1000);ProgressTracker.saveQuizResult(MODULE_ID,score,quiz.length,t);if(ProgressTracker.newBadges.length>0){setNewBadges([...ProgressTracker.newBadges])}}},[done]);
    useEffect(()=>{if(newBadges.length>0){const timer=setTimeout(()=>{setNewBadges(prev=>prev.slice(1))},4000);return ()=>clearTimeout(timer)}},[newBadges]);

    const closeBadge=(badgeId)=>{setNewBadges(prev=>prev.filter(id=>id!==badgeId))};

    // Helper: split by comma and create OR group for synonyms
    const buildTermGroup=(input,field)=>{
        const terms=input.split(',').map(t=>t.trim()).filter(Boolean);
        if(terms.length===0)return '';
        if(terms.length===1){
            // Single term: search in title/abstract
            return `(${terms[0]}${field})`;
        }
        // Multiple terms: OR them together
        return '('+terms.map(t=>`${t}${field}`).join(' OR ')+')';
    };

    const generatePubMedSearch=(pico)=>{
        const parts=[];
        // P and I are more important - search broadly
        if(pico.p.trim()){
            const terms=pico.p.split(',').map(t=>t.trim()).filter(Boolean);
            if(terms.length===1){
                parts.push(`(${terms[0]}[Title/Abstract] OR ${terms[0]}[MeSH Terms])`);
            }else{
                parts.push('('+terms.map(t=>`${t}[Title/Abstract]`).join(' OR ')+')');
            }
        }
        if(pico.i.trim()){
            const terms=pico.i.split(',').map(t=>t.trim()).filter(Boolean);
            if(terms.length===1){
                parts.push(`(${terms[0]}[Title/Abstract] OR ${terms[0]}[MeSH Terms])`);
            }else{
                parts.push('('+terms.map(t=>`${t}[Title/Abstract]`).join(' OR ')+')');
            }
        }
        // C and O are optional and less restrictive
        if(pico.c.trim()){
            const terms=pico.c.split(',').map(t=>t.trim()).filter(Boolean);
            parts.push('('+terms.map(t=>`${t}[Title/Abstract]`).join(' OR ')+')');
        }
        if(pico.o.trim()){
            const terms=pico.o.split(',').map(t=>t.trim()).filter(Boolean);
            parts.push('('+terms.map(t=>`${t}[Title/Abstract]`).join(' OR ')+')');
        }
        return parts.join(' AND ');
    };

    const generateCochraneSearch=(pico)=>{
        const parts=[];
        // Split by comma and OR the terms
        if(pico.p.trim()){
            const terms=pico.p.split(',').map(t=>t.trim()).filter(Boolean);
            parts.push('('+terms.join(' OR ')+'):ti,ab,kw');
        }
        if(pico.i.trim()){
            const terms=pico.i.split(',').map(t=>t.trim()).filter(Boolean);
            parts.push('('+terms.join(' OR ')+'):ti,ab,kw');
        }
        if(pico.c.trim()){
            const terms=pico.c.split(',').map(t=>t.trim()).filter(Boolean);
            parts.push('('+terms.join(' OR ')+'):ti,ab,kw');
        }
        if(pico.o.trim()){
            const terms=pico.o.split(',').map(t=>t.trim()).filter(Boolean);
            parts.push('('+terms.join(' OR ')+'):ti,ab,kw');
        }
        return parts.join(' AND ');
    };

    const pubmedSearch=useMemo(()=>generatePubMedSearch(picoData),[picoData]);
    const cochraneSearch=useMemo(()=>generateCochraneSearch(picoData),[picoData]);
    const hasValidPico=picoData.p.trim()||picoData.i.trim();

    const copyToClipboard=(text,type)=>{
        navigator.clipboard.writeText(text);
        setCopied(type);
        setTimeout(()=>setCopied(''),2000);
    };

    const openPubMed=()=>{
        if(pubmedSearch){
            window.open(`https://pubmed.ncbi.nlm.nih.gov/?term=${encodeURIComponent(pubmedSearch)}`,'_blank');
        }
    };

    const openCochrane=()=>{
        if(cochraneSearch){
            window.open(`https://www.cochranelibrary.com/search?q=${encodeURIComponent(cochraneSearch)}`,'_blank');
        }
    };

    const selectTemplate=(template)=>{
        setActiveTemplate(template.id);
        // Fill input fields directly via DOM
        const pInput=document.getElementById('pico-p');
        const iInput=document.getElementById('pico-i');
        const cInput=document.getElementById('pico-c');
        const oInput=document.getElementById('pico-o');
        if(pInput)pInput.value=template.p;
        if(iInput)iInput.value=template.i;
        if(cInput)cInput.value=template.c;
        if(oInput)oInput.value=template.o;
        // Also update state to generate search strings
        setPicoData({p:template.p,i:template.i,c:template.c,o:template.o});
    };

    const clearPico=()=>{
        setPicoData({p:'',i:'',c:'',o:''});
        setActiveTemplate(null);
    };

    const Header=({title})=>(
        <header style={{background:'#fff',borderBottom:'1px solid #eee',padding:'12px 16px',position:'sticky',top:0,zIndex:10}}>
            <div style={{maxWidth:480,margin:'0 auto',display:'flex',alignItems:'center',gap:12}}>
                <button onClick={()=>page==='home'?window.location.href='index.html':setPage('home')} style={{background:'#EDE7F6',border:'none',borderRadius:10,width:40,height:40,cursor:'pointer',color:'var(--pri)',display:'flex',alignItems:'center',justifyContent:'center'}}>
                    <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                </button>
                <span style={{fontWeight:700,color:'#311B92'}}>{title}</span>
            </div>
        </header>
    );

    const Home=()=>(
        <div>
            <Header title="æ–‡ç»æœå°‹è¨“ç·´"/>
            <div style={{background:'linear-gradient(135deg,#7209B7,#4361EE)',padding:'32px 20px',color:'#fff'}}>
                <div style={{maxWidth:480,margin:'0 auto'}}>
                    <div style={{background:'rgba(255,255,255,0.2)',display:'inline-block',padding:'6px 14px',borderRadius:50,fontSize:12,fontWeight:600,marginBottom:16}}>ğŸ” Literature Search Training</div>
                    <h1 style={{fontSize:26,fontWeight:700,marginBottom:12}}>æ–‡ç»æœå°‹è¨“ç·´</h1>
                    <p style={{opacity:0.9,fontSize:14}}>ç³»çµ±æ€§å­¸ç¿’æ–‡ç»æœå°‹æŠ€å·§ï¼ŒæŒæ¡PICOå•é¡Œå»ºæ§‹èˆ‡è³‡æ–™åº«æŸ¥è©¢</p>
                </div>
            </div>
            <div style={{padding:'0 16px',marginTop:-20}}>
                <div style={{maxWidth:480,margin:'0 auto'}}>
                    <div className="card">
                        <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri)',marginBottom:12}}>ğŸ¯ å­¸ç¿’ç›®æ¨™</h3>
                        {['æŒæ¡PICOè‡¨åºŠå•é¡Œæ¶æ§‹ä¸¦èƒ½ç¨ç«‹æ§‹å»ºå•é¡Œ','å­¸æœƒä½¿ç”¨PubMedå¸ƒæ—é‹ç®—å­èˆ‡MeSHè©å½™','ç†Ÿæ‚‰Cochrane Libraryæœå°‹ç³»çµ±æ€§å›é¡§','èƒ½ç”¢ç”Ÿå¯åŸ·è¡Œçš„æ–‡ç»æœå°‹ç­–ç•¥'].map((t,i)=>(
                            <div key={i} style={{display:'flex',gap:10,marginBottom:8,fontSize:14}}>
                                <span style={{background:'var(--suc)',color:'#fff',borderRadius:6,width:22,height:22,display:'flex',alignItems:'center',justifyContent:'center',fontSize:12,flexShrink:0}}>{i+1}</span>
                                <span style={{color:'var(--txt2)'}}>{t}</span>
                            </div>
                        ))}
                    </div>
                    <h3 style={{fontSize:18,fontWeight:700,marginBottom:16}}>ğŸ“– èª²ç¨‹å…§å®¹</h3>
                    {lessons.map(l=>(
                        <div key={l.id} className="card" onClick={()=>{setLessonId(l.id);setPage('lesson')}} style={{cursor:'pointer'}}>
                            <div style={{display:'flex',alignItems:'center',gap:16}}>
                                <div style={{width:48,height:48,borderRadius:12,background:`linear-gradient(135deg,${l.color},${l.color}88)`,display:'flex',alignItems:'center',justifyContent:'center',color:'#fff',fontWeight:700}}>{l.id}</div>
                                <div style={{flex:1}}>
                                    <div style={{fontSize:11,color:l.color,fontWeight:600}}>Lesson {l.id}</div>
                                    <div style={{fontSize:16,fontWeight:700}}>{l.title}</div>
                                    <div style={{fontSize:13,color:'var(--txt2)'}}>{l.sub}</div>
                                </div>
                                <svg viewBox="0 0 24 24" fill={l.color} width="20" height="20"><path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"/></svg>
                            </div>
                        </div>
                    ))}
                    <button className="btn btn-acc" onClick={()=>{setQIdx(0);setScore(0);setSel(null);setShow(false);setDone(false);setPage('quiz')}} style={{width:'100%',justifyContent:'center',marginTop:20,marginBottom:32}}>
                        ğŸ“ é–‹å§‹æ¸¬é©— (10é¡Œ)
                    </button>
                </div>
            </div>
            <footer style={{background:'#EDE7F6',padding:'24px 16px',textAlign:'center'}}>
                <p style={{fontSize:13,color:'var(--txt2)'}}>æ–°ç«¹å°å¤§åˆ†é™¢æ•™å­¸éƒ¨</p>
                <p style={{fontSize:12,color:'var(--txt2)'}}>è¬æ…•æš MD, PhD, FESC | é»ƒæ²›éŠ“ MD | é»ƒåœ‹è‰¯</p>
            </footer>
        </div>
    );

    const L1=()=>(
        <div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--pri)',marginBottom:16}}>ğŸ“š ç‚ºä»€éº¼éœ€è¦ç³»çµ±æ€§æ–‡ç»æœå°‹ï¼Ÿ</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:16}}>åœ¨å¯¦è­‰é†«å­¸çš„å¯¦è¸ä¸­ï¼Œç³»çµ±æ€§æ–‡ç»æœå°‹æ˜¯é—œéµæ­¥é©Ÿã€‚è‰¯å¥½çš„æœå°‹ç­–ç•¥å¯ä»¥ï¼š</p>
                <div style={{display:'flex',flexDirection:'column',gap:8}}>
                    {['æ‰¾åˆ°æœ€ä½³å¯ç”¨è­‰æ“šå›ç­”è‡¨åºŠå•é¡Œ','é¿å…éºæ¼é‡è¦ç ”ç©¶','æ¸›å°‘é¸æ“‡åå·®çš„å½±éŸ¿','ç¢ºä¿æ±ºç­–åŸºæ–¼å®Œæ•´çš„è­‰æ“šåŸºç¤'].map((item,i)=>(
                        <div key={i} style={{display:'flex',alignItems:'center',gap:10,padding:'10px 14px',background:'#F3E5F5',borderRadius:10}}>
                            <span style={{color:'var(--suc)',fontWeight:700}}>âœ“</span>
                            <span style={{fontSize:14,color:'var(--txt)'}}>{item}</span>
                        </div>
                    ))}
                </div>
            </div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--blue)',marginBottom:12}}>ğŸ—ƒï¸ ä¸»è¦é†«å­¸è³‡æ–™åº«æ¯”è¼ƒ</h3>
                <table>
                    <thead><tr><th>è³‡æ–™åº«</th><th>ç‰¹è‰²</th><th>é©ç”¨æƒ…å¢ƒ</th></tr></thead>
                    <tbody>
                        <tr><td style={{fontWeight:600,color:'var(--blue)'}}>PubMed</td><td>å…è²»ã€æœ€å»£æ³›ä½¿ç”¨</td><td>ä¸€èˆ¬æ–‡ç»æœå°‹é¦–é¸</td></tr>
                        <tr><td style={{fontWeight:600,color:'var(--suc)'}}>Cochrane</td><td>ç³»çµ±æ€§å›é¡§å°ˆé–€åº«</td><td>å°‹æ‰¾é«˜å“è³ªè­‰æ“š</td></tr>
                        <tr><td style={{fontWeight:600,color:'var(--acc)'}}>Embase</td><td>è—¥ç‰©èˆ‡æ­æ´²æ–‡ç»</td><td>è—¥ç‰©ç›¸é—œç ”ç©¶</td></tr>
                        <tr><td style={{fontWeight:600,color:'var(--pri)'}}>CINAHL</td><td>è­·ç†èˆ‡å¥åº·ç§‘å­¸</td><td>è­·ç†ç›¸é—œä¸»é¡Œ</td></tr>
                    </tbody>
                </table>
            </div>
            <div className="warn">
                <strong style={{color:'#F57F17'}}>âš ï¸ å¸¸è¦‹æœå°‹éŒ¯èª¤</strong><br/>
                <ul style={{fontSize:14,color:'var(--txt2)',marginTop:8,paddingLeft:20}}>
                    <li>åªæœå°‹å–®ä¸€è³‡æ–™åº«</li>
                    <li>æœå°‹è©å½™å¤ªç‹¹çª„æˆ–å¤ªå»£æ³›</li>
                    <li>æœªä½¿ç”¨åŒç¾©è©æ“´å¤§æœå°‹</li>
                    <li>æœªè¨˜éŒ„æœå°‹ç­–ç•¥</li>
                </ul>
            </div>
            <div className="good">
                <strong style={{color:'var(--suc)'}}>ğŸ’¡ EBM äº”æ­¥é©Ÿä¸­çš„ã€ŒAcquireã€</strong><br/>
                <span style={{fontSize:14,color:'var(--txt2)'}}>
                æ–‡ç»æœå°‹å°æ‡‰EBMäº”æ­¥é©Ÿä¸­çš„ç¬¬äºŒæ­¥ã€ŒAcquireï¼ˆç²å–ï¼‰ã€ã€‚å¥½çš„æœå°‹ç­–ç•¥èƒ½å¹«åŠ©æ‚¨æœ‰æ•ˆç‡åœ°æ‰¾åˆ°å›ç­”è‡¨åºŠå•é¡Œçš„æœ€ä½³è­‰æ“šã€‚
                </span>
            </div>
        </div>
    );

    const L2=()=>(
        <div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--pri)',marginBottom:12}}>ğŸ¯ PICO æ¶æ§‹</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:16}}>PICOæ˜¯æå‡ºå¯å›ç­”è‡¨åºŠå•é¡Œçš„æ¨™æº–æ¶æ§‹ï¼Œå¹«åŠ©æˆ‘å€‘ç²¾ç¢ºå®šç¾©å•é¡Œä¸¦æœå°‹æ–‡ç»ã€‚</p>
                <div className="formula">P + I + C + O = å¥½çš„è‡¨åºŠå•é¡Œ</div>
            </div>
            <div className="card">
                <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri2)',marginBottom:12}}>ğŸ“‹ PICO å„å…ƒç´ èªªæ˜</h3>
                <table>
                    <tbody>
                        <tr style={{background:'#FCE4EC'}}><td style={{fontWeight:700,color:'#C2185B',width:'35%'}}>P - Patient<br/><span style={{fontWeight:400,fontSize:12}}>ç—…äºº/æ—ç¾¤</span></td><td>æˆ‘çš„ç—…äººæ˜¯èª°ï¼Ÿ<br/><span style={{fontSize:12,color:'var(--txt2)'}}>å¹´é½¡ã€æ€§åˆ¥ã€ç–¾ç—…ã€åš´é‡åº¦</span></td></tr>
                        <tr style={{background:'#E1BEE7'}}><td style={{fontWeight:700,color:'#7B1FA2'}}>I - Intervention<br/><span style={{fontWeight:400,fontSize:12}}>ä»‹å…¥æªæ–½</span></td><td>æˆ‘æƒ³è©•ä¼°ä»€éº¼æ²»ç™‚/æš´éœ²ï¼Ÿ<br/><span style={{fontSize:12,color:'var(--txt2)'}}>è—¥ç‰©ã€æ‰‹è¡“ã€è¨ºæ–·å·¥å…·</span></td></tr>
                        <tr style={{background:'#D1C4E9'}}><td style={{fontWeight:700,color:'#512DA8'}}>C - Comparison<br/><span style={{fontWeight:400,fontSize:12}}>æ¯”è¼ƒå°è±¡</span></td><td>èˆ‡ä»€éº¼æ¯”è¼ƒï¼Ÿ<br/><span style={{fontSize:12,color:'var(--txt2)'}}>å®‰æ…°åŠ‘ã€æ¨™æº–æ²»ç™‚ã€ç„¡æ²»ç™‚</span></td></tr>
                        <tr style={{background:'#C5CAE9'}}><td style={{fontWeight:700,color:'#303F9F'}}>O - Outcome<br/><span style={{fontWeight:400,fontSize:12}}>çµæœ</span></td><td>æˆ‘é—œå¿ƒä»€éº¼çµæœï¼Ÿ<br/><span style={{fontSize:12,color:'var(--txt2)'}}>æ­»äº¡ç‡ã€ç—‡ç‹€æ”¹å–„ã€ç”Ÿæ´»å“è³ª</span></td></tr>
                    </tbody>
                </table>
            </div>

            {/* PICO Builder Tool - inlined to prevent focus loss */}
            <div className="card" style={{border:'2px solid var(--pri)',background:'linear-gradient(135deg,#FAFBFC,#F3E5F5)'}}>
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--pri)',marginBottom:16,display:'flex',alignItems:'center',gap:8}}>
                    <span style={{fontSize:24}}>ğŸ”§</span> PICO å•é¡Œå»ºæ§‹å™¨
                </h3>

                {/* Template Selector */}
                <div style={{marginBottom:20}}>
                    <div style={{fontSize:14,fontWeight:600,color:'var(--txt)',marginBottom:10}}>ğŸ“‹ å¿«é€Ÿç¯„æœ¬ï¼ˆé»æ“Šè‡ªå‹•å¡«å…¥ï¼‰</div>
                    <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:8}}>
                        {picoTemplates.slice(0,4).map(t=>(
                            <div key={t.id} className={`template-card ${activeTemplate===t.id?'active':''}`} onClick={()=>selectTemplate(t)}>
                                <div style={{display:'flex',alignItems:'center',gap:6,marginBottom:4}}>
                                    <span>{t.icon}</span>
                                    <span style={{fontSize:11,color:t.color,fontWeight:600}}>{t.specialty}</span>
                                </div>
                                <div style={{fontSize:13,fontWeight:600,color:'var(--txt)'}}>{t.title}</div>
                            </div>
                        ))}
                    </div>
                    <details style={{marginTop:8}}>
                        <summary style={{cursor:'pointer',fontSize:13,color:'var(--pri)',fontWeight:600}}>é¡¯ç¤ºæ›´å¤šç¯„æœ¬...</summary>
                        <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:8,marginTop:8}}>
                            {picoTemplates.slice(4).map(t=>(
                                <div key={t.id} className={`template-card ${activeTemplate===t.id?'active':''}`} onClick={()=>selectTemplate(t)}>
                                    <div style={{display:'flex',alignItems:'center',gap:6,marginBottom:4}}>
                                        <span>{t.icon}</span>
                                        <span style={{fontSize:11,color:t.color,fontWeight:600}}>{t.specialty}</span>
                                    </div>
                                    <div style={{fontSize:13,fontWeight:600,color:'var(--txt)'}}>{t.title}</div>
                                </div>
                            ))}
                        </div>
                    </details>
                </div>

                {/* PICO Input Fields - Uncontrolled inputs with Generate button */}
                <div style={{display:'flex',flexDirection:'column',gap:16}}>
                    <div>
                        <label style={{display:'flex',alignItems:'center',gap:8,marginBottom:6}}>
                            <span style={{background:'#E91E63',color:'#fff',padding:'4px 10px',borderRadius:8,fontSize:13,fontWeight:700}}>P</span>
                            <span style={{fontSize:14,fontWeight:600,color:'var(--txt)'}}>Patient/Population</span>
                        </label>
                        <input
                            type="text"
                            id="pico-p"
                            className="pico-input"
                            placeholder="ç—…äººæ—ç¾¤ï¼ˆå¦‚ï¼štype 2 diabetes, elderlyï¼‰"
                            defaultValue={picoData.p}
                        />
                    </div>
                    <div>
                        <label style={{display:'flex',alignItems:'center',gap:8,marginBottom:6}}>
                            <span style={{background:'#9C27B0',color:'#fff',padding:'4px 10px',borderRadius:8,fontSize:13,fontWeight:700}}>I</span>
                            <span style={{fontSize:14,fontWeight:600,color:'var(--txt)'}}>Intervention</span>
                        </label>
                        <input
                            type="text"
                            id="pico-i"
                            className="pico-input"
                            placeholder="ä»‹å…¥æªæ–½ï¼ˆå¦‚ï¼šmetformin, surgeryï¼‰"
                            defaultValue={picoData.i}
                        />
                    </div>
                    <div>
                        <label style={{display:'flex',alignItems:'center',gap:8,marginBottom:6}}>
                            <span style={{background:'#673AB7',color:'#fff',padding:'4px 10px',borderRadius:8,fontSize:13,fontWeight:700}}>C</span>
                            <span style={{fontSize:14,fontWeight:600,color:'var(--txt)'}}>Comparison</span>
                        </label>
                        <input
                            type="text"
                            id="pico-c"
                            className="pico-input"
                            placeholder="æ¯”è¼ƒå°è±¡ï¼ˆå¦‚ï¼šplacebo, standard careï¼‰å¯ç©ºç™½"
                            defaultValue={picoData.c}
                        />
                    </div>
                    <div>
                        <label style={{display:'flex',alignItems:'center',gap:8,marginBottom:6}}>
                            <span style={{background:'#3F51B5',color:'#fff',padding:'4px 10px',borderRadius:8,fontSize:13,fontWeight:700}}>O</span>
                            <span style={{fontSize:14,fontWeight:600,color:'var(--txt)'}}>Outcome</span>
                        </label>
                        <input
                            type="text"
                            id="pico-o"
                            className="pico-input"
                            placeholder="çµæœæŒ‡æ¨™ï¼ˆå¦‚ï¼šmortality, HbA1cï¼‰"
                            defaultValue={picoData.o}
                        />
                    </div>
                </div>

                {/* Generate Button */}
                <div style={{display:'flex',gap:8,marginTop:16}}>
                    <button
                        onClick={()=>{
                            const p=document.getElementById('pico-p').value;
                            const i=document.getElementById('pico-i').value;
                            const c=document.getElementById('pico-c').value;
                            const o=document.getElementById('pico-o').value;
                            setPicoData({p,i,c,o});
                        }}
                        className="btn btn-pri"
                        style={{flex:1,justifyContent:'center'}}
                    >
                        ğŸ” ç”¢ç”Ÿæœå°‹å­—ä¸²
                    </button>
                    <button
                        onClick={()=>{
                            document.getElementById('pico-p').value='';
                            document.getElementById('pico-i').value='';
                            document.getElementById('pico-c').value='';
                            document.getElementById('pico-o').value='';
                            clearPico();
                        }}
                        style={{padding:'12px 16px',background:'#fff',border:'1px solid #ddd',borderRadius:12,fontSize:14,cursor:'pointer',color:'var(--txt2)'}}
                    >
                        æ¸…é™¤
                    </button>
                </div>

                {/* Results Section - Only shown after Generate button is clicked */}
                {hasValidPico && (
                    <div style={{marginTop:20}}>
                        <div style={{fontSize:14,fontWeight:600,color:'var(--txt)',marginBottom:8}}>ğŸ“ è‡¨åºŠå•é¡Œé è¦½</div>
                        <div style={{background:'#fff',border:'2px solid var(--suc)',borderRadius:12,padding:16}}>
                            <p style={{fontSize:14,color:'var(--txt)',lineHeight:1.8}}>
                                å°æ–¼ <strong style={{color:'#E91E63'}}>{picoData.p||'[ç—…äººæ—ç¾¤]'}</strong>ï¼Œ
                                ä½¿ç”¨ <strong style={{color:'#9C27B0'}}>{picoData.i||'[ä»‹å…¥æªæ–½]'}</strong>
                                {picoData.c && <> ç›¸è¼ƒæ–¼ <strong style={{color:'#673AB7'}}>{picoData.c}</strong></>}
                                ï¼Œèƒ½å¦æ”¹å–„ <strong style={{color:'#3F51B5'}}>{picoData.o||'[çµæœæŒ‡æ¨™]'}</strong>ï¼Ÿ
                            </p>
                        </div>
                    </div>
                )}

                {/* Search Outputs */}
                {hasValidPico && (
                    <div style={{marginTop:20}}>
                        {/* PubMed Search */}
                        <div style={{marginBottom:16}}>
                            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8,flexWrap:'wrap',gap:8}}>
                                <span style={{fontSize:14,fontWeight:600,color:'var(--blue)'}}>ğŸ” PubMed æœå°‹å­—ä¸²</span>
                                <div style={{display:'flex',gap:8}}>
                                    <button onClick={()=>copyToClipboard(pubmedSearch,'pubmed')} className="btn" style={{padding:'6px 12px',fontSize:12,background:copied==='pubmed'?'var(--suc)':'#fff',color:copied==='pubmed'?'#fff':'var(--txt)',border:'1px solid #ddd'}}>
                                        {copied==='pubmed'?'âœ“ å·²è¤‡è£½':'è¤‡è£½'}
                                    </button>
                                    <button onClick={openPubMed} className="btn btn-blue" style={{padding:'6px 12px',fontSize:12}}>
                                        åœ¨ PubMed æœå°‹ â†—
                                    </button>
                                </div>
                            </div>
                            <div className="search-output">{pubmedSearch}</div>
                        </div>

                        {/* Cochrane Search */}
                        <div>
                            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:8,flexWrap:'wrap',gap:8}}>
                                <span style={{fontSize:14,fontWeight:600,color:'var(--suc)'}}>ğŸ“š Cochrane æœå°‹å­—ä¸²</span>
                                <div style={{display:'flex',gap:8}}>
                                    <button onClick={()=>copyToClipboard(cochraneSearch,'cochrane')} className="btn" style={{padding:'6px 12px',fontSize:12,background:copied==='cochrane'?'var(--suc)':'#fff',color:copied==='cochrane'?'#fff':'var(--txt)',border:'1px solid #ddd'}}>
                                        {copied==='cochrane'?'âœ“ å·²è¤‡è£½':'è¤‡è£½'}
                                    </button>
                                    <button onClick={openCochrane} className="btn btn-suc" style={{padding:'6px 12px',fontSize:12}}>
                                        åœ¨ Cochrane æœå°‹ â†—
                                    </button>
                                </div>
                            </div>
                            <div className="search-output" style={{background:'linear-gradient(135deg,#E0F2F1,#E3F2FD)',borderColor:'var(--suc)'}}>{cochraneSearch}</div>
                        </div>
                    </div>
                )}
            </div>

            <div className="tip">
                <strong style={{color:'var(--acc)'}}>ğŸ“ PICO ç¯„ä¾‹</strong><br/>
                <p style={{fontSize:14,color:'var(--txt2)',marginTop:8,lineHeight:1.8}}>
                <strong>å•é¡Œï¼š</strong>å°æ–¼æ€¥æ€§å¿ƒè‚Œæ¢—å¡çš„ç—…äººï¼Œä½¿ç”¨æ–°å‹P2Y12æŠ‘åˆ¶åŠ‘ç›¸è¼ƒæ–¼Clopidogrelï¼Œæ˜¯å¦èƒ½é™ä½å¿ƒè¡€ç®¡äº‹ä»¶ï¼Ÿ<br/><br/>
                <strong>Pï¼š</strong>æ€¥æ€§å¿ƒè‚Œæ¢—å¡ç—…äºº<br/>
                <strong>Iï¼š</strong>æ–°å‹P2Y12æŠ‘åˆ¶åŠ‘ï¼ˆTicagreloræˆ–Prasugrelï¼‰<br/>
                <strong>Cï¼š</strong>Clopidogrel<br/>
                <strong>Oï¼š</strong>ä¸»è¦å¿ƒè¡€ç®¡ä¸è‰¯äº‹ä»¶ï¼ˆMACEï¼‰
                </p>
            </div>
        </div>
    );

    const L3=()=>(
        <div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--blue)',marginBottom:16}}>ğŸ” PubMed å¸ƒæ—é‹ç®—å­</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:16}}>å¸ƒæ—é‹ç®—å­æ˜¯çµ„åˆæœå°‹è©å½™çš„é—œéµå·¥å…·ã€‚ç†è§£å®ƒå€‘çš„åŠŸèƒ½å¯ä»¥å¤§å¹…æå‡æœå°‹æ•ˆç‡ã€‚</p>
                <table>
                    <thead><tr><th>é‹ç®—å­</th><th>åŠŸèƒ½</th><th>ç¯„ä¾‹</th></tr></thead>
                    <tbody>
                        <tr><td style={{fontWeight:700,color:'var(--suc)'}}>AND</td><td>ç¸®å°ç¯„åœ<br/><span style={{fontSize:11,color:'var(--txt2)'}}>å…©è€…éƒ½è¦æœ‰</span></td><td><code>diabetes AND metformin</code></td></tr>
                        <tr><td style={{fontWeight:700,color:'var(--pri)'}}>OR</td><td>æ“´å¤§ç¯„åœ<br/><span style={{fontSize:11,color:'var(--txt2)'}}>ä»»ä¸€å³å¯</span></td><td><code>heart attack OR MI</code></td></tr>
                        <tr><td style={{fontWeight:700,color:'var(--err)'}}>NOT</td><td>æ’é™¤è©å½™<br/><span style={{fontSize:11,color:'var(--txt2)'}}>ä¸è¦åŒ…å«</span></td><td><code>cancer NOT lung</code></td></tr>
                    </tbody>
                </table>
            </div>
            <div className="card">
                <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri)',marginBottom:12}}>ğŸ“– MeSH è©å½™</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>MeSHï¼ˆMedical Subject Headingsï¼‰æ˜¯ç¾åœ‹åœ‹å®¶é†«å­¸åœ–æ›¸é¤¨å»ºç«‹çš„æ¨™æº–åŒ–é†«å­¸è©å½™ç³»çµ±ã€‚</p>
                <div className="info">
                    <strong style={{color:'var(--blue)'}}>MeSH å„ªé»</strong>
                    <ul style={{fontSize:14,color:'var(--txt2)',marginTop:8,paddingLeft:20}}>
                        <li>çµ±ä¸€ä¸åŒè¡“èªï¼ˆå¦‚ heart attack = myocardial infarctionï¼‰</li>
                        <li>è‡ªå‹•åŒ…å«ä¸‹å±¤æ¦‚å¿µï¼ˆexplosion åŠŸèƒ½ï¼‰</li>
                        <li>æé«˜æœå°‹çš„å®Œæ•´æ€§èˆ‡ç²¾ç¢ºåº¦</li>
                    </ul>
                </div>
            </div>
            <div className="card">
                <h3 style={{fontSize:16,fontWeight:700,color:'var(--suc)',marginBottom:12}}>ğŸ·ï¸ å¸¸ç”¨æ¬„ä½æ¨™ç±¤</h3>
                <table>
                    <tbody>
                        <tr><td style={{fontWeight:600}}>[Title/Abstract]</td><td>æœå°‹æ¨™é¡Œèˆ‡æ‘˜è¦</td></tr>
                        <tr><td style={{fontWeight:600}}>[MeSH Terms]</td><td>æœå°‹MeSHè©å½™</td></tr>
                        <tr><td style={{fontWeight:600}}>[pt]</td><td>æ–‡ç« é¡å‹ï¼ˆå¦‚RCTï¼‰</td></tr>
                        <tr><td style={{fontWeight:600}}>[tiab]</td><td>åŒTitle/Abstractç°¡å¯«</td></tr>
                    </tbody>
                </table>
            </div>
            <div className="formula">
                (diabetes[MeSH] OR "diabetes mellitus"[tiab])<br/>
                AND<br/>
                (metformin[MeSH] OR metformin[tiab])<br/>
                AND<br/>
                randomized controlled trial[pt]
            </div>
            <div className="good">
                <strong style={{color:'var(--suc)'}}>ğŸ’¡ æˆªè©æœå°‹ (Truncation)</strong><br/>
                <span style={{fontSize:14,color:'var(--txt2)'}}>
                ä½¿ç”¨ * ç¬¦è™Ÿå¯ä»¥æœå°‹ç›¸åŒå­—æ ¹çš„è®ŠåŒ–å½¢å¼ï¼š<br/>
                <code>therap*</code> â†’ therapy, therapies, therapeutic, therapist...
                </span>
            </div>
        </div>
    );

    const L4=()=>(
        <div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--suc)',marginBottom:16}}>ğŸ“š Cochrane Library ç°¡ä»‹</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:16}}>Cochrane Libraryæ˜¯ç³»çµ±æ€§å›é¡§çš„æ¬Šå¨è³‡æ–™åº«ï¼Œæä¾›é«˜å“è³ªçš„å¯¦è­‰é†«å­¸è­‰æ“šã€‚</p>
                <div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:12}}>
                    {[
                        {title:'Cochrane Reviews',desc:'ç³»çµ±æ€§å›é¡§',color:'var(--suc)'},
                        {title:'Cochrane Protocols',desc:'é€²è¡Œä¸­çš„å›é¡§è¨ˆç•«',color:'var(--blue)'},
                        {title:'CENTRAL',desc:'è‡¨åºŠè©¦é©—ç™»éŒ„',color:'var(--pri)'},
                        {title:'Clinical Answers',desc:'è‡¨åºŠå•ç­”æ‘˜è¦',color:'var(--acc)'}
                    ].map((item,i)=>(
                        <div key={i} style={{background:'#fff',border:`2px solid ${item.color}`,borderRadius:12,padding:12,textAlign:'center'}}>
                            <div style={{fontWeight:700,color:item.color,marginBottom:4}}>{item.title}</div>
                            <div style={{fontSize:12,color:'var(--txt2)'}}>{item.desc}</div>
                        </div>
                    ))}
                </div>
            </div>
            <div className="card">
                <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri)',marginBottom:12}}>ğŸ” Cochrane æœå°‹èªæ³•</h3>
                <table>
                    <tbody>
                        <tr><td style={{fontWeight:600}}>:ti</td><td>æœå°‹æ¨™é¡Œ (title)</td></tr>
                        <tr><td style={{fontWeight:600}}>:ab</td><td>æœå°‹æ‘˜è¦ (abstract)</td></tr>
                        <tr><td style={{fontWeight:600}}>:kw</td><td>æœå°‹é—œéµå­— (keyword)</td></tr>
                        <tr><td style={{fontWeight:600}}>:ti,ab,kw</td><td>åŒæ™‚æœå°‹æ¨™é¡Œã€æ‘˜è¦ã€é—œéµå­—</td></tr>
                    </tbody>
                </table>
                <div className="formula" style={{marginTop:16}}>
                    (diabetes):ti,ab,kw AND (SGLT2):ti,ab,kw
                </div>
            </div>
            <div className="info">
                <strong style={{color:'var(--blue)'}}>ğŸ“– å¦‚ä½•é–±è®€Cochraneå›é¡§</strong><br/>
                <ol style={{fontSize:14,color:'var(--txt2)',marginTop:8,paddingLeft:20}}>
                    <li><strong>Plain Language Summary</strong> - ä¸€èˆ¬è®€è€…æ‘˜è¦</li>
                    <li><strong>Abstract</strong> - çµæ§‹åŒ–æ‘˜è¦</li>
                    <li><strong>Summary of Findings Table</strong> - é—œéµç™¼ç¾è¡¨æ ¼</li>
                    <li><strong>Forest Plot</strong> - çµ±åˆåˆ†æåœ–è¡¨</li>
                </ol>
            </div>
            <div className="tip">
                <strong style={{color:'var(--acc)'}}>ğŸ’¡ å°æŠ€å·§</strong><br/>
                <span style={{fontSize:14,color:'var(--txt2)'}}>
                Cochrane Library æä¾› PICO æœå°‹åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥è¼¸å…¥ Pã€Iã€Cã€O å„å…ƒç´ é€²è¡Œæœå°‹ï¼Œå°æ–¼åˆå­¸è€…éå¸¸å‹å–„ã€‚
                </span>
            </div>
        </div>
    );

    const L5=()=>(
        <div>
            <div className="card">
                <h3 style={{fontSize:18,fontWeight:700,color:'var(--acc)',marginBottom:16}}>ğŸš€ é€²éšæœå°‹æŠ€å·§</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:16}}>æŒæ¡é€²éšæŠ€å·§å¯ä»¥è®“æ‚¨çš„æ–‡ç»æœå°‹æ›´æœ‰æ•ˆç‡ã€æ›´å®Œæ•´ã€‚</p>
            </div>
            <div className="card">
                <h3 style={{fontSize:16,fontWeight:700,color:'var(--blue)',marginBottom:12}}>ğŸ·ï¸ ç ”ç©¶é¡å‹ç¯©é¸å™¨</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>PubMedæä¾›é è¨­çš„ç¯©é¸å™¨ï¼Œå¯ä»¥å¿«é€Ÿæ‰¾åˆ°ç‰¹å®šé¡å‹çš„ç ”ç©¶ï¼š</p>
                <table>
                    <tbody>
                        <tr><td style={{fontWeight:600,color:'var(--suc)'}}>Clinical Trial</td><td>è‡¨åºŠè©¦é©—</td></tr>
                        <tr><td style={{fontWeight:600,color:'var(--pri)'}}>Randomized Controlled Trial</td><td>éš¨æ©Ÿå°ç…§è©¦é©—</td></tr>
                        <tr><td style={{fontWeight:600,color:'var(--blue)'}}>Systematic Review</td><td>ç³»çµ±æ€§å›é¡§</td></tr>
                        <tr><td style={{fontWeight:600,color:'var(--acc)'}}>Meta-Analysis</td><td>çµ±åˆåˆ†æ</td></tr>
                    </tbody>
                </table>
            </div>
            <div className="card">
                <h3 style={{fontSize:16,fontWeight:700,color:'var(--pri)',marginBottom:12}}>ğŸ“ è¨˜éŒ„æœå°‹ç­–ç•¥</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>ç³»çµ±æ€§æ–‡ç»æœå°‹å¿…é ˆè¨˜éŒ„å®Œæ•´çš„æœå°‹ç­–ç•¥ï¼Œä»¥ç¢ºä¿å¯é‡è¤‡æ€§ï¼š</p>
                <div className="purple">
                    <strong>æœå°‹è¨˜éŒ„æ‡‰åŒ…å«ï¼š</strong>
                    <ul style={{fontSize:14,color:'var(--txt2)',marginTop:8,paddingLeft:20}}>
                        <li>æœå°‹æ—¥æœŸ</li>
                        <li>ä½¿ç”¨çš„è³‡æ–™åº«</li>
                        <li>å®Œæ•´æœå°‹å­—ä¸²</li>
                        <li>æœå°‹çµæœæ•¸é‡</li>
                        <li>ä½¿ç”¨çš„ç¯©é¸æ¢ä»¶</li>
                    </ul>
                </div>
            </div>
            <div className="card">
                <h3 style={{fontSize:16,fontWeight:700,color:'var(--suc)',marginBottom:12}}>ğŸ“Š PRISMA æµç¨‹åœ–</h3>
                <p style={{fontSize:14,color:'var(--txt2)',marginBottom:12}}>PRISMAæµç¨‹åœ–ç”¨æ–¼å‘ˆç¾ç³»çµ±æ€§å›é¡§çš„æ–‡ç»ç¯©é¸éç¨‹ï¼š</p>
                <div style={{background:'#F0FFF4',borderRadius:12,padding:16,textAlign:'center'}}>
                    <div style={{background:'var(--suc)',color:'#fff',padding:'8px 16px',borderRadius:8,marginBottom:8,display:'inline-block'}}>è³‡æ–™åº«æœå°‹çµæœ (n=xxx)</div>
                    <div style={{fontSize:20,marginBottom:8}}>â†“</div>
                    <div style={{background:'var(--blue)',color:'#fff',padding:'8px 16px',borderRadius:8,marginBottom:8,display:'inline-block'}}>å»é™¤é‡è¤‡å¾Œ (n=xxx)</div>
                    <div style={{fontSize:20,marginBottom:8}}>â†“</div>
                    <div style={{background:'var(--pri)',color:'#fff',padding:'8px 16px',borderRadius:8,marginBottom:8,display:'inline-block'}}>æ¨™é¡Œæ‘˜è¦ç¯©é¸å¾Œ (n=xxx)</div>
                    <div style={{fontSize:20,marginBottom:8}}>â†“</div>
                    <div style={{background:'var(--acc)',color:'#fff',padding:'8px 16px',borderRadius:8,display:'inline-block'}}>å…¨æ–‡è©•ä¼°å¾Œç´å…¥ (n=xxx)</div>
                </div>
            </div>
            <div className="good">
                <strong style={{color:'var(--suc)'}}>ğŸ’¡ å¼•ç”¨ç®¡ç†å·¥å…·</strong><br/>
                <span style={{fontSize:14,color:'var(--txt2)'}}>
                ä½¿ç”¨å¼•ç”¨ç®¡ç†è»Ÿé«”ï¼ˆå¦‚ EndNoteã€Zoteroã€Mendeleyï¼‰å¯ä»¥å¹«åŠ©æ‚¨ï¼š<br/>
                â€¢ è‡ªå‹•åŒ¯å…¥æ–‡ç»è³‡æ–™<br/>
                â€¢ å»é™¤é‡è¤‡æ–‡ç»<br/>
                â€¢ ç®¡ç†å…¨æ–‡PDF<br/>
                â€¢ è‡ªå‹•ç”¢ç”Ÿåƒè€ƒæ–‡ç»æ ¼å¼
                </span>
            </div>
        </div>
    );

    const Lesson=()=>{
        const lesson=lessons.find(l=>l.id===lessonId);
        return(
            <div>
                <Header title={lesson.title}/>
                <div style={{background:`linear-gradient(135deg,${lesson.color},${lesson.color}88)`,padding:'24px 20px',color:'#fff'}}>
                    <div style={{maxWidth:480,margin:'0 auto'}}>
                        <div style={{fontSize:12,opacity:0.9,marginBottom:4}}>Lesson {lessonId} / 5</div>
                        <h1 style={{fontSize:22,fontWeight:700}}>{lesson.title}</h1>
                        <p style={{fontSize:14,opacity:0.9}}>{lesson.sub}</p>
                    </div>
                </div>
                <div style={{padding:'20px 16px'}}>
                    <div style={{maxWidth:480,margin:'0 auto'}}>
                        {/* Lesson Navigation */}
                        <div style={{display:'flex',gap:6,marginBottom:20,overflowX:'auto',paddingBottom:8}}>
                            {lessons.map(l=>(
                                <button key={l.id} onClick={()=>setLessonId(l.id)} style={{
                                    padding:'8px 16px',borderRadius:20,border:'none',
                                    background:lessonId===l.id?l.color:'#E5E5E5',
                                    color:lessonId===l.id?'#fff':'var(--txt2)',
                                    fontWeight:600,fontSize:13,cursor:'pointer',whiteSpace:'nowrap'
                                }}>
                                    L{l.id}
                                </button>
                            ))}
                        </div>

                        {/* Render lesson content directly instead of as component to prevent focus loss */}
                        {lessonId===1 && L1()}
                        {lessonId===2 && L2()}
                        {lessonId===3 && L3()}
                        {lessonId===4 && L4()}
                        {lessonId===5 && L5()}

                        {/* Navigation Buttons */}
                        <div style={{display:'flex',justifyContent:'space-between',marginTop:24,marginBottom:32}}>
                            <button
                                className="btn btn-outline"
                                onClick={()=>lessonId>1?setLessonId(lessonId-1):setPage('home')}
                                style={{flex:1,marginRight:8,justifyContent:'center'}}
                            >
                                â† {lessonId>1?'ä¸Šä¸€èª²':'è¿”å›é¦–é '}
                            </button>
                            <button
                                className="btn btn-pri"
                                onClick={()=>lessonId<5?setLessonId(lessonId+1):setPage('home')}
                                style={{flex:1,marginLeft:8,justifyContent:'center'}}
                            >
                                {lessonId<5?'ä¸‹ä¸€èª² â†’':'å®Œæˆèª²ç¨‹ âœ“'}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const Quiz=()=>{
        const current=quiz[qIdx];
        if(done){
            const pct=Math.round(score/quiz.length*100);
            return(
                <div>
                    <Header title="æ¸¬é©—çµæœ"/>
                    <div style={{padding:'40px 16px',textAlign:'center'}}>
                        <div style={{maxWidth:480,margin:'0 auto'}}>
                            <div style={{fontSize:80,marginBottom:16}}>{pct>=80?'ğŸ‰':pct>=60?'ğŸ‘':'ğŸ“š'}</div>
                            <h2 style={{fontSize:24,fontWeight:700,marginBottom:8}}>æ¸¬é©—å®Œæˆï¼</h2>
                            <p style={{fontSize:18,color:'var(--txt2)',marginBottom:24}}>æ‚¨ç­”å°äº† <strong style={{color:'var(--pri)'}}>{score}</strong> / {quiz.length} é¡Œ</p>
                            <div style={{background:pct>=80?'var(--suc)':pct>=60?'var(--warn)':'var(--err)',color:'#fff',padding:'20px',borderRadius:16,marginBottom:24}}>
                                <div style={{fontSize:48,fontWeight:700}}>{pct}%</div>
                                <div style={{fontSize:14}}>{pct>=80?'å¤ªæ£’äº†ï¼æ‚¨å·²æŒæ¡æ–‡ç»æœå°‹æŠ€å·§':pct>=60?'ä¸éŒ¯ï¼å»ºè­°è¤‡ç¿’éƒ¨åˆ†å…§å®¹':'å»ºè­°é‡æ–°é–±è®€èª²ç¨‹å…§å®¹'}</div>
                            </div>
                            <button className="btn btn-pri" onClick={()=>setPage('home')} style={{width:'100%',justifyContent:'center'}}>è¿”å›é¦–é </button>
                        </div>
                    </div>
                </div>
            );
        }
        return(
            <div>
                <Header title={`é¡Œç›® ${qIdx+1}/${quiz.length}`}/>
                <div style={{padding:'20px 16px'}}>
                    <div style={{maxWidth:480,margin:'0 auto'}}>
                        <div style={{background:'linear-gradient(135deg,var(--pri),var(--pri2))',borderRadius:16,padding:'20px',color:'#fff',marginBottom:20}}>
                            <div style={{fontSize:12,opacity:0.9,marginBottom:8}}>Question {qIdx+1} of {quiz.length}</div>
                            <h3 style={{fontSize:18,fontWeight:600,lineHeight:1.6}}>{current.q}</h3>
                        </div>
                        <div style={{display:'flex',flexDirection:'column',gap:10}}>
                            {current.o.map((opt,i)=>(
                                <button key={i} onClick={()=>{if(sel===null){setSel(i);if(i===current.c)setScore(score+1);setShow(true)}}}
                                    style={{
                                        padding:'16px',borderRadius:12,border:'2px solid',textAlign:'left',
                                        background:sel===null?'#fff':i===current.c?'#F0FFF4':sel===i?'#FFF0F0':'#fff',
                                        borderColor:sel===null?'#E5E5E5':i===current.c?'var(--suc)':sel===i?'var(--err)':'#E5E5E5',
                                        cursor:sel===null?'pointer':'default',fontSize:15
                                    }}>
                                    <span style={{fontWeight:600,marginRight:10,color:sel===null?'var(--pri)':i===current.c?'var(--suc)':sel===i?'var(--err)':'var(--txt2)'}}>
                                        {String.fromCharCode(65+i)}.
                                    </span>
                                    {opt}
                                </button>
                            ))}
                        </div>
                        {show && (
                            <div className={sel===current.c?'good':'tip'} style={{marginTop:20}}>
                                <strong style={{color:sel===current.c?'var(--suc)':'var(--err)'}}>{sel===current.c?'âœ“ æ­£ç¢ºï¼':'âœ— éŒ¯èª¤'}</strong>
                                <p style={{fontSize:14,color:'var(--txt2)',marginTop:8}}>{current.e}</p>
                            </div>
                        )}
                        {show && (
                            <button className="btn btn-pri" onClick={()=>{
                                if(qIdx<quiz.length-1){setQIdx(qIdx+1);setSel(null);setShow(false)}
                                else setDone(true)
                            }} style={{width:'100%',justifyContent:'center',marginTop:20}}>
                                {qIdx<quiz.length-1?'ä¸‹ä¸€é¡Œ â†’':'æŸ¥çœ‹çµæœ'}
                            </button>
                        )}
                    </div>
                </div>
            </div>
        );
    };

    return page==='home'?<Home/>:page==='lesson'?<Lesson/>:<Quiz/>;
};

ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
